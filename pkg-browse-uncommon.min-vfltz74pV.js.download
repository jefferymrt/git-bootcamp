define("modules/clean/avatar/list",["require","exports","tslib","external/classnames","external/react","external/react-dom-factories","external/prop-types","modules/clean/avatar/overflow_count_pill","modules/clean/avatar/size","modules/clean/react/css"],function(e,t,r,o,s,a,n,i,l,c){"use strict";o=r.__importDefault(o),s=r.__importStar(s),a=r.__importStar(a),n=r.__importStar(n);var d=s.createElement,u=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._defaultRenderOverflowCount=function(e){var r=e.overflowCount;return d(i,{count:r,dimension:t.props.avatarDimension,key:"overflow_pill:"+r,onClick:t.props.onOverflowCountClick})},t.getClassName=function(){return o.default(["horizontal-avatar-list",t.props.className,t.props.animation?["animation","is-animated"]:null])},t}return r.__extends(t,e),t.prototype.render=function(){var e=this.props.avatars,t=this.props.maxVisible,r=0;if(this.props.undisplayableCount&&(r+=this.props.undisplayableCount),(this.props.undisplayableCount||e.length>t)&&(t--,r+=e.length-t,e=e.slice(0,t)),r){var s=null!=this.props.overflowCountRenderer?this.props.overflowCountRenderer:this._defaultRenderOverflowCount;e.push(s({overflowCount:r,avatarArgs:{avatarDimension:this.props.avatarDimension,onAvatarClick:this.props.onOverflowCountClick,titleButtonDirection:"south"}}))}return a.div({className:o.default({"c-facepile":!0})},[a.div({className:this.getClassName(),key:"facepile"},e)])},t.displayName="HorizontalAvatarList",t.propTypes={avatars:n.array.isRequired,avatarDimension:n.oneOf(l.VALID_AVATAR_DIMENSIONS).isRequired,maxVisible:n.number.isRequired,undisplayableCount:n.number.isRequired,onOverflowCountClick:n.func,overflowCountRenderer:n.func,animation:n.bool,className:n.string},t.defaultProps={className:""},t})(s.Component);return c.requireCssWithComponent(u,["/static/css/avatar_list-vflqHc0nR.css"])}),define("modules/clean/avatar/shared_link_avatar",["require","exports","tslib","external/react","external/react-dom-factories","external/prop-types","modules/clean/avatar/size","modules/clean/avatar/style","modules/clean/css","modules/clean/static_urls","modules/core/i18n"],function(e,t,r,o,s,a,n,i,l,c,d){"use strict";return o=r.__importStar(o),s=r.__importStar(s),a=r.__importStar(a),l=r.__importStar(l),(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.componentDidMount=function(){return l.require_css("/static/css/scooter/scooter-scoped-vflrM1SRf.css")},t.prototype.render=function(){var e=s.img({src:c.static_url("/static/images/avatar/shared-link-icon-vflHCU_m6.svg"),alt:this.props.alt||d._("Shared link"),width:12,className:"u-mar-horizontal-xs"}),t=["c-avatar--meta"];null!=this.props.optionalClass&&t.push(this.props.optionalClass),null!=this.props.onClick&&t.push("u-unbutton");var r=i.getClassName(this.props.dimension,t);return null!=this.props.onClick?s.button({className:r,onClick:this.props.onClick},e):s.div({className:r,onClick:this.props.onClick},e)},t.displayName="SharedLinkAvatar",t.propTypes={alt:a.string,dimension:a.oneOf(n.VALID_AVATAR_DIMENSIONS).isRequired,onClick:a.func,optionalClass:a.string},t})(o.Component)}),define("modules/clean/browse/browse_bolt_client",["require","exports","tslib","modules/clean/ajax","modules/clean/bolt","modules/clean/react/browse/constants"],function(e,t,r,o,s,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o);var n=(function(){function e(e){var t=this;this.startLiveUpdate=function(e){void 0===e&&(e=null),e&&(t.handleUpdate=e),t.updateBoltClient(),t.status=a.BrowseBoltClientStatus.Live},this.onBoltRefresh=function(){t.updateBoltClient(),t.status=a.BrowseBoltClientStatus.Live},this.onBoltUpdate=function(){t.handleUpdate&&t.handleUpdate()},this.updateBoltClient=function(){var e=t.boltData.map(function(e){return new s.SignedChannelState("sfj",e.bolt_unique_id,e.latest_sjid.toString(),e.bolt_token)});t.boltClient?t.boltClient.update_states(e):(t.boltClient=new s.BoltClient(e,t.onBoltUpdate,t.onBoltRefresh),t.boltClient.start())},this.userId=e,this.status=a.BrowseBoltClientStatus.NotReady,this.boltData=[]}return e.prototype.isReady=function(){return this.status!==a.BrowseBoltClientStatus.NotReady},e.prototype.setInitialBoltData=function(e){this.boltData=e,this.status=a.BrowseBoltClientStatus.NotLive},e.prototype.fetchInitialBoltData=function(e){var t=this;this.initialBoltDataRequest&&this.initialBoltDataRequest.abort(),this.initialBoltDataRequest=o.WebRequest({url:"/get_browse_bolt_data",dataType:"json",subject_user:this.userId,success:function(r,o,s){t.setInitialBoltData(r),e()},error:function(e,r,o){t.status=a.BrowseBoltClientStatus.NotReady},complete:function(){delete t.initialBoltDataRequest}})},e.prototype.handleUpdateBoltClient=function(e){this.boltData=e,this.updateBoltClient()},e.prototype.getNsMap=function(){var e={};return this.boltData.forEach(function(t){e[t.bolt_unique_id]=parseInt(t.latest_sjid,10)}),e},e.prototype.stopLiveUpdate=function(){this.status=a.BrowseBoltClientStatus.NotLive,this.boltClient&&this.boltClient.unsubscribe()},e})();t.BrowseBoltClient=n}),define("modules/clean/cloud_docs/constants",["require","exports","tslib","external/lodash"],function(e,t,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o);(function(e){e.PAPER="paper"})(t.PaperFileTypes||(t.PaperFileTypes={}));(function(e){e.GOOGLE_DSS_DOC="gdoc",e.GOOGLE_DSS_SHEET="gsheet",e.GOOGLE_DSS_SLIDES="gslides"})(t.GoogleFileTypes||(t.GoogleFileTypes={}));var s;(function(e){e.WORD="docx",e.EXCEL="xlsx",e.POWERPOINT="pptx"})(s=t.MicrosoftFileTypes||(t.MicrosoftFileTypes={}));(function(e){e.HOME="new_file_menu_home",e.BROWSE="new_file_menu_browse"})(t.NewFileMenuFromType||(t.NewFileMenuFromType={})),t.isMicrosoftFileType=function(e){return o.values(s).includes(e)}}),define("modules/clean/cloud_docs/create_api",["require","exports","tslib","modules/clean/cloud_docs/constants","modules/clean/react/async_folder_selector_modal","modules/clean/react/snackbar","modules/clean/react/browse/api","modules/clean/react/browse/action_logger","modules/clean/web_user_action_events","modules/core/browser","modules/core/cookies","modules/core/i18n"],function(e,t,r,o,s,a,n,i,l,c,d,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),s=r.__importStar(s),n=r.__importStar(n),c=r.__importStar(c),t.getDepthFromPath=function(e){return(e.replace(/\/$/,"").match(/\//g)||[]).length},t.showAsyncFolderSelectorModal=function(e){var r=e.user,o=e.source,a=e.documentType;s.show({primaryAction:u._("Create"),secondaryAction:u._("Cancel"),title:u._("Create file in..."),ariaLabel:u._("Create file in..."),user:r,initialFolderSelection:"",forceRootSelectable:!1,onFolderSelected:function(e){i.logFileCreateClick({uid:r.id,source:o,action:l.WebUserActionLogEvent.FILE_CREATE_HOME_FOLDER_SELECTED,depth_folder_selected:t.getDepthFromPath(e)}),t.createNewFile({userId:r.id,path:e,documentType:a})},showFolderPicker:!1})},t.createNewFile=function(e){var r=e.userId,s=e.path,a=e.documentType;o.isMicrosoftFileType(a)?p({userId:r,path:s,documentType:a}):t.createNewCloudOnlyDoc({userId:r,pathName:s,title:"Untitled",documentType:a})};var p=function(e){var r=e.userId,o=e.path,s=e.documentType,a={fq_path:o,extension:s,_subject_uid:String(r),t:d.Cookies.read("__Host-js_csrf")},n=t.constructFormForCreateNewMicrosoftFile(a);document.body.appendChild(n),n.submit()};t.constructFormForCreateNewMicrosoftFile=function(e){var t=document.createElement("form");t.action="/ow/msft/create_new_file",t.method="POST",t.target="_blank";for(var r=0,o=Object.keys(e);r<o.length;r++){var s=o[r],a=document.createElement("input");a.type="hidden",a.name=s,a.value=e[s],t.appendChild(a)}return t},t.createNewCloudOnlyDoc=function(e){var t,r=e.userId,s=e.pathName,i=e.title,l=e.documentType;switch(l){case o.PaperFileTypes.PAPER:t="Paper doc";break;case o.GoogleFileTypes.GOOGLE_DSS_DOC:t="Google Docs";break;case o.GoogleFileTypes.GOOGLE_DSS_SHEET:t="Google Sheets";break;case o.GoogleFileTypes.GOOGLE_DSS_SLIDES:t="Google Slides";break;default:t="Cloud Doc"}a.Snackbar.sync(u._("Creating new %(type)s...").format({type:t}),!0),n.createCloudDoc({pathName:s,title:i,documentType:l,userId:r,onSuccess:function(e){var r=(e.changesets,e.createdFile);a.Snackbar.complete(u._("%(type)s created!").format({type:t})),c.redirect(r.preview_url)},onError:function(e){a.Snackbar.fail(e)}})}}),define("modules/clean/cloud_docs/new_file_menu",["require","exports","tslib","external/classnames","external/react","spectrum/icon_partners","spectrum/popover","spectrum/button","spectrum/tertiary_link","modules/clean/cloud_docs/constants","modules/clean/cloud_docs/create_api","modules/clean/react/browse/action_logger","modules/clean/web_user_action_events","modules/clean/react/css","modules/core/i18n"],function(e,t,r,o,s,a,n,i,l,c,d,u,p,h,_){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importDefault(o),s=r.__importStar(s);var m=_._("Google"),f=_._("Microsoft Office Online"),S=_._("Create in Microsoft Office Online"),g=_._("Create new file"),w=_._("Google Docs"),E=_._("Google Sheets"),v=_._("Google Slides"),F=_._("Excel workbook"),y=_._("PowerPoint presentation"),T=_._("Word document"),b=_._("Paper doc"),C=_._("Dropbox Paper");t.handleNewFileSelection=function(e){e.handleClick()};var A=function(e){switch(e){case c.MicrosoftFileTypes.WORD:return p.WebUserActionLogEvent.FILE_CREATE_WORD;case c.MicrosoftFileTypes.EXCEL:return p.WebUserActionLogEvent.FILE_CREATE_EXCEL;case c.MicrosoftFileTypes.POWERPOINT:return p.WebUserActionLogEvent.FILE_CREATE_POWERPOINT;case c.GoogleFileTypes.GOOGLE_DSS_DOC:return p.WebUserActionLogEvent.FILE_CREATE_GOOGLE_DOC;case c.GoogleFileTypes.GOOGLE_DSS_SHEET:return p.WebUserActionLogEvent.FILE_CREATE_GOOGLE_SHEET;case c.GoogleFileTypes.GOOGLE_DSS_SLIDES:return p.WebUserActionLogEvent.FILE_CREATE_GOOGLE_SLIDES;case c.PaperFileTypes.PAPER:return p.WebUserActionLogEvent.FILE_CREATE_PAPER}},R=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.renderIcon=function(){return s.createElement(a.IconPartners,{name:this.props.item.iconName,width:"24px",height:"24px"})},t.prototype.render=function(){return s.createElement(n.PopoverContentItem,{key:this.props.item.displayName,value:this.props.item,className:this.props.item.className},s.createElement("div",{className:"newfile-popover--item"},this.renderIcon(),s.createElement("div",{className:"newfile-popover--item-text"},this.props.item.displayName)))},t})(s.Component);t.NewFileTypeRow=R;var I=(function(e){function a(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleCreateNewFile=function(e){return function(){u.logFileCreateClick({uid:t.props.user.id,source:t.props.source,action:A(e)}),t.props.path?d.createNewFile({userId:t.props.user.id,path:t.props.path,documentType:e}):d.showAsyncFolderSelectorModal({user:t.props.user,source:t.props.source,documentType:e})}},t.logTriggerClick=function(){u.logFileCreateClick({uid:t.props.user.id,source:t.props.source,action:p.WebUserActionLogEvent.FILE_CREATE_OPEN_MENU})},t}return r.__extends(a,e),a.prototype.getNewFileTypeSections=function(){var e=[];this.props.showPaper&&e.push({title:C,items:[{displayName:b,iconName:"dropbox_paper",className:"action-create-file-paper-doc",handleClick:this.handleCreateNewFile(c.PaperFileTypes.PAPER)}]});var t=[];t.push({displayName:T,iconName:"microsoft_docx",className:"action-create-file-word",handleClick:this.handleCreateNewFile(c.MicrosoftFileTypes.WORD)}),t.push({displayName:F,iconName:"microsoft_xlsx",className:"action-create-file-excel",handleClick:this.handleCreateNewFile(c.MicrosoftFileTypes.EXCEL)}),t.push({displayName:y,iconName:"microsoft_pptx",className:"action-create-file-powerpoint",handleClick:this.handleCreateNewFile(c.MicrosoftFileTypes.POWERPOINT)});var r=!(this.props.showGdd||this.props.showPaper);if(e.push({title:r?S:f,items:t}),this.props.showGdd){var o=[];o.push({displayName:w,iconName:"google_gdoc",className:"action-create-file-google-doc",handleClick:this.handleCreateNewFile(c.GoogleFileTypes.GOOGLE_DSS_DOC)}),o.push({displayName:E,iconName:"google_gsheet",className:"action-create-file-google-sheet",handleClick:this.handleCreateNewFile(c.GoogleFileTypes.GOOGLE_DSS_SHEET)}),o.push({displayName:v,iconName:"google_gslides",className:"action-create-file-google-slides",handleClick:this.handleCreateNewFile(c.GoogleFileTypes.GOOGLE_DSS_SLIDES)}),e.push({title:m,items:o})}return e},a.prototype.renderTrigger=function(){return this.props.primaryButton?s.createElement(i.Button,{key:g,onClick:this.logTriggerClick,disabled:this.props.disabled,className:o.default("primary-action-menu__button","action-create-file"),tagName:"span"},g):s.createElement(l.TertiaryLink,{key:g,icon:"create",onClick:this.logTriggerClick,disabled:this.props.disabled,className:o.default("secondary-action-menu__button","action-create-file")},g)},a.prototype.renderSection=function(e){return s.createElement("div",{className:"newfile-popover--section",key:e.title},s.createElement("div",{className:"newfile-popover--title"},e.title),e.items.map(function(e){return s.createElement(R,{item:e,key:e.displayName})}))},a.prototype.render=function(){return s.createElement(n.Popover,{onSelection:t.handleNewFileSelection},s.createElement(n.PopoverTrigger,{disabled:this.props.disabled,className:"newfile-popover--trigger"},this.renderTrigger()),s.createElement(n.PopoverContent,{attachment:"right"},s.createElement("div",{className:"newfile-popover"},this.getNewFileTypeSections().map(this.renderSection))))},a})(s.Component),P=h.requireCssWithComponent(I,["/static/css/spectrum/index.web-vflsx5vgZ.css","/static/css/cloud_docs/new_file_menu-vfle33Fuy.css"]);t.NewFileMenu=P}),define("modules/clean/file_operations/notifications",["require","exports","tslib","external/lodash","modules/clean/browse_interface","modules/clean/em_string","modules/clean/filepath","modules/clean/react/browse/api","modules/clean/undo","modules/core/html","modules/core/i18n","modules/core/notify"],function(e,t,r,o,s,a,n,i,l,c,d,u){"use strict";function p(e,t,r,o,s){var a=function(){return i.rollbackChangeSets({changesets:r,userId:t.id,progressText:d._("Undoing…"),rollbackHints:o?o:void 0,onSuccess:function(){u.Notify.success(d._("Undo complete.")),s&&s()}})};l.notifyWithUndo(e,r,a)}function h(e,t){var r=s.browse_uri_for_fq_path(t,e),i=a.Emstring.em_snippet(n.filename(e),40);return{href:r,text:o.escape(i)}}function _(e,t,r,o,s,a){var n;if(o){var i=h(o,t);n=d.ungettext('Copied %(num_items)d item to <a href="%(dest_href)s">%(dest_name)s</a>.','Copied %(num_items)d items to <a href="%(dest_href)s">%(dest_name)s</a>.',e).format({num_items:e,dest_href:i.href,dest_name:i.text}),n=new c.HTML(n)}else n=d.ungettext("Copied %(num_items)d item.","Copied %(num_items)d items.",e).format({num_items:e});p(n,t,r,s,a)}function m(e,t,r,o,s,a){var n;if(o){var i=h(o,t);n=d.ungettext('Moved %(num_items)d item to <a href="%(dest_href)s">%(dest_name)s</a>.','Moved %(num_items)d items to <a href="%(dest_href)s">%(dest_name)s</a>.',e).format({num_items:e,dest_href:i.href,dest_name:i.text}),n=new c.HTML(n)}else n=d.ungettext("Moved %(num_items)d item.","Moved %(num_items)d items.",e).format({num_items:e});p(n,t,r,s,a)}function f(e,t,r,o,s){p(d.ungettext("Deleted %(num_items)d item.","Deleted %(num_items)d items.",e).format({num_items:e}),t,r,o,s)}function S(e,t,r,o){p(d._("Rename complete."),e,t,r,o)}function g(e,t,r){p(d._("Created folder %(folder_name)s.").format({folder_name:e}),t,r)}function w(e){var t=d.ungettext("Permanently deleted %(num)s item.","Permanently deleted %(num)s items.",e).format({num:e});u.Notify.success(t)}function E(e){var t,r=e.length;if(1===r){var s=o.escape(n.filename(e[0].fq_path));t=d._("Restored <strong>%(filename)s</strong>.").format({filename:s}),t=new c.HTML(t)}else t=d.ungettext("Restored %(num)s file.","Restored %(num)s files.",r).format({num:r});u.Notify.success(t)}Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),s=r.__importStar(s),n=r.__importStar(n),i=r.__importStar(i),l=r.__importStar(l),t.notifyCopySuccess=_,t.notifyMoveSuccess=m,t.notifyDeleteSuccess=f,t.notifyRenameSuccess=S,t.notifyFolderCreationSuccess=g,t.notifyPurgeSuccess=w,t.notifyRestoreSuccess=E}),define("modules/clean/illustration_helper",["require","exports","modules/clean/static_urls"],function(e,t,r){"use strict";function o(e){return r.static_url("/static/images/empty_states/"+e+".png")}Object.defineProperty(t,"__esModule",{value:!0}),t.empty_state_url=o}),define("modules/clean/pagination_manager",["require","exports","tslib","modules/clean/ajax","modules/core/i18n","modules/core/notify"],function(e,t,r,o,s,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o);var n=(function(){function e(e){this.hasMoreItems=e}return e.prototype.areAllItemsReady=function(){return!this.hasMoreItems},e.prototype.invalidateHasMore=function(){this.hasMoreItems=!0},e.prototype.addDataToAjax=function(e){},e})(),i=(function(){function e(e){this.ajaxURL=e.ajaxURL,this.newDataCallback=e.newDataAvailableCallback,this.autoFetching=!1,this.mode=e.mode,this.keyName=e.keyName,this.items={},this.pages=[],this.nextRequestVoucher=e.firstPage.next_request_voucher,this.userID=e.userID,this.fqPathPrefix=e.fqPathPrefix?"/"+e.fqPathPrefix:"",this.addPage(e.firstPage.items)}return e.prototype.areAllItemsReady=function(){return this.mode.areAllItemsReady()},e.prototype.addPage=function(e){for(var t=[],r=[],o=0,n=e;o<n.length;o++){var i=n[o],l=i[this.keyName];if(null==l)return void a.Notify.warning(s._("Invalid server response"));null==this.items[l]&&(this.items[l]=i,r.push(i),t.push(l))}this.pages.push(t),this.newDataCallback(this,r)},e.prototype.startAutoFetching=function(){this.autoFetching=!0,this.fetchNext()},e.prototype.stopAutoFetching=function(){this.autoFetching=!1},e.prototype.reSync=function(e){void 0===e&&(e=!1),e&&(this.nextRequestVoucher=null,this.items={},this.pages=[]);var t=this.autoFetching&&this.mode.areAllItemsReady();this.mode.invalidateHasMore(),t&&this.startAutoFetching()},e.prototype.fetchNext=function(){var e=this;if(!this.mode.areAllItemsReady()){var t={};this.nextRequestVoucher&&(t.voucher=this.nextRequestVoucher),this.mode.addDataToAjax(t),o.WebRequest({url:this.ajaxURL,data:t,subject_user:this.userID,success:function(t){var r=JSON.parse(t);e.nextRequestVoucher=r.next_request_voucher,e.mode.hasMoreItems=r.has_more_items,e.autoFetching&&e.fetchNext();for(var o=0,s=r.items;o<s.length;o++){var a=s[o];a.fq_path=e.fqPathPrefix+a.fq_path}e.addPage(r.items)},error:function(){a.Notify.error(s._("There was a problem completing this request."))}})}},e.prototype.loadedPageCount=function(){return this.pages.length},e.prototype.getLoadedPage=function(e){var t=this,r=this.pages[e];return null==r?null:r.map(function(e){return t.items[e]})},e.prototype.getLastLoadedPage=function(){return this.getLoadedPage(this.loadedPageCount()-1)},e})();t.BasePaginationManager=i;var l=(function(e){function t(t){return e.call(this,r.__assign({},t,{mode:new n(t.firstPage.has_more_items)}))||this}return r.__extends(t,e),t.create=function(e){return new t(e)},t})(i);t.PaginationManager=l}),define("modules/clean/react/app_actions/app_actions_store",["require","exports","tslib","modules/clean/filepath","modules/clean/api_v2/client"],function(e,t,r,o,s){"use strict";function a(e){return void 0!==e.ext}function n(e){return void 0!==e.fq_path}function i(e){return a(e)?e.ext:n(e)?"."+o.file_extension(o.filename(e.fq_path)):void 0}function l(){return d||(d=new c(new s.ApiV2Client)),d}Object.defineProperty(t,"__esModule",{value:!0});var c=(function(){function e(e){this.actionIdToAppAction={},this.client=e}return e.prototype.getActionsForFile=function(e,t){return r.__awaiter(this,void 0,void 0,function(){var o;return r.__generator(this,function(r){switch(r.label){case 0:return[4,this.getActionsForFileBatch([e],t)];case 1:return o=r.sent(),[2,o[e.file_id]]}})})},e.prototype.getActionsForFileBatch=function(e,t){return r.__awaiter(this,void 0,void 0,function(){return r.__generator(this,function(r){return[2,this.loadActionsByUser(e,t)]})})},e.prototype.loadActionsByUser=function(e,t){return r.__awaiter(this,void 0,void 0,function(){var o,s,a,n;return r.__generator(this,function(r){switch(r.label){case 0:this.stateRequest||(this.stateRequest=this.loadActions(t)),o=this.stateRequest,s={},r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.stateRequest];case 2:return a=r.sent(),e.forEach(function(e){var t=void 0,r=i(e);r&&(t=a.extToCategories[r]),t||!a.appActionsEnabled||e.is_dir||(t=[]),t&&(s[e.file_id]=t)}),[3,4];case 3:return n=r.sent(),o===this.stateRequest&&(this.stateRequest=void 0),[3,4];case 4:return[2,s]}})})},e.prototype.loadActions=function(e){return r.__awaiter(this,void 0,void 0,function(){var t,o,s=this;return r.__generator(this,function(r){switch(r.label){case 0:return[4,this.client.ns("app_actions").rpc("get_available_actions_for_user",void 0,{subjectUserId:e})];case 1:return t=r.sent(),t.actions.forEach(function(e){s.actionIdToAppAction[e.id]||(s.actionIdToAppAction[e.id]=e)}),o={},t.exts_to_action_ids.forEach(function(e){var t={},r=[];e.action_ids.forEach(function(e){var o=s.actionIdToAppAction[e],a=t[o.category];a?a.actions.push(o):(a={categoryId:o.category,actions:[o]},t[o.category]=a,r.push(a))}),r=r.map(function(e){return{categoryId:e.categoryId,actions:s.prioritizeActions(e.actions)}}),r.sort(function(e,t){return e.categoryId<t.categoryId?-1:t.categoryId<e.categoryId?1:0}),o[e.ext]=r}),[2,{appActionsEnabled:t.app_actions_enabled,extToCategories:o}]}})})},e.prototype.prioritizeActions=function(e){return e.sort(function(e,t){return e.priority&&t.priority?t.priority-e.priority:e.priority?-1:t.priority?1:e.description<t.description?-1:e.description>t.description?1:0})},e})();t.AppActionsStore=c;var d;t.getAppActionsStore=l});var __importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};define("modules/clean/react/async_fileops_modals",["require","exports"],function(e,t){"use strict";function r(t){new Promise(function(t,r){e(["modules/clean/react/fileops_modals"],t,r)}).then(__importStar).then(t)}function o(e){r(function(t){return(0,t.showCopy)(e)})}function s(e){r(function(t){return(0,t.showMove)(e)})}function a(e){r(function(t){return(0,t.showUpload)(e)})}function n(e){r(function(t){return(0,t.showAdminUpload)(e)})}function i(t){new Promise(function(t,r){e(["modules/clean/react/folder_dialog/move_dialog_modal"],t,r)}).then(__importStar).then(function(e){return e.MoveDialogModal.show(t)})}Object.defineProperty(t,"__esModule",{value:!0}),t.showCopy=o,t.showMove=s,t.showUpload=a,t.showAdminUpload=n,t.showMoveDialog=i});var __importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};define("modules/clean/react/async_folder_selector_modal",["require","exports"],function(e,t){"use strict";function r(t){new Promise(function(t,r){e(["modules/clean/react/folder_selector_modal"],t,r)}).then(__importStar).then(function(e){e.FolderSelectorModal.show(t)})}Object.defineProperty(t,"__esModule",{value:!0}),t.show=r});var __importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};define("modules/clean/react/async_onboarding_move_modal",["require","exports"],function(e,t){"use strict";function r(t){new Promise(function(t,r){e(["modules/clean/react/onboarding_folder_dialog/onboarding_move_dialog"],t,r)}).then(__importStar).then(t)}function o(e){r(function(t){return(0,t.showMove)(e)})}Object.defineProperty(t,"__esModule",{value:!0}),t.showOnboardingMoveDialog=o}),define("modules/clean/react/browse/actions",["require","exports","tslib","external/lodash","modules/clean/browse_interface","modules/clean/downloads","modules/clean/file_operations/notifications","modules/clean/filepath","modules/clean/history","modules/clean/react/fileops_actions","modules/clean/react/async_file_modal_controller","modules/clean/react/browse/api","modules/clean/react/browse/constants","modules/clean/react/browse/dispatcher","modules/clean/react/browse/models","modules/clean/react/browse/nav_actions","modules/clean/react/browse/store","modules/constants/python","modules/core/browser","modules/core/html","modules/core/i18n","modules/core/notify","modules/clean/search/constants","modules/clean/react/file_viewer/async_controller","modules/clean/search/search_results/dispatcher","modules/clean/react/files_view/types","modules/clean/user_education/user_education_client","modules/clean/sharing/browse_exports"],function(e,t,r,o,s,a,n,i,l,c,d,u,p,h,_,m,f,S,g,w,E,v,F,y,T,b,C,A){"use strict";function R(){return e("modules/clean/react/file_viewer/controller")}function I(){return e.defined("modules/clean/react/file_viewer/controller")}Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),s=r.__importStar(s),a=r.__importStar(a),n=r.__importStar(n),i=r.__importStar(i),l=r.__importDefault(l),c=r.__importStar(c),d=r.__importStar(d),u=r.__importStar(u),g=r.__importStar(g),F=r.__importStar(F);var P=(function(){function e(e){var o=this;this.nameNewFolder=function(){h.BrowseDispatcher.dispatch({type:p.BrowseActionType.REQUEST_FOLDER_NAME})},this.showTimeline=function(){h.BrowseDispatcher.dispatch({type:p.BrowseActionType.SHOW_TIMELINE})},this.hideTimeline=function(){h.BrowseDispatcher.dispatch({type:p.BrowseActionType.HIDE_TIMELINE})},this.createFolderPending=function(){h.BrowseDispatcher.dispatch({type:p.BrowseActionType.CREATE_FOLDER_PENDING})},this.cancelCreateFolder=function(){h.BrowseDispatcher.dispatch({type:p.BrowseActionType.CANCEL_CREATE_FOLDER}),window.setTimeout(function(){C.UEClient.sendEvent("CdmNewFolderModal","maybeFinished")},2500)},this.createFolderComplete=function(e){var t=e.folderName,r=e.user,o=e.changesets;h.BrowseDispatcher.dispatch({type:p.BrowseActionType.CREATE_FOLDER_COMPLETE}),n.notifyFolderCreationSuccess(t,r,o),window.setTimeout(function(){C.UEClient.sendEvent("CdmNewFolderModal","maybeFinished")},2500)},this.createFolder=function(e){var t=e.folderName,s=e.pathName,a=e.nsId,n=void 0===a?null:a,l=e.checkFSWs,c=e.showShareModalOnSuccess,u=e.redirectOnSuccess,p=f.getBrowseStore().user();o.createFolderPending(),o.dataApi.createNewFolder({pathName:s,folderName:t,nsId:n,checkFSWs:l,userId:p.id,onSuccess:function(s){var a=s.changesets,n=s.createdFolder,l=s.failureDetails;if(l){var h=function(){o.createFolder(r.__assign({},e,{checkFSWs:!1}))};d.showFileSystemWarningsModal({fsws:l,onFinalAccept:h,confirmText:E._("Create folder"),onAbortAction:o.cancelCreateFolder})}else{var _=n?i.filename(n.fq_path):t;o.createFolderComplete({user:p,folderName:_,changesets:a}),n&&(o.selectRowsFromBoltClient([n]),u&&u(n.fq_path),c&&o.handleShowShareModal(n,"browse_new_folder_modal"))}},onError:o.cancelCreateFolder})},this.createFolderInNewFolderModal=function(e){var r=e.folderName,s=e.isConfidential,a=e.user,n=e.context;s&&!n.isInsideTeamFolderTree?A.asyncShowNewFolderShareModal(a,null,n.currentFQPath,r,!1,!1,null,m.browseNavActions.setPath,m.browseNavActions.setUrl):t.browseActions.createFolder({pathName:n.currentFQPath,folderName:r,nsId:n.rootNSID,checkFSWs:!0,showShareModalOnSuccess:(a.is_cdm_member||s)&&n.isInsideTeamFolderTree,redirectOnSuccess:o.handleNewFolderRedirectOnSuccess})},this.handleNewFolderRedirectOnSuccess=function(e){m.browseNavActions.setUrl({path:e})},this.doDeleteFilesWithModal=function(e){var t=e.files,r=f.getBrowseStore(),s=r.user(),a=r.context();d.showDelete(s,t,a,i.filename(a.currentFQPath),function(){o.dataApi.deleteFiles({files:t,userId:s.id,onSuccess:function(e){var r=e.changesets,a=e.rollbackHints,i=e.fileDeltas;T.SearchResultsDispatcher.dispatch({type:F.CHANGE_FILES_ACTION,data:{fileDeltas:i.filter(function(e){return!!e.before}).map(function(e){return{before:e.before.fq_path,after:null}})}}),n.notifyDeleteSuccess(t.length,s,r,a,function(){o.selectRowsFromBoltClient(t),T.SearchResultsDispatcher.dispatch({type:F.CHANGE_FILES_ACTION,data:{fileDeltas:i.filter(function(e){return!!e.before}).map(function(e){return{before:null,after:e.before}})}})})}})})},this.onPurgeSuccessCallback=function(e){n.notifyPurgeSuccess(e.length),t.browseActions.reloadCurrentPath(),T.SearchResultsDispatcher.dispatch({type:F.CHANGE_FILES_ACTION,data:{fileDeltas:e.map(function(e){return{before:e.fq_path,after:null}})}})},this.onPurge=function(e,t){o.dataApi.purgeFiles({files:t,userId:e,onSuccess:o.onPurgeSuccessCallback})},this.doPermanentDeleteWithModal=function(e){var t=e.files,r=f.getBrowseStore(),s=r.user(),a=r.context();d.showPurgeModal({userId:s.id,context:a,files:t,onPurge:o.onPurge})},this.onRestore=function(e,t,r){o.dataApi.restoreFiles({files:t,userId:e,onSuccess:function(){n.notifyRestoreSuccess(t)},isSearchMode:r})},this.doRestoreFilesWithUnifiedTrashModal=function(e){var t=e.files,r=f.getBrowseStore(),s=r.user(),a=r.context();d.showUnifiedTrashModal({userId:s.id,context:a,files:t,onRestore:function(e,t){o.onRestore(e,t,!1)}})},this.dataApi=e}return e.prototype.appInit=function(e){var t=e.experiments,r=e.shouldShowDeletedFiles,o=e.user,s=e.viewer;h.BrowseDispatcher.dispatch({type:p.BrowseActionType.APP_INIT,data:{experiments:t,shouldShowDeletedFiles:r,user:o,viewer:s}})},e.prototype.initializeEverything=function(e){var t=e.path,r=e.files,o=e.paginatedTotalNumFiles,s=e.context,a=e.mountPoints,n=e.fqPathsToSelect,i=e.loadingState,l=e.teamFolders;h.BrowseDispatcher.dispatch({type:p.BrowseActionType.INITIALIZE_EVERYTHING,data:{path:t,files:r,paginatedTotalNumFiles:o,context:s,mountPoints:a,fqPathsToSelect:n,loadingState:i,teamFolders:l}})},e.prototype.load=function(e){var t=e.path,r=e.files,o=e.paginatedTotalNumFiles,s=e.context;m.browseNavActions.load({path:t,files:r,paginatedTotalNumFiles:o,context:s})},e.prototype.addFilesAndSetLoadingState=function(e){var t=e.path,r=e.loadingState,o=e.files,s=e.paginatedTotalNumFiles;m.browseNavActions.addFilesAndSetLoadingState({path:t,loadingState:r,files:o,paginatedTotalNumFiles:s})},e.prototype.setMountPoints=function(e){var t=e.mountPoints;m.browseNavActions.setMountPoints({mountPoints:t})},e.prototype.setPath=function(e){var t=e.path,r=e.onPathLoaded,o=e.logFetchedDataRequiredForTTI,s=void 0!==o&&o,a=e.ajaxWebTimer;m.browseNavActions.setPath({path:t,onPathLoaded:r,logFetchedDataRequiredForTTI:s,ajaxWebTimer:a})},e.prototype.reloadCurrentPath=function(){var e=f.getBrowseStore();this.setPath({path:e.path()})},e.prototype.updatePreview=function(e){var t=e.files;I()&&R().updateFiles(t)},e.prototype.closeFileViewer=function(){I()&&R().close()},e.prototype.setUrl=function(e){var t=e.path,r=e.qargs;m.browseNavActions.setUrl({path:t,qargs:r})},e.prototype.copyFilesToClipboard=function(e){if(e.length){if(e.some(function(e){return e.isDeleted}))return void v.Notify.error(E._("Deleted files cannot be added to the clipboard"));if(e.some(_.File.isTeamSharedFolder))return void v.Notify.error(E._("Team Folders can’t be copied."));var t=E.ungettext("Added %(num_items)s item to clipboard","Added %(num_items)s items to clipboard",e.length).format({num_items:e.length});v.Notify.success(t),h.BrowseDispatcher.dispatch({type:p.BrowseActionType.COPY_FILES_TO_CLIPBOARD,data:{files:e}})}},e.prototype.pasteClipboardFilesToCurrentPath=function(){c.copyFiles({user:f.getBrowseStore().user(),files:f.getBrowseStore().clipboardFiles(),newPath:f.getBrowseStore().path(),checkFSWs:!0,dataApi:this.dataApi})},e.prototype.selectRowsFromBoltClient=function(e){void 0===e&&(e=[]),this.setFilePathsToSelectOnNextUpdate({fqPathsToSelect:e.map(function(e){return e.fq_path})})},e.prototype.setFilePathsToSelectOnNextUpdate=function(e){var t=e.fqPathsToSelect;h.BrowseDispatcher.dispatch({
type:p.BrowseActionType.SET_FILE_PATHS_TO_SELECT_ON_NEXT_UPDATE,data:{fqPathsToSelect:t}})},e.prototype.addFileJumpKeyCode=function(e){var t=e.keyChar;h.BrowseDispatcher.dispatch({type:p.BrowseActionType.ADD_FILE_JUMP_KEY_CODE,data:{keyChar:t}})},e.prototype.resetFileJump=function(){h.BrowseDispatcher.dispatch({type:p.BrowseActionType.RESET_FILE_JUMP})},e.prototype.setBrowsePostTTIExperiments=function(e){var t=e.browsePostTTIExperiments;h.BrowseDispatcher.dispatch({type:p.BrowseActionType.SET_BROWSE_POST_TTI_EXPERIMENTS,data:{browsePostTTIExperiments:t}})},e.prototype.copyFiles=function(e){c.copyFiles(e)},e.prototype.moveFiles=function(e){c.moveFiles(e)},e.prototype.showFileRename=function(e){var t=e.file;h.BrowseDispatcher.dispatch({type:p.BrowseActionType.REQUEST_NEW_FILE_NAME,data:{file:t}})},e.prototype.cancelFileRename=function(e){var t=e.file;h.BrowseDispatcher.dispatch({type:p.BrowseActionType.CANCEL_FILE_RENAME,data:{file:t}})},e.prototype.setFileRenameComplete=function(e){var t=e.file;h.BrowseDispatcher.dispatch({type:p.BrowseActionType.SET_FILE_RENAME_COMPLETE,data:{file:t}})},e.prototype.renameFile=function(e){var t=this,r=e.file,o=e.newName,s=e.isSearchMode;h.BrowseDispatcher.dispatch({type:p.BrowseActionType.SET_FILE_RENAME_PENDING,data:{file:r}});var a=f.getBrowseStore().user();this.dataApi.renameFile({file:r,newName:o,userId:a.id,onSuccess:function(e){var o=e.renamedFile,i=e.changesets,l=e.rollbackHints;n.notifyRenameSuccess(a,i,l,function(){t.selectRowsFromBoltClient([r])}),t.setFileRenameComplete({file:r}),s&&T.SearchResultsDispatcher.dispatch({type:F.CHANGE_FILES_ACTION,data:{fileDeltas:[{before:r.fq_path,after:r.is_dir?o.set("icon",r.icon):o}]}}),t.selectRowsFromBoltClient([o])},onError:function(){t.cancelFileRename({file:r})}})},e.prototype.applyFileDeltas=function(e){var t=e.path,r=e.fileDeltas;h.BrowseDispatcher.dispatch({type:p.BrowseActionType.CHANGE_FILES,data:{path:t,fileDeltas:r}})},e.prototype.openLocalCopy=function(e){var t=e.fqPath,r=e.nsId,o=e.userId,s=e.onSuccess,a=e.onError;this.dataApi.openLocalCopy({nsId:r,fqPath:t,userId:o,onSuccess:s,onError:a})},e.prototype.getMountPointUpdateForCurrentPath=function(e){var t,r,s=f.getBrowseStore().path(),a=f.getBrowseStore().mountPoints(),n=a?a.toJS():{},i=function(e){return e===s},l=parseInt(o.findKey(n,i),10);if(l)t=e[l]||null,r=n[l]||null;else{r=null;t=!!o.findKey(e,i)?s:null}return[r,t]},e.prototype.getPathForNewMountPoint=function(e,t){return e&&!t?f.getBrowseStore().path():e&&t?i.paths_are_equal(e,t)?null:t:!e&&t?f.getBrowseStore().path():null},e.prototype.showUserNotificationForPathChange=function(e,t){function r(e){return o.escape(i.filename(e))}function a(e){v.Notify.success(new w.HTML(e))}function n(e){v.Notify.error(new w.HTML(e))}var l=t.old_fq_path,c=s.get_browse_root(e)+t.new_fq_path,d=!t.is_changing_view,u=null!=t.change_type?t.change_type.toLowerCase():null;if("moved"===u)if(d)a(E._("This folder has been moved"));else{var p=E._('The folder ‘%(folder_name)s’ has been moved. <a href="%(href)s">View</a>').format({folder_name:r(l),href:o.escape(c)});n(p)}else if("renamed"===u)if(d){var p=E._("This folder has been renamed to ‘%(folder_name)s’").format({folder_name:r(t.change_to_fq_path)});a(p)}else{var p=E._('The folder ‘%(folder_name)s’ has been renamed. <a href="%(href)s">View</a>').format({folder_name:r(l),href:o.escape(c)});n(p)}else if("deleted"===u){var p=E._("The folder ‘%(folder_name)s’ has been deleted").format({folder_name:r(l)});n(p)}},e.prototype.computeAndApplyDeltasFromBoltClient=function(e){var t=e.path,r=e.payload,o=r.added,s=r.moved,a=r.removed,n=r.mount_points,i=r.parent_changes;if(i&&i.change_to_fq_path){var l=f.getBrowseStore().user();return this.showUserNotificationForPathChange(l,i),void this.setUrl({path:i.change_to_fq_path})}var c=this.getMountPointUpdateForCurrentPath(n),d=c[0],u=c[1];d&&!u&&v.Notify.success(E._("The folder was unshared."));var p=this.getPathForNewMountPoint(d,u);if(p)return void this.setPath({path:p});this.setMountPoints({mountPoints:n});for(var h=f.getBrowseStore().filesMap(),m=[],S=0,g=o;S<g.length;S++){var w=g[S],F=null,y=_.File.fromServerObject(w);m.push({before:F,after:y})}for(var T=0,b=s;T<b.length;T++){var C=b[T],A=C[0],w=C[1],F=h.get(A,null),y=_.File.fromServerObject(w);m.push({before:F,after:y})}for(var R=0,I=a;R<I.length;R++){var P=I[R],F=h.get(P,null),y=null;m.push({before:F,after:y})}this.applyFileDeltas({path:t,fileDeltas:m})},e.prototype.setSelection=function(e){var t=e.selection;h.BrowseDispatcher.dispatch({type:p.BrowseActionType.SET_SELECTION,data:{selection:t}})},e.prototype.selectFilesAfterUpload=function(e){var t=e.fqPathsToSelect;h.BrowseDispatcher.dispatch({type:p.BrowseActionType.SELECT_FILES_AFTER_UPLOAD,data:{fqPathsToSelect:t}})},e.prototype.selectFilesByFqPath=function(e){var t=e.fqPathsToSelect;h.BrowseDispatcher.dispatch({type:p.BrowseActionType.SELECT_FILES_BY_FQ_PATH,data:{fqPathsToSelect:t}})},e.prototype.navigateToFileOrFolder=function(e){var t=e.file,r=e.shouldFocusComment,o=void 0!==r&&r,s=e.shouldPrepareForSignature,a=void 0!==s&&s,n=e.onFileViewerUnmount,i=e.fileViewAction,l=void 0===i?S.FileViewActionType.CLICK:i,c=e.fileViewOrigin,p=void 0===c?S.FileViewOriginType.BROWSE:c,h=f.getBrowseStore().user(),m=f.getBrowseStore().context();t.isDeleted?this.doRestoreFilesWithUnifiedTrashModal({files:[t]}):t.is_dir?_.File.isNoAccessSharedFolder(t)?d.showNoAccess(h,t,m):this.setUrl({path:t.fq_path}):this.openPreviewForBrowseFile(t,o,a,h,l,p,function(e){return u.fetchPreviewData(e,h)},n)},e.prototype.openPreviewForBrowseFile=function(e,t,r,o,s,a,n,i){var l=f.getBrowseStore().getIndexOfFile(e),c=l<0?[e]:f.getBrowseStore().files().toArray();if(l<0?l=0:c[l]=e,e.is_cloud_doc&&n){var d=window.open("about:blank","_blank");n(e).then(function(e){e.preview_url&&null!==d&&g.redirect(e.preview_url,d)})}else{var u=function(){y.showElementsBehindFileViewer(),i&&i()};y.asyncOpenPreview({containerId:p.BROWSE_FILE_VIEWER_ELEMENT_ID,files:c,indexOfPreviewFile:l,shouldFocusComment:t,user:o,onFileViewerDidMount:y.hideElementsBehindFileViewer,onFileViewerUnmount:u,fileViewAction:s,fileViewOrigin:a,fileViewTarget:S.FileViewTargetType.PRIVATE,filePreviewDataFetcher:n,shouldPrepareForSignature:r})}},e.prototype.navigateToResultObjectParentFolder=function(e){var t=e.file,r=e.fileViewAction;void 0===r&&S.FileViewActionType.CLICK;if(_.File.isNoAccessSharedFolder(t))d.showNoAccess(f.getBrowseStore().user(),t,f.getBrowseStore().context());else{var o=i.parent_dir(t.fq_path);this.setUrl({path:o})}},e.prototype.navigateToParentFolder=function(){var e=i.parent_dir(f.getBrowseStore().path());this.setUrl({path:e})},e.prototype.setShouldShowDeletedFiles=function(e){var t=e.shouldShowDeletedFiles,r=e.shouldReloadFolder,o=void 0===r||r,s=e.shouldUpdateUrl,a=void 0===s||s;h.BrowseDispatcher.dispatch({type:p.BrowseActionType.SET_SHOULD_SHOW_DELETED_FILES,data:{shouldShowDeletedFiles:t}}),o&&this.reloadCurrentPath(),a&&(t?l.default.update_query_param(p.BrowseQueryArg.d,"1"):l.default.remove_query_param(p.BrowseQueryArg.d))},e.prototype.sortFiles=function(e){var t=e.sortField,r=e.sortDirection;h.BrowseDispatcher.dispatch({type:p.BrowseActionType.SORT_FILES,data:{sortField:t,sortDirection:r}})},e.prototype.setViewType=function(e){var t=e.viewType,r=e.isSearchMode;h.BrowseDispatcher.dispatch({type:p.BrowseActionType.SET_VIEW_TYPE,data:{viewType:t,isSearchMode:r}})},e.prototype.setColumnDependentCapabilities=function(e){var t=e.canDisplayFolderSizes;h.BrowseDispatcher.dispatch({type:p.BrowseActionType.SET_COLUMN_DEPENDENT_CAPABILITIES,data:{canDisplayFolderSizes:t}})},e.prototype.setColumnConfiguration=function(e){var t=e.columns,r=e.viewType,o=e.canDisplayFolderSizes;h.BrowseDispatcher.dispatch({type:p.BrowseActionType.SET_COLUMN_CONFIGURATION,data:{columns:t,viewType:r,canDisplayFolderSizes:o}})},e.prototype.downloadFiles=function(e){var t=e.files,r=e.context,o=e.user;if(1===t.count()&&!t.first().is_dir)return void a.get_blockserver_link({url:t.first().direct_blockserver_link});if(r.blockHash){var s=r.currentFQPath,n=t.toArray().map(function(e){return e.fq_path});a.get_zip({fq_paths:n,subject_uid:o.id,block_hash:r.blockHash,parent_path:s})}},e.prototype.setDataApi=function(e){this.dataApi=e,m.browseNavActions.setDataApi(e)},e.prototype.fetchFolderSizes=function(e){var t=e.file;return r.__awaiter(this,void 0,void 0,function(){var e,o,s,a,n,i,l,c,d;return r.__generator(this,function(r){switch(r.label){case 0:e=f.getBrowseStore().user(),o=p.MAX_FOLDER_SIZE_ITERATIONS,r.label=1;case 1:return r.trys.push([1,7,,8]),h.BrowseDispatcher.dispatch({type:p.BrowseActionType.REQUEST_FETCH_FOLDER_SIZES,data:{fqPath:t.fq_path}}),[4,this.dataApi.fetchSharedFolderSizes(e.id,{fq_path:t.fq_path})];case 2:return s=r.sent(),h.BrowseDispatcher.dispatch({type:p.BrowseActionType.FETCHED_FOLDER_SIZES,data:{fqPath:t.fq_path,resp:s}}),a=[],[4,this.fetchAndSetSameNamespaceFolderSize(e.id,{fq_path:t.fq_path,folder_limit:p.MAX_FOLDERS_PER_CALL})];case 3:n=r.sent(),n.queue&&(a=a.concat(n.queue)),r.label=4;case 4:return a.length>0&&o>0?(o--,i=Math.min(p.MAX_FOLDER_SIZE_QUEUE_SIZE,a.length),l=a.splice(0,i),[4,this.fetchAndSetSameNamespaceFolderSize(e.id,{fq_path:t.fq_path,folder_limit:p.MAX_FOLDERS_PER_CALL,queue:l})]):[3,6];case 5:return n=r.sent(),n.queue&&a&&(a=a.concat(n.queue)),[3,4];case 6:return c=0!==o&&n.queue&&0===n.queue.length?b.FetchFolderSizeState.COMPLETE:b.FetchFolderSizeState.ERROR,h.BrowseDispatcher.dispatch({type:p.BrowseActionType.COMPLETE_FETCH_FOLDER_SIZES,data:{state:c}}),[3,8];case 7:return d=r.sent(),h.BrowseDispatcher.dispatch({type:p.BrowseActionType.COMPLETE_FETCH_FOLDER_SIZES,data:{state:b.FetchFolderSizeState.ERROR}}),[3,8];case 8:return[2]}})})},e.prototype.fetchAndSetSameNamespaceFolderSize=function(e,t){return r.__awaiter(this,void 0,void 0,function(){var o;return r.__generator(this,function(r){switch(r.label){case 0:return[4,this.dataApi.fetchSameNamespaceFolderSizes(e,t)];case 1:return o=r.sent(),h.BrowseDispatcher.dispatch({type:p.BrowseActionType.FETCHED_FOLDER_SIZES,data:{fqPath:t.fq_path,resp:o}}),[2,o]}})})},e.prototype.handleShowShareModal=function(e,t){var r=f.getBrowseStore(),o=r.user(),s=r.context();A.asyncShowShareModal(o,e,{browseContext:s,origin:t},m.browseNavActions.setPath,m.browseNavActions.setUrl)},e.prototype.handleShowShareInterstitialModal=function(e,t,r,o,s){var a=f.getBrowseStore(),n=a.user(),i=a.context();A.expAsyncShowShareInterstitialModal(n,e,r,o,s,{browseContext:i,origin:t},m.browseNavActions.setPath,m.browseNavActions.setUrl)},e})();t.browseActions=new P(u)}),define("modules/clean/react/browse/api",["require","exports","tslib","external/lodash","modules/clean/ajax","modules/clean/api_v2/client","modules/clean/api_v2/root_aware_client","modules/clean/react/browse/models","modules/core/i18n","modules/core/notify","modules/core/uri"],function(e,t,r,o,s,a,n,i,l,c,d){"use strict";function u(e){try{return JSON.parse(e)}catch(e){if(!(e instanceof SyntaxError))throw e}return null}function p(e){var t=e.sortLabel,r=e.sortIsAscending,o=e.path,a=e.userId,n=e.onSuccess,i=e.includeDeletedFiles,l=void 0!==i&&i,c=e.sortFoldersFirst,d=void 0===c||c,p=e.onError;return s.WebRequest({data:{sort_label:t,sort_is_ascending:r.toString(),show_deleted:l||"",sort_folders_first:d,include_file_info:"True",path2:o},url:"/browse",subject_user:a,success:function(e,t,r){var s=u(e);s&&n({path:o,data:s,xhr:r})},error:function(e,t,r){p&&p(e,t,r)}})}function h(e){var t=e.files,r=e.newPath,a=e.userId,n=e.onSuccess,d=e.checkFSWs,u=t.map(function(e){return e.fq_path});return u.includes(r)?(c.Notify.error(l._("You can’t copy a folder into itself.")),null):s.WebProgressRequest({url:"/cmd/copy",data:{files:u,to_path:r,fsw_request:d?"check":void 0},subject_user:a,progress_text:l._("Copying files..."),success:function(e){try{var t=o.isString(e)?JSON.parse(e):e;n({newFiles:t.new_browse_files?t.new_browse_files.map(i.File.fromServerObject):[],destinationPath:r,changesets:t.changesets,rollbackHints:t.rollback_hints,failureDetails:t.failure_details})}catch(e){}}})}function _(e){var t=e.files,r=e.userId,a=e.onSuccess,n=t.map(function(e){return e.fq_path});return s.WebProgressRequest({url:"/cmd/delete",data:{files:n},subject_user:r,progress_text:l._("Deleting files..."),success:function(e){try{var r=o.isString(e)?JSON.parse(e):e;a({fileDeltas:t.map(function(e){return{before:e,after:null}}),changesets:r.changesets,rollbackHints:r.rollback_hints})}catch(e){}}})}function m(e){var t=e.path,r=e.files,a=e.newPath,n=e.userId,d=e.onSuccess,u=e.allowOwnershipTransfer,p=e.checkFSWs;if(t===a)return c.Notify.error(l._("Those files already exist in that folder.")),null;var h=r.map(function(e){return e.fq_path});return h.includes(a)?(c.Notify.error(l._("You can’t move a folder into itself.")),null):s.WebProgressRequest({url:"/cmd/move",data:{files:h,to_path:a,allow_ownership_transfer:u,fsw_request:p?"check":void 0},subject_user:n,progress_text:l._("Moving files..."),skipNotifyError:!u,success:function(e){try{var r=o.isString(e)?JSON.parse(e):e;d({path:t,destinationPath:a,newFiles:r.new_browse_files?r.new_browse_files.map(i.File.fromServerObject):[],changesets:r.changesets,rollbackHints:r.rollback_hints,failureDetails:r.failure_details})}catch(e){}},error:function(t,r,o){c.Notify.error(o),e.onError&&e.onError(o)}})}function f(e){var t=e.file,r=e.newName,o=e.userId,a=e.onSuccess,n=e.onError;return s.WebRequest({url:new d.URI({path:"/cmd/rename"+t.fq_path}).toString(),subject_user:o,data:{to_path:r},success:function(e,r,o){var s=u(e);if(s){var i=t.merge(s.new_browse_files[0]);a({changesets:s.changesets,renamedFile:i,rollbackHints:s.rollback_hints})}else n&&n()},error:n})}function S(e){var t=e.files,r=e.userId,o=e.onSuccess,a=e.isSearchMode;return s.WebProgressRequest({url:"/cmd/restore",data:{files:t.map(function(e){return e.fq_path}),source:a?"search":"browse"},subject_user:r,dataType:"json",progress_text:l._("Restoring…"),success:function(){o()}})}function g(e){var t=e.files,r=e.userId,o=e.onSuccess,a=e.progressText,n=void 0===a?l._("Deleting…"):a;return s.WebProgressRequest({url:"/cmd/purge",data:{files:t.map(function(e){return e.fq_path})},subject_user:r,dataType:"text",progress_text:n,success:function(e){var r=u(e);r&&"success"===r.status&&o(t)}})}function w(e){var t=e.userId,r=e.changesets,o=void 0===r?null:r,a=e.progressText,n=e.rollbackHints,i=void 0===n?{}:n,l=e.onSuccess;return s.WebProgressRequest({url:"/cmd/rollback",data:{ns_to_cs:JSON.stringify(o),rollback_hints:JSON.stringify(i)},subject_user:t,progress_text:a,success:function(){l()}})}function E(e){var t=e.pathName,r=e.folderName,o=e.userId,a=e.onSuccess,n=e.onError,l=e.checkFSWs;return s.WebProgressRequest({url:new d.URI({path:"/cmd/new"+t}).toString(),data:{to_path:r,folder:"yes",fsw_request:l?"check":void 0},subject_user:o,success:function(e){var t=u(e);if(t){var r=t.new_browse_files?i.File.fromServerObject(t.new_browse_files[0]):null;a({changesets:t.changesets,createdFolder:r,failureDetails:t.failure_details})}},error:function(){n()}})}function v(e){var t=e.pathName,r=e.title,o=e.documentType,a=e.userId,n=e.onSuccess,l=e.onError,c=(t+"/"+r+"."+o).replace("//","/");return s.WebRequest({url:new d.URI({path:"/cmd/create_cloud_doc"}).toString(),subject_user:a,data:{to_path:c,title:r},success:function(e){var t=u(e);if(t){n({changesets:null,createdFile:i.File.fromServerObject(t.new_browse_files[0])})}},error:function(e,t,r){l(r)},skipNotifyError:!0})}function F(e){var t=e.path,r=e.userId,a=e.namespaceToJournalIdMap,n=e.onSuccess,i=e.includeDeletedFiles,l="/"===t?"":t,c={fq_dir:l,ns_map:o.map(a,function(e,t){return t+"_"+e}).join(","),show_deleted:!!i};return s.WebRequest({url:"/update/list_dir",subject_user:r,data:c,dataType:"text",success:function(e){var t=u(e);t&&n(t)}})}function y(e,t){if(!R(e))return Promise.resolve(e);var o=[[e.ns_id,e.sjid,e.fq_path.substr(0,e.fq_path.length-e.ns_path.length)]];return new Promise(function(a,n){s.WebRequest({data:{nsid_sjid_fq_mount_point_tuples:JSON.stringify(o)},url:"/browse_file_info",dataType:"json",subject_user:t,success:function(t,o,s){var n=t.file_results[0];a(r.__assign({},e,n))},error:function(e,t,r){n(r)}})})}function T(e,t){return(new a.ApiV2Client).ns("folders").rpc("get_shared_subfolder_sizes",t,{subjectUserId:e})}function b(e,t){return(new a.ApiV2Client).ns("folders").rpc("get_subfolder_sizes_in_same_namespace",t,{subjectUserId:e})}function C(e,t){return(new n.ApiV2RootAwareClient).ns("ml").rpc("get_folder_suggestion",{paths:t,action:"MOVE"},{subjectUserId:e})}function A(t){var o=t.fqPath,s=t.nsId,a=t.userId,n=t.onSuccess,i=t.onError;new Promise(function(t,r){e(["modules/clean/unity/features"],t,r)}).then(r.__importStar).then(function(e){e.default.open_file(s,o,a,n,i,!1)})}Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),s=r.__importStar(s),t.loadPath=p,t.copyFiles=h,t.deleteFiles=_,t.moveFiles=m,t.renameFile=f,t.restoreFiles=S,t.purgeFiles=g,t.rollbackChangeSets=w,t.createNewFolder=E,t.createCloudDoc=v,t.getChangesForDirectory=F;var R=function(e){return e.is_cloud_doc||!(e.event_type||e.preview_url||e.preview_thumbnail_url||e.preview_type||e.linkfile_data||e.htmlified_link||e.preview_ssr_image_url_tmpl||e.preview_ssr_refresh_url||e.preview_ssr_text_url_tmpl)};t.fetchPreviewData=y,t.fetchSharedFolderSizes=T,t.fetchSameNamespaceFolderSizes=b,t.fetchMoveSuggestion=C,t.openLocalCopy=A}),define("modules/clean/react/browse/browse",["require","exports","tslib","external/react","external/react-dom","external/lodash","modules/clean/em_string","modules/clean/filepath","modules/clean/filepath","modules/clean/history","modules/clean/react/async_overquota_modal_controller","modules/clean/react/browse/actions","modules/clean/react/browse/api","modules/clean/react/browse/browse_view","modules/clean/react/browse/constants","modules/clean/react/browse/models","modules/clean/react/browse/professional_collection_actions","modules/clean/react/browse/store","modules/clean/browse/browse_bolt_client","modules/clean/react/file_uploader/constants","modules/clean/react/file_uploader/file_uploader","modules/clean/react/file_uploader/store","modules/clean/react/file_uploader/utils","modules/clean/react/file_viewer/async_controller","modules/clean/search/search_results/actions","modules/clean/search/search_bar/data/store","modules/clean/search/search_bar/data/selectors","modules/clean/search/search_results/store","modules/clean/sharing/browse_exports","modules/clean/sharing/constants","modules/clean/sharing/ui_notifications_util","modules/clean/viewer","modules/clean/pagelet_logger","modules/clean/web_timing_logger","modules/core/browser","modules/core/exception","modules/core/html","modules/core/i18n","modules/core/notify","modules/core/uri","modules/constants/python","modules/clean/search/search_helpers","modules/clean/search/search_bar/data/action_creators","modules/clean/storage","modules/clean/react/files_view/types","modules/clean/react/search_success_banner/util","modules/clean/react/browse/browse_prefetch_loader","modules/clean/react/browse/data/selectors","modules/clean/react/browse/data/store","modules/clean/react/browse/nav_actions","modules/clean/react/snackbar","modules/clean/user_education/user_education_client","modules/clean/search/search_results/log_helper","modules/clean/filetypes","modules/clean/web_user_action_events","modules/clean/react/browse/action_logger","modules/clean/analytics","modules/clean/search/logger","modules/clean/search/search_bar/chips","modules/clean/search/search_bar/experiments","modules/clean/react/app_actions/app_actions_store","modules/clean/upsell/prompt_event_emitter","modules/clean/search/search_bar/data/action_creators"],function(e,t,r,o,s,a,n,i,l,c,d,u,p,h,_,m,f,S,g,w,E,v,F,y,T,b,C,A,R,I,P,D,N,O,L,x,M,B,U,k,q,V,H,W,G,j,Q,z,K,Y,J,X,Z,$,ee,te,re,oe,se,ae,ne,ie,le){"use strict";function ce(e){U.Notify.success(B._("%(file_name)s added to your Dropbox.").format({file_name:l.filename(e)}))}function de(e){var t=B._('Added “%(folder_name)s” <a href="%(href)s">Learn More</a>').format({folder_name:n.Emstring.em_snippet(l.filename(e),I.SNIPPET_SIZES.FILENAME),href:"/help/business/team-space-overview#acceptfolder"});U.Notify.success(new M.HTML(t))}function ue(e){var t=l.parent_dir(e);"/"!==t&&U.Notify.success(B._("Folder is in %(path)s").format({path:n.Emstring.em_snippet(t,22)}))}function pe(e){var t=he();c.default.replace_state(e,a.pick.apply(a,[t,_.BrowseQueryArg.d,_.BrowseQueryArg.select,_.BrowseQueryArg.preview,_.BrowseQueryArg.activity,_.BrowseQueryArg.preselected_for_showcase].concat(_.FRAMEWORK_ARGS)))}function he(){var e=c.default.deconstruct_url().qargs;return{d:e[_.BrowseQueryArg.d],select:e[_.BrowseQueryArg.select],path:e[_.BrowseQueryArg.path],last_fq_path:e[_.BrowseQueryArg.last_fq_path],query:e[_.BrowseQueryArg.query],query_unnormalized:e[_.BrowseQueryArg.query_unnormalized],preview:e[_.BrowseQueryArg.preview],search_session_id:e[_.BrowseQueryArg.search_session_id],country_override:e[_.BrowseQueryArg.country_override],cProfile:e[_.BrowseQueryArg.cProfile],public_mode_override:e[_.BrowseQueryArg.public_mode_override],stormcrow_override:e[_.BrowseQueryArg.stormcrow_override],stormcrow_override_data_field:e[_.BrowseQueryArg.stormcrow_override_data_field],stormcrow_override_population:e[_.BrowseQueryArg.stormcrow_override_population],stormcrow_override_ttl:e[_.BrowseQueryArg.stormcrow_override_ttl],stormcrow_panel:e[_.BrowseQueryArg.stormcrow_panel],uncompressed_js:e[_.BrowseQueryArg.uncompressed_js],use_packages:e[_.BrowseQueryArg.use_packages],file_categories:e[_.BrowseQueryArg.file_categories],preselected_for_showcase:e[_.BrowseQueryArg.preselected_for_showcase],activity:e[_.BrowseQueryArg.activity],search_from:e[_.BrowseQueryArg.search_from]}}Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),s=r.__importStar(s),a=r.__importStar(a),i=r.__importStar(i),c=r.__importDefault(c),d=r.__importStar(d),p=r.__importStar(p),F=r.__importStar(F),C=r.__importStar(C),O=r.__importStar(O),L=r.__importStar(L),V=r.__importStar(V),H=r.__importStar(H),z=r.__importStar(z),te=r.__importStar(te),oe=r.__importStar(oe);var _e;(function(e){e[e.BROWSE=0]="BROWSE",e[e.SEARCH=1]="SEARCH"})(_e||(_e={}));var me=(function(t){function n(o){var n=t.call(this,o)||this;n.logOnceFetchedDataRequiredForTTI=a.once(function(){return O.log_js_modules_fetched_data_required_for_tti()}),n.previousHistoryCallbackMode=_e.BROWSE,n.handlePreviewAndShareModalsOnLoad=function(t){var o=n.getPathFromProps(),s=n.state.user,a=!!n.props["open-preview"],i=!!n.props["show-share-modal"],l=n.props["share-prefill-email"];if(a&&!t){U.Notify.error(B._("The file doesn’t exist"));var d=n.state.urlPrefix,u=n.getUrlForFQPath(d,o),h=he();delete h.preview,c.default.replace_state(u,h)}if(t){var f=m.File.fromServerObject(t);y.asyncOpenPreview({containerId:_.BROWSE_FILE_VIEWER_ELEMENT_ID,files:[f],fileViewAction:q.FileViewActionType.CLICK,fileViewOrigin:q.FileViewOriginType.BROWSE,fileViewTarget:q.FileViewTargetType.PRIVATE,indexOfPreviewFile:0,user:s,updateBrowserLocation:!1,onFileViewerDidMount:y.hideElementsBehindFileViewer,filePreviewDataFetcher:function(e){return p.fetchPreviewData(e,s)},onFileViewerUnmount:function(){y.showElementsBehindFileViewer();var e=n.browseViewRef;(e=e.getFilesViewControllerRef())&&(e=e.getFilesViewTileGridRef())&&(e=e.getTileGridRef())&&e.getAndUpdateTileLayout(),n.restoreUrlAfterFileViewClose()}}),i&&O.waitForTTI().then(function(){n.mounted&&R.asyncShowPrefilledShareModal({user:s,sharePrefillEmail:l,content:f,setPath:Y.browseNavActions.setPath,setUrl:Y.browseNavActions.setUrl})})}else i&&O.waitForTTI().then(function(){if(n.mounted){var e=n.props["ns-id"],t=n.props["ns-path"];R.asyncShowPrefilledShareModal({user:s,sharePrefillEmail:l,content:{fqPath:o,isFolder:!0,nsId:e&&t?e:null,targetNsId:e&&!t?e:null},setPath:Y.browseNavActions.setPath,setUrl:Y.browseNavActions.setUrl})}});i||n.props["showing-mobile-billing-modal"]||n.props["showing-client-modal"]||O.waitForTTI().then(function(){ie.promptBufferedEventEmitter.on(ie.Events.ON_PROMPT_INITIALIZED,function(t){return r.__awaiter(n,void 0,void 0,function(){var o,s,a,n;return r.__generator(this,function(i){switch(i.label){case 0:return t&&(t.didMainCampaignLoad()||t.didCampaignForUserEducationLoad())?[2]:[4,new Promise(function(t,r){e(["modules/clean/react/ncct/post_tti_ncct_modal"],t,r)}).then(r.__importStar)];case 1:return o=i.sent().postTTINCCTReminderModal,[4,o()];case 2:return(s=i.sent())?[2]:(a="V2"===this.browsePostTTIExperiments.expSubgrowthBizTeamsTriggersClientLinkWork,a&&this.state.user.is_team?[4,new Promise(function(t,r){e(["modules/clean/growth/experiments/open_in_desktop_modal"],t,r)}).then(r.__importStar)]:[3,4]);case 3:n=i.sent().openInDesktopModalExperiment,n(this.state.user,this.state.context),i.label=4;case 4:return[2]}})})})})},n.receiveStateFromStores=function(){n.setState(n.getStateFromStores())},n.handleComponentTTI=function(e){n.browseLogger&&(n.browseLogger.componentReady(e),n.browseLogger.ttiLogged&&n.ajaxRequestWebTimer&&(n.ajaxRequestWebTimer.markTimeToInteractive(),delete n.ajaxRequestWebTimer))},n.onAllUploadsComplete=function(e){var t=e.detail.files,r=t.map(function(e){return i.normalize(e.path)+i.normalize(e.name)});u.browseActions.selectFilesAfterUpload({fqPathsToSelect:r})},n.getIsFileJumping=function(){return S.getBrowseStore().isFileJumping()},n.getFileByFullPath=function(e){return S.getBrowseStore().getFileByFullPath(e)},n.setBrowseViewRef=function(e){n.browseViewRef=e},n.startBoltLiveUpdate=function(){n.browseBoltClient.startLiveUpdate(function(){n.getChangesRequest&&n.getChangesRequest.abort();var e=n.state,t=e.user,r=e.path,o=e.shouldShowDeletedFiles;n.getChangesRequest=p.getChangesForDirectory({path:r,userId:t.id,namespaceToJournalIdMap:n.browseBoltClient.getNsMap(),includeDeletedFiles:o,onSuccess:function(e){delete n.getChangesRequest,u.browseActions.computeAndApplyDeltasFromBoltClient({payload:e,path:r}),n.browseBoltClient.handleUpdateBoltClient(e.bolt_data)}})})},n.toggleTimelineIfNecessary=function(){var e=he().activity;e&&!n.state.isTimelineVisible&&u.browseActions.showTimeline(),!e&&n.state.isTimelineVisible&&u.browseActions.hideTimeline()},n.handleFileLocationChange=function(e,t){e="/"+k.URI.decode(e),n.ensureFileViewerIsOpenedOrClosedIfNeeded(t),n.toggleTimelineIfNecessary(),n.previousHistoryCallbackMode===_e.BROWSE&&i.paths_are_equal(S.getBrowseStore().path(),e)||(n.previousHistoryCallbackMode=_e.BROWSE,n.navigateToPath({path:e}))},n.getPathFromProps=function(){return n.props["init-fq-path"]||"/"},n.handleSearchLocationChange=function(e,t){if(t){var r=n.searchBarExperiments,o=t.query||t.query_unnormalized||"";e=t.path||t.last_fq_path||"/";var s=t.search_session_id||"",a=t.file_categories||"",l=void 0,c=void 0;if(ae.isInDeletedFilterRightRailExperiment(r)&&(l="1"===t.d,setTimeout(function(){u.browseActions.setShouldShowDeletedFiles({shouldShowDeletedFiles:l,shouldUpdateUrl:!1,shouldReloadFolder:!1}),l&&u.browseActions.setViewType({viewType:G.ViewType.List})},0)),o&&(!i.paths_are_equal(e,n.state.path)||o!==n.state.latestQuery||ae.isInDeletedFilterRightRailExperiment(r)&&l!==n.state.shouldShowDeletedFiles||V.isInFileTypeFilterExperiment(r)&&a!==V.fileCategoriesToString(n.state.latestFileCategories))){var d=n.state.user;setTimeout(function(){Y.browseNavActions.clear({path:e,context:new m.BrowseContext})}),n.previousHistoryCallbackMode=_e.SEARCH,i.paths_are_equal(S.getBrowseStore().path(),e)||u.browseActions.setPath({path:e}),n.reduxStore.dispatch(H.setBrowseScope({browseScope:e})),V.isInFileTypeFilterExperiment(r)&&(c=V.fileCategoriesFromString(a),a!==V.fileCategoriesToString(n.state.latestFileCategories)&&n.reduxStore.dispatch(H.setFileCategories({fileCategories:c}))),n.reduxStore.dispatch(H.setSearchQuery({query:o,searchSessionId:s,searchPath:e}));var p=n.searchResultsExperiments,h=p.expShowSymlinkIcon,_=p.expDeletedFileInCerebro;T.searchResultsActions.runSearch({user:d,path:e,query:o,searchSessionId:s,showSymlinkIcon:!!h,webTimer:n.ajaxRequestWebTimer,logOnceFetchedDataRequiredForTTI:n.logOnceFetchedDataRequiredForTTI,deletedFiles:l,expSinglePageSearch:n.isInSinglePageSearchExperiment,fileCategories:c,deletedFileInCerebro:!!_,isPaperEnabled:!!n.props["paper-enabled-for-user"]})}}},n.handleSearchExit=function(){n.reduxStore.dispatch(H.clearSearchBar()),T.searchResultsActions.clearSearch(),n.searchBarExperiments.expSearchSuccessBanner&&!j.getClickedOnSearchResultsPageItem()&&j.setSearchSuccessBannerVisible(),n.isInSinglePageSearchExperiment&&!C.isSearchBarFocused(n.reduxStore.getState())&&n.reduxStore.dispatch(H.blurSearchBar())},n.markTTVIfNeeded=function(){if(!n.hasTTVBeenLogged&&n.mounted&&(n.prefetchComplete||n.props["search-query"])){var e=window.ensemble;e&&e.markPageletRenderedByDOMNode(s.findDOMNode(n)),O.mark_time_to_view(),n.hasTTVBeenLogged=!0}},n.handleFileListUpdated=function(){n.fileViewerIsShown()?n.state.files.isEmpty()?u.browseActions.closeFileViewer():u.browseActions.updatePreview({files:n.state.files.toJS()}):n.ensureFileViewerIsOpenedOrClosedIfNeeded(he())},n.handleOnNavigateToPath=function(e){n.blurSearchBarIfInSinglePageSearch(),u.browseActions.setUrl({path:e})},n.handleOnNavigateToParentFolder=function(){n.blurSearchBarIfInSinglePageSearch(),u.browseActions.navigateToParentFolder()},n.handleDelete=function(e){var t=n.state.context,r=e.some(m.File.isTeamSharedFolder),o=e.some(function(e){return e.read_only}),s=e.every(function(e){return e.isDeleted});!t.isCurrentPathWriteable()||r||o?r?U.Notify.error(B._("Team folders can’t be deleted.")):U.Notify.warning(B._("You don’t have permission to delete files in this folder.")):s?u.browseActions.doPermanentDeleteWithModal({files:e}):u.browseActions.doDeleteFilesWithModal({files:e})},n.handleSearchBarResultOpen=function(e){u.browseActions.navigateToFileOrFolder({file:e,fileViewAction:q.FileViewActionType.SEARCH})},n.handleSearchBarPathClicked=function(e){u.browseActions.navigateToResultObjectParentFolder({file:e,fileViewAction:q.FileViewActionType.SEARCH})},n.handleOnNavigateToFileOrFolder=function(e,t){if(n.blurSearchBarIfInSinglePageSearch(),n.searchBarExperiments.expSearchSuccessBanner&&!j.userIsOptedOutOfSearchSuccessBanner()){var r=e.is_dir;if(n.state.isSearchMode)j.setClickedOnSearchResultsPageItem(),j.setSearchSuccessBannerVisible(),r&&j.setFolderSearchResultData(e.fq_path);else{j.doSearchBarInteractionBroadcast(!1);var o=e.fq_path,s=j.getSearchResultPath(),a=j.getSearchResultClickTimestamp();Date.now()-a<=3e4&&j.parentPathOfFileEqualsSearchResultPath(o,s,r)?j.setSearchSuccessBannerVisible():j.resetSearchSuccessBannerSettings()}}u.browseActions.hideTimeline(),n.ensureFullFileObjectPopulated(e,n.completeNavigateToFileOrFolder,t)},n.ensureFullFileObjectPopulated=function(e,t,r){n.state.isSearchMode?T.searchResultsActions.fetchCompleteSearchResultSRP({searchResult:e,user:n.state.user,onSuccess:t}):t(e,r)},n.completeNavigateToFileOrFolder=function(e,t){var r=n.state,o=r.user,s=r.viewer,a=r.isSearchMode,l=r.viewType,c=e.ns_id,d=e.sjid,p=e.file_id,h=e.fq_path,_=e.bytes,m=e.ext,f=e.request_id;if(te.logOpenRow({uid:o.id,entity_type:e.is_dir?"folder":"file",source:"list_browse",view_type:l,file_nsid:c,file_sjid:d,file_id:p,file_name:i.filename(e.fq_path),file_path:h,file_size:_,file_extension:m,request_id:f}),e.type===$.FileTypes.TEAM_SHARED_FOLDER&&(X.UEClient.sendEvent("FileItemRow","TeamFolderClicked"),re.TeamsWebActionsLogger.log("clicked_team_folder_web",{team_id:s.team_id})),a){var S=ee.WebUserActionLogEvent.FILE_VIEW;e.is_unmounted?S=ee.WebUserActionLogEvent.UNMOUNTED_VIEW:e.is_dir&&(S=ee.WebUserActionLogEvent.FOLDER_OPEN),Z.recordSearchResultsAction({result:e,user:o,action_type:S,view_type:l})}a&&e.is_unmounted?R.asyncShowSharedContentLinkSyncModal(o,e):u.browseActions.navigateToFileOrFolder({file:e,onFileViewerUnmount:t,fileViewAction:a?q.FileViewActionType.SEARCH:q.FileViewActionType.CLICK})},n.actionHandlers={
onDelete:n.handleDelete,onShowRename:function(e){return u.browseActions.showFileRename({file:e})},onRestore:function(e){var t=n.state,r=t.user,o=t.isOverFreeQuota;!r.is_team&&o?d.showOverquota("wb_oq_rstdel_f"):u.browseActions.doRestoreFilesWithUnifiedTrashModal({files:e})},onPermanentDelete:function(e){u.browseActions.doPermanentDeleteWithModal({files:e})},onShowComment:function(e){return n.onShowComment(e)},onPrepareForSignature:function(e){return n.onPrepareForSignature(e)}},n.getOnShowShareHandler=function(e,t){var r=n.browsePostTTIExperiments,o=r.expShowShowcaseInterstitial,s=r.expHasCreatedShowcase,a=r.expHasShowcaseFreemium;o?u.browseActions.handleShowShareInterstitialModal(e,t,!!s,!!a,n.state.viewType):u.browseActions.handleShowShareModal(e,t)},n.filesViewActionHandlers={onDelete:n.handleDelete,onShowRename:function(e){return u.browseActions.showFileRename({file:e})},onCopyToClipboard:function(e){return u.browseActions.copyFilesToClipboard(e)},onPasteFromClipboard:function(){return u.browseActions.pasteClipboardFilesToCurrentPath()},onNewFolderSubmit:function(e){return u.browseActions.createFolder({pathName:n.state.context.currentFQPath,folderName:e,nsId:n.state.context.rootNSID,checkFSWs:!0})},onNewFolderCancel:function(){return u.browseActions.cancelCreateFolder()},onRenameSubmit:function(e,t){return u.browseActions.renameFile({file:e,newName:t,isSearchMode:n.state.isSearchMode})},onRenameCancel:function(e){return u.browseActions.cancelFileRename({file:e})},onSwitchViewType:function(e){return u.browseActions.setViewType({viewType:e,isSearchMode:n.state.isSearchMode})},onColumnsChanged:function(e,t,r){return u.browseActions.setColumnConfiguration({columns:e,viewType:t,canDisplayFolderSizes:r})},onCanDisplayFolderSizesChanged:function(e){return u.browseActions.setColumnDependentCapabilities({canDisplayFolderSizes:e})},onAddFileJumpKeyCode:function(e){return u.browseActions.addFileJumpKeyCode({keyChar:e})},onResetFileJump:function(){return u.browseActions.resetFileJump()},onShowShare:n.getOnShowShareHandler},n.uploadAjaxInterceptor={interceptUploadPrecheck:function(e){return e},interceptUpload:function(e,t){var o=t.ns_id_for_routing,s=t.ns_id;if(!o||!s){var a=S.getBrowseStore().mountPoints(),i=n.state.context.rootNSID;x.assert(null!=a,"mountPoints is null"),x.assert(null!=i,"rootNSID is null"),o=F.getNsId(a,i,e.dest)}return r.__assign({},t,{ns_id_for_routing:o,ns_id:o})}},n.handleSearch=function(e,t,r,o){var s=V.buildSearchURL({user:n.state.user,searchPath:t,normalizedQuery:e,searchSessionId:r?C.searchSessionId(n.reduxStore.getState()):A.getSearchResultsStore().searchSessionId(),searchToken:V.getSearchCsrfToken(),qargs:o});n.ensureTimer("search_results"),n.isInSinglePageSearchExperiment&&(e.length>1||n.state.latestQuery)?c.default.replace_state(s.getPath(),s.getQuery()):c.default.push_state(s.getPath(),s.getQuery())},n.handleSearchFiltersChanged=function(e){var t=e.path,r=void 0===t?n.state.path:t,o=e.deletedFiles,s=e.fileCategories,a=void 0===s?n.state.latestFileCategories:s,i=n.state,l=i.user,c=i.searchSessionId,d=i.latestQuery;r&&r!==n.state.path&&oe.logScopeChipChanged({searchSessionId:c,user:l,chipAdded:!se.isScopeChipRoot(r),filePath:r,viewport:"right-rail",searchType:"full_page"}),void 0!==o&&o!==n.state.shouldShowDeletedFiles&&oe.logDeletedFilterChanged({searchSessionId:c,user:l,deletedFiles:o,viewport:"right-rail",searchType:"full_page"});var u={};if(void 0!==o&&(u.d=o?"1":"0"),void 0!==a&&!V.allCategoriesUnchecked(a)){var p=V.fileCategoriesToString(a);u.file_categories=p}n.handleSearch(d,r,!1,u)},n.fileViewerIsShown=function(){if(n.state.arePostTTIModulesLoaded){return e("modules/clean/react/file_viewer/controller").isShown()}return!1},n.ensureFileViewerClosedIfNotPreviewing=function(e){!e.preview&&n.fileViewerIsShown()&&u.browseActions.closeFileViewer()},n.ensureFileViewerIsOpenedOrClosedIfNeeded=function(e){var t=n.fileViewerIsShown();if(e.preview&&!t){var r=S.getBrowseStore().getFileByFilename(e.preview);r&&u.browseActions.navigateToFileOrFolder({file:r})}else t&&!e.preview&&u.browseActions.closeFileViewer()},n.getLearnMoreLinkHandler=function(){window.open("/help/business/unsynced-team-folder","_blank")},O.log_js_modules_application_code_start();var l=S.getBrowseStore(),h=A.getSearchResultsStore();b.getStoreForSearchBar(),n.reduxStore=K.getStoreForBrowse();var f=D.Viewer.get_viewer(),g=f.get_user_by_id(n.props["user-id"]);return u.browseActions.appInit({experiments:n.browseExperiments,shouldShowDeletedFiles:!!n.props["should-show-deleted-files"],user:g,viewer:f}),n.reduxStore.dispatch(H.setExperiments({experiments:n.searchBarExperiments})),n.appActionsStore=ne.getAppActionsStore(),l.add_change_listener(n.receiveStateFromStores),h.add_change_listener(n.receiveStateFromStores),v.uploaderStore.add_change_listener(n.receiveStateFromStores),window.addEventListener(w.ALL_UPLOADS_COMPLETE_EVENT,n.onAllUploadsComplete),n.state=r.__assign({},n.getStateFromStores(),{arePostTTIModulesLoaded:!1,searchFrom:he().search_from}),n}return r.__extends(n,t),Object.defineProperty(n.prototype,"uploaderExperiments",{get:function(){return this.props["exp-uploader-experiments"]||{}},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"uploaderPostTTIExperiments",{get:function(){return this.state.uploaderPostTTIExperiments||{}},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"searchBarExperiments",{get:function(){return this.props["exp-search-bar-experiments"]||{}},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"searchResultsExperiments",{get:function(){return this.props["exp-search-results-experiments"]||{}},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"browseExperiments",{get:function(){return this.props["exp-browse-experiments"]||{}},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"browsePostTTIExperiments",{get:function(){return this.state.browsePostTTIExperiments||{}},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isInSinglePageSearchExperiment",{get:function(){return ae.isInSinglePageSearchExperiment(this.searchBarExperiments)},enumerable:!0,configurable:!0}),n.prototype.componentWillMount=function(){var t,o=this;t=this.props["search-query"]?["FilesViewController"]:["FilesViewController","AppActionsView"],this.browseLogger=new N.PageletLogger("browse",t,!0,{view_type:this.state.viewType.toLowerCase()});var s=this.state,a=s.urlPrefix,n=s.user,i=s.viewer,l=this.props["search-query"],d=this.props["share-link"],p=!!this.props["open-preview"],h=this.getPathFromProps();l||d||p||pe(this.getUrlForFQPath(a,h));var _=i.get_users().map(function(e){return e.id});W.UserLocalStorage.clearOtherUsers(_),this.browseBoltClient=new g.BrowseBoltClient(n.id);var m=new Q.BrowsePrefetchLoader({user:n,path:h,fqPathsToSelect:this.props["select-fq-paths"]},{onPrefetchComplete:function(e){o.prefetchComplete=!0,o.reduxStore.dispatch(H.setBrowseScope({browseScope:h})),o.handlePreviewAndShareModalsOnLoad(e.preview_file_info),O.log_js_modules_fetched_data_required_for_tti(),o.markTTVIfNeeded()},onPrefetchError:function(){o.prefetchComplete=!0,u.browseActions.setUrl({path:""}),o.navigateToPath({path:""})},onLoadComplete:function(){o.maybeShowPrepopulatedAddToCollectionModal(S.getBrowseStore().files())},onPostTTIPrefetchComplete:function(t){var s=t["exp-browse-post-tti-experiments"],a=t["exp-uploader-post-tti-experiments"],n=!!t["is-over-free-quota"],i=!!t["maybe-render-team-admin-modals"];s.expShouldShowNcctPaywall&&L.redirect("/ncct-trial-end"),i&&new Promise(function(t,r){e(["modules/clean/react/ncct/post_tti_ncct_modal"],t,r)}).then(r.__importStar).then(function(e){(0,e.postTTINCCTReminderModal)()}),o.setState({uploaderPostTTIExperiments:a,isOverFreeQuota:n}),u.browseActions.setBrowsePostTTIExperiments({browsePostTTIExperiments:s})},onPostTTIPrefetchError:function(e){x.reportException({err:e||new Error("failed to load post TTI experiments")})}},{onInitializeEverything:u.browseActions.initializeEverything,onLoad:u.browseActions.load,onAddFilesAndSetLoadingState:u.browseActions.addFilesAndSetLoadingState});m.isPrefetching()?m.handlePrefetch():l||this.navigateToPath({path:h,logFetchedDataRequiredForTTI:!0}),this.searchBarExperiments.expSearchSuccessBanner&&(window.addEventListener("popstate",function(){j.resetSearchSuccessBannerSettings(),j.doSearchBarInteractionBroadcast(!1)}),c.default.deconstruct_url(document.referrer).qargs.search_session_id&&!j.getClickedOnSearchResultsPageItem()?j.setSearchSuccessBannerVisible():j.resetSearchSuccessBannerSettings());c.default.add_callback(a,this.handleFileLocationChange,!0),c.default.add_callback("/search",this.handleSearchLocationChange,!l),c.default.add_exit_callback("/search",this.handleSearchExit)},n.prototype.componentDidMount=function(){var t=this;this.mounted=!0;var o=this.getPathFromProps(),s=this.state.user,i=this.props["search-query"],c=this.props["share-link"],d=!!this.props["open-preview"];this.props["from-scl-sync-modal"]&&(s.is_cdm_member?de(o):ce(o)),this.props["show-share-success-snackbar"]&&P.showInBandShareSuccessSnackbar(l.filename(o)),this.shouldShowUnsyncNotification()&&this.showUnsyncNotification(),!i&&c&&!d&&s.is_cdm_member&&ue(o),this.toggleTimelineIfNecessary(),this.markTTVIfNeeded(),n.mountFileViewerTarget(),O.waitForTTI().then(function(){t.props["search-query"]||t.fetchAndStartBoltUpdates();var o=function(e){var r=e[0],o=(r[0],r[1],r[2].SharedWithStore),s=(r[3],r[4]),n=s.checkForMissingStarredData,i=s.StarredStore,l=(r[5],r[6],r[7],e[1]),c=(l[0],l[1],l[2].BloodhoundContactsV2),d=l[3].EmailVerification;if(l[4],l[5],l[6],t.mounted){var u=t.state,p=u.user,h=u.path,_=u.files,m=_.toArray();o.initializeWith({path:h,files:m}),n({items:m,user:p});var f=i.addListener(function(){t.setState({starredState:i.getLoadingStates()})}),g=S.getBrowseStore(),w=function(){return a.defer(function(){n({items:t.state.files.toArray(),user:p})})};g.add_change_listener(w),t.removeStarredStoreListener=function(){f(),g.remove_change_listener(w)},c.getOrCreateForUser(p),t.setState({arePostTTIModulesLoaded:!0}),t.props["email-just-verified"]?d.getForRole(p.role).show_verified_modal():t.props["email-just-verified-and-changed"]?d.getForRole(p.role).show_verified_and_changed_modal():t.props["send-verification-email"]&&d.getForRole(p.role).show_sent_modal()}};o.perfName="browse_post_tti",Promise.all([Promise.all([new Promise(function(t,r){e(["modules/clean/react/file_viewer/controller"],t,r)}).then(r.__importStar),new Promise(function(t,r){e(["modules/clean/react/browse/file_actions"],t,r)}).then(r.__importStar),new Promise(function(t,r){e(["modules/clean/react/browse/shared_with"],t,r)}).then(r.__importStar),new Promise(function(t,r){e(["modules/clean/react/files_view/overflow_menu_with_star"],t,r)}).then(r.__importStar),new Promise(function(t,r){e(["modules/clean/react/starred/browse_exports"],t,r)}).then(r.__importStar),new Promise(function(t,r){e(["modules/clean/react/file_modal_controller"],t,r)}).then(r.__importStar),new Promise(function(t,r){e(["modules/clean/sharing/share_modal_util"],t,r)}).then(r.__importStar),new Promise(function(t,r){e(["modules/clean/sharing/shared_content_link_sync_utils"],t,r)}).then(r.__importStar)]),Promise.all([new Promise(function(t,r){e(["modules/clean/sharing/ui_util"],t,r)}).then(r.__importStar),new Promise(function(t,r){e(["modules/clean/sharing/wizard/wizard_modals"],t,r)}).then(r.__importStar),new Promise(function(t,r){e(["modules/clean/contacts/bloodhound_contacts_v2"],t,r)}).then(r.__importStar),new Promise(function(t,r){e(["modules/clean/account/email"],t,r)}).then(r.__importStar),new Promise(function(t,r){e(["modules/clean/unity_browse_interface"],t,r)}).then(r.__importStar),new Promise(function(t,r){e(["modules/clean/unity/features"],t,r)}).then(r.__importStar),new Promise(function(t,r){e(["modules/clean/unity/check_file_cache"],t,r)}).then(r.__importStar)])]).then(o)})},n.prototype.componentWillUpdate=function(e,t){t.isSearchMode&&!this.state.isSearchMode?this.browseBoltClient.stopLiveUpdate():!t.isSearchMode&&this.state.isSearchMode&&this.fetchAndStartBoltUpdates(),t.files.equals(this.state.files)||a.defer(this.handleFileListUpdated)},n.prototype.componentWillUnmount=function(){this.removeStarredStoreListener&&this.removeStarredStoreListener(),window.removeEventListener("popstate",function(){j.resetSearchSuccessBannerSettings()}),n.unmountFileViewerTarget(),S.getBrowseStore().remove_change_listener(this.receiveStateFromStores),A.getSearchResultsStore().remove_change_listener(this.receiveStateFromStores),v.uploaderStore.remove_change_listener(this.receiveStateFromStores),window.removeEventListener(w.ALL_UPLOADS_COMPLETE_EVENT,this.onAllUploadsComplete),this.mounted=!1},n.prototype.getStateFromStores=function(){var e=S.getBrowseStore(),t=A.getSearchResultsStore(),o=t.latestQuery(),s=!!o,a={files:e.files(),filesWithoutTeamFolders:e.filesWithoutTeamFolders(),paginatedTotalNumFiles:e.paginatedTotalNumFiles(),teamFolders:e.teamFolders(),loadingState:e.loadingState(),path:e.path(),fileRename:e.fileRename(),shouldShowDeletedFiles:e.shouldShowDeletedFiles(),shouldShowPinnedTeamFolders:z.shouldShowPinnedTeamFolders(this.reduxStore.getState()),isDraggingInternalFiles:E.FileUploaderController.isDraggingInternalFiles(),isDraggingExternalFiles:E.FileUploaderController.isDraggingExternalFiles(),isUploadModalOpen:E.FileUploaderController.isUploadModalOpen(),isTextSelectable:!!e.fileRename(),isTimelineVisible:e.isTimelineVisible(),createNewFolderState:e.newFolderCreationState(),isSearchMode:s,currentSort:e.currentSort(),viewType:e.viewType(),canDisplayFolderSizes:e.canDisplayFolderSizes(),viewTypeColumns:e.viewTypeColumns(),urlPrefix:e.urlPrefix(),isQueryingFolderSizes:e.isQueryingFolderSizes(),user:e.user(),viewer:e.viewer(),latestFileCategories:t.latestFileCategories(),browsePostTTIExperiments:e.postTTIExperiments()};return s?r.__assign({},a,{context:t.browseContext(),selection:t.selection(),selectedFiles:t.selectedFiles(),searchSessionId:t.searchSessionId(),latestQuery:o}):r.__assign({},a,{context:e.context(),selection:e.selection(),selectedFiles:e.selectedFiles(),latestQuery:void 0})},n.prototype.restoreUrlAfterFileViewClose=function(){var e,t=this.state.urlPrefix,r=this.getUrlForFQPath(t,this.state.path);e=this.props["open-preview"]?a.omit(he(),_.BrowseQueryArg.preview,_.BrowseQueryArg.select):{},c.default.replace_state(r,e)},n.prototype.getUrlForFQPath=function(e,t){return e+("/"===t?"":k.URI.encode_parts(t))},n.prototype.fetchAndStartBoltUpdates=function(){this.browseBoltClient.isReady()?this.startBoltLiveUpdate():this.browseBoltClient.fetchInitialBoltData(this.startBoltLiveUpdate)},n.prototype.ensureTimer=function(e,t){if(this.ajaxRequestWebTimer&&this.ajaxRequestWebTimer.getContextName()!==e&&delete this.ajaxRequestWebTimer,this.ajaxRequestWebTimer)this.ajaxRequestWebTimer.restart();else{this.ajaxRequestWebTimer=O.get_timer(e);var r={requireTTI:!0,requireTTV:!1};t&&(r.url=t),this.ajaxRequestWebTimer.initialize(r)}},n.prototype.navigateToPath=function(e){var t=e.path,r=e.logFetchedDataRequiredForTTI,o=void 0!==r&&r;this.browseLogger&&this.browseLogger.ttiLogged&&this.ensureTimer("browse_ajax","browse_ajax_nav"),u.browseActions.setPath({path:t,logFetchedDataRequiredForTTI:o,onPathLoaded:this.markTTVIfNeeded,ajaxWebTimer:this.ajaxRequestWebTimer}),this.reduxStore.dispatch(H.clearSearchBar()),this.reduxStore.dispatch(H.setBrowseScope({browseScope:t}))},n.prototype.blurSearchBarIfInSinglePageSearch=function(){this.isInSinglePageSearchExperiment&&this.reduxStore.dispatch(le.blurSearchBar())},n.prototype.onShowComment=function(e){this.ensureFullFileObjectPopulated(e,function(e){u.browseActions.navigateToFileOrFolder({file:e,shouldFocusComment:!0})})},n.prototype.onPrepareForSignature=function(e){this.ensureFullFileObjectPopulated(e,function(e){u.browseActions.navigateToFileOrFolder({file:e,shouldPrepareForSignature:!0})})},n.prototype.maybeShowPrepopulatedAddToCollectionModal=function(e){var t=he();if(t.preselected_for_showcase){var r=t.preselected_for_showcase.split(".").map(function(e){return"id:"+e});f.showPrepopulatedAddToCollectionModal(r,this.state.user,e.toJS());var o=this.getPathFromProps(),s=this.getUrlForFQPath(this.state.urlPrefix,o);delete t[_.BrowseQueryArg.preselected_for_showcase],c.default.replace_state(s,t)}},n.prototype.shouldShowUnsyncNotification=function(){return this.props["should-show-unsync-notification"]},n.prototype.showUnsyncNotification=function(){J.Snackbar.show(o.createElement(J.Snackbar,{variant:"generic",title:B._("Do you also need this on your computer?",{comment:'\'"this" refers to the folder that the user is currently browsing. (limited space, please keep the phase short)'}),timeoutDelayMs:1e5,actionButtonText:B._("Learn more"),closeButtonText:B._("Close"),onActionClick:this.getLearnMoreLinkHandler}))},n.prototype.render=function(){var e=this.state,t=e.user,r=e.context,s=e.path,a=e.createNewFolderState,n=e.currentSort,i=e.isUploadModalOpen,l=e.selection,c=e.fileRename,d=e.files,p=e.teamFolders,_=e.isTextSelectable,m=e.loadingState,f=e.selectedFiles,S=e.isSearchMode,g=e.viewType,w=e.canDisplayFolderSizes,E=e.viewTypeColumns,v=e.starredState,F=e.filesWithoutTeamFolders,y=e.arePostTTIModulesLoaded,T=e.isDraggingExternalFiles,b=e.isDraggingInternalFiles,C=e.isQueryingFolderSizes,A=e.paginatedTotalNumFiles,R=e.shouldShowDeletedFiles,I=e.shouldShowPinnedTeamFolders,P=e.isOverFreeQuota,D=e.searchSessionId,N=e.latestQuery,O=e.latestFileCategories,L=e.isTimelineVisible,x=e.searchFrom;return o.createElement(h.BrowseView,{autoTeamGroupId:this.props["auto-team-group-id"],ref:this.setBrowseViewRef,actionHandlers:this.actionHandlers,filesViewActionHandlers:this.filesViewActionHandlers,onNavigateToParentFolder:this.handleOnNavigateToParentFolder,onNavigateToPath:this.handleOnNavigateToPath,onNavigateToFileOrFolder:this.handleOnNavigateToFileOrFolder,onSearchBarResultOpen:this.handleSearchBarResultOpen,onSearchBarPathClicked:this.handleSearchBarPathClicked,context:r,createNewFolderState:a,currentSort:n,ensureFileViewerClosedIfNotPreviewing:this.ensureFileViewerClosedIfNotPreviewing,fileRename:c,files:d,filesWithoutTeamFolders:F,getIsFileJumping:this.getIsFileJumping,getFileByFullPath:this.getFileByFullPath,handleComponentTTI:this.handleComponentTTI,isDraggingExternalFiles:T,isDraggingInternalFiles:b,isFileViewerShown:this.fileViewerIsShown,isSearchMode:S,isTextSelectable:_,isTimelineVisible:L,isUploadModalOpen:i,loadingState:m,onSearch:this.handleSearch,path:s,selectedFiles:f,selection:l,shouldOpenUploadModal:this.props["should-open-upload-modal"],shouldShowDeletedFiles:R,shouldShowPinnedTeamFolders:I,starredState:v,teamFolders:p,totalNumItems:A,uploadAjaxInterceptor:this.uploadAjaxInterceptor,user:t,viewType:g,canDisplayFolderSizes:w,columns:E[g],viewTypeColumns:E,arePostTTIModulesLoaded:y,isNoComment:this.props["is-no-comment"],isOverFreeQuota:P,isQueryingFolderSizes:C,nsId:this.props["ns-id"],uploaderExperiments:this.uploaderExperiments,uploaderPostTTIExperiments:this.uploaderPostTTIExperiments,searchBarExperiments:this.searchBarExperiments,searchResultsExperiments:this.searchResultsExperiments,browseExperiments:this.browseExperiments,browsePostTTIExperiments:this.browsePostTTIExperiments,searchSessionId:D,latestQuery:N,onSearchFiltersChanged:this.handleSearchFiltersChanged,appActionsStore:this.appActionsStore,fileCategories:O,isNautilusEnabled:!!this.props["nautilus-enabled-for-user"],isPaperEnabled:!!this.props["paper-enabled-for-user"],searchFrom:x,onShowTimeline:u.browseActions.showTimeline,onHideTimeline:u.browseActions.hideTimeline,onSelectionChange:u.browseActions.setSelection,onSortFiles:u.browseActions.sortFiles,onSetUrl:Y.browseNavActions.setUrl})},n.mountFileViewerTarget=function(){var e=document.getElementById(_.BROWSE_FILE_VIEWER_ELEMENT_ID);e||(e=document.createElement("div"),e.id=_.BROWSE_FILE_VIEWER_ELEMENT_ID,document.body.insertBefore(e,document.body.children[0]))},n.unmountFileViewerTarget=function(){var e=document.getElementById(_.BROWSE_FILE_VIEWER_ELEMENT_ID);e&&document.body.removeChild(e)},n})(o.Component);t.BrowseApp=me}),define("modules/clean/react/browse/browse_prefetch_loader",["require","exports","tslib","modules/core/exception","modules/clean/react/files_view/types","modules/clean/react/browse/models","modules/clean/pagination_manager","modules/core/notify","modules/clean/web_timing_logger"],function(e,t,r,o,s,a,n,i,l){"use strict";function c(e){if(0===e.indexOf("err:")){var t=e.substr("err:".length);i.Notify.error(t)}}Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),l=r.__importStar(l);var d=(function(){function e(e,t,r,i){var d=e.user,u=e.path,p=e.fqPathsToSelect,h=t.onPrefetchComplete,_=t.onPrefetchError,m=t.onLoadComplete,f=t.onPostTTIPrefetchComplete,S=t.onPostTTIPrefetchError,g=r.onInitializeEverything,w=r.onLoad,E=r.onAddFilesAndSetLoadingState;void 0===i&&(i=window);var v=this;this.isPrefetching=function(){return!!v.browsePreloadHandler&&!!v.firstPagePreloadHandler},this.handlePrefetch=function(){o.assert(v.isPrefetching(),"trying to handle prefetching and think we aren't prefetching at the same time.  something is wrong"),v.browsePreloadHandler(v.handlePrefetchDataSuccess,v.onPrefetchError),l.waitForTTI().then(function(){v.postTTIPreloadHandler(v.handlePostTTIDataSuccess,v.onPostTTIPrefetchError)})},this.handlePostTTIDataSuccess=function(e){var t=void 0;try{t=JSON.parse(e)}catch(e){return void v.onPostTTIPrefetchError(e)}if(!t)return void v.onPostTTIPrefetchError();v.onPostTTIPrefetchComplete(t)},this.handlePrefetchDataSuccess=function(e){var t=v.extractAjaxInitData(e);if(!t)return void v.onPrefetchError();var r,o,n=[],i=0,l=s.LoadingState.LOADING_FIRST_PAGE,c=v.firstPagePreloadHandler.getDataIfAvailable();if(c){if(!c.payload||c.error)return void v.onPrefetchError();var d=v.extractAjaxFileInfo(c.payload);if(!d)return void v.onPrefetchError();r=d.file_info,o=d.first_page,o?(n=[],i=o.total_num_items,l=s.LoadingState.LOADING_REMAINING_PAGES):r&&(n=r,i=n.length,l=s.LoadingState.LOADED)}var u=a.BrowseContext.fromServerObject(t);v.onInitializeEverything({path:v.path,files:n,paginatedTotalNumFiles:i,context:u,mountPoints:t.ns_id_to_mount_point,fqPathsToSelect:v.fqPathsToSelect,loadingState:l,teamFolders:t.team_folders_js_info}),r||o?(o?v.initializePaginationManager(o):v.onLoadComplete(),v.onPrefetchComplete(t)):v.firstPagePreloadHandler(function(e){v.handleFirstPagePrefetchDataSuccess(e,t,u)},v.onPrefetchError)},this.handleFirstPagePrefetchDataSuccess=function(e,t,r){var o=v.extractAjaxFileInfo(e);if(!o)return void v.onPrefetchError();o.paginated?v.initializePaginationManager(o.first_page):(v.onLoad({path:v.path,files:o.file_info,paginatedTotalNumFiles:o.file_info.length,context:r}),v.onLoadComplete()),v.onPrefetchComplete(t)},this.extractAjaxInitData=function(e){var t=void 0;try{t=JSON.parse(e)}catch(t){c(e)}return t},this.extractAjaxFileInfo=function(e){var t=void 0;try{t=JSON.parse(e)}catch(t){c(e)}return t},this.initializePaginationManager=function(e){var t=e.total_num_items,r=n.PaginationManager.create({firstPage:e,keyName:"sjid",ajaxURL:"/browse_get_next",userID:v.user.id,newDataAvailableCallback:function(e,r){var o=e.areAllItemsReady(),a=o?s.LoadingState.LOADED:s.LoadingState.LOADING_REMAINING_PAGES;v.onAddFilesAndSetLoadingState({path:v.path,files:r,paginatedTotalNumFiles:t,loadingState:a}),o&&(e.stopAutoFetching(),v.onLoadComplete())}});l.waitForTTI().then(function(){return r.startAutoFetching()})},this.user=d,this.path=u,this.fqPathsToSelect=p,this.onPrefetchComplete=h,this.onPrefetchError=_,this.onLoadComplete=m,this.onPostTTIPrefetchComplete=f,this.onPostTTIPrefetchError=S,this.onInitializeEverything=g,this.onLoad=w,this.onAddFilesAndSetLoadingState=E,this.browsePreloadHandler=i.__REGISTER_BROWSE_PRELOAD_HANDLER,this.firstPagePreloadHandler=i.__REGISTER_BROWSE_FIRST_PAGE_PRELOAD_HANDLER,this.postTTIPreloadHandler=i.__REGISTER_BROWSE_POST_TTI_PRELOAD_HANDLER}return e})();t.BrowsePrefetchLoader=d}),define("modules/clean/react/browse/browse_view",["require","exports","tslib","external/immutable","external/react","modules/clean/browse_uri_interface","modules/clean/filepath","modules/clean/filetypes","modules/clean/react/browse/action_logger","modules/clean/react/browse/constants","modules/clean/react/browse/logger_util","modules/clean/react/browse/models","modules/clean/react/browse/sidebar","modules/clean/react/browse/title","modules/clean/react/browse/web_team_sharing_experiment","modules/clean/react/file_uploader/file_uploader","modules/clean/react/files_view/constants","modules/clean/react/files_view/controller","modules/clean/react/files_view/types","modules/clean/react/maestro/layout","modules/clean/react/search_success_banner/constants","modules/clean/react/search_success_banner/search_success_banner","modules/clean/react/search_success_banner/util","modules/clean/search/search_bar/experiments","modules/clean/search/search_bar/log_helper","modules/clean/search/search_results/controller","modules/clean/search/search_results/log_helper","modules/clean/sharing/access_level","modules/clean/sharing/browse_exports","modules/clean/user_education/user_education_client","modules/clean/web_timing_logger","modules/core/browser","modules/clean/react/async/loadable","modules/clean/web_user_action_events"],function(e,t,r,o,s,a,n,i,l,c,d,u,p,h,_,m,f,S,g,w,E,v,F,y,T,b,C,A,R,I,P,D,N,O){"use strict";var L=this;Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),s=r.__importStar(s),n=r.__importStar(n),l=r.__importStar(l),d=r.__importStar(d),D=r.__importStar(D);var x=[A.NameSpaceAccess.ACCESS_NO_ACCESS,A.NameSpaceAccess.ACCESS_READER,A.NameSpaceAccess.ACCESS_READER_NO_COMMENT],M=(function(t){function A(a){var h=t.call(this,a)||this;return h.onSearchBarAbandonedEvent=function(e){var t=e.detail.searchBarState;h.setState({searchBarAbandoned:t.abandoned})},h.handleGetOverflowMenuActions=function(e,t,r){var s=h.handleGetFileActionsForSetOfFiles(o.Set([e]),t,r,!1),a=new Array;return s.forEach(function(e){"function"!=typeof e&&a.push(e)}),[a]},h.handleGetFileActionsForSetOfFiles=function(t,r,o,s,a){if(h.props.arePostTTIModulesLoaded){var n=h.props,i=n.context,l=n.user,c=n.actionHandlers,d=n.isSearchMode,u=n.isOverFreeQuota,p=n.isQueryingFolderSizes,_=n.browsePostTTIExperiments,m=n.viewType,f=e("modules/clean/react/browse/file_actions"),S=_.expShowAddToShowcase,g=_.expShowAddFolderToShowcase,w=_.expShowcaseFileActions,E=_.expBrowseMoveSuggestions,v=_.expEsignatureEnabled,F=_.expHasCreatedShowcase,y=_.expHasShowcaseFreemium,T=_.expNewBrowseMoveDialog,b=_.expShowShowcaseInterstitial,C="ON"===E,A=h.state.fileIdToActionCategories;return f.getActionsForFileCollection({files:t,context:i,user:l,viewType:m,fileIdToActionCategories:A,canDisplayFolderSizes:r,actionHandlers:c,skipSharing:!1,isSearchMode:d,isOverFreeQuota:u,isQueryingFolderSizes:p,canShowUJPopup:s,showAddToShowcase:!!S,showAddFolderToShowcase:!!g,showAddToShowcaseUpsell:!!w,hasCreatedShowcase:!!F,hasShowcaseFreemium:!!y,isSidebar:a,showShowcaseInterstitialExp:!!b,responsive:o,showNewMoveDialog:!!T,showFolderSuggestion:C,showPrepareForSignature:!!v})}return[]},h.handleLocationLinkClick=function(e,t){if(!t){var r=n.parent_dir(e.fq_path);h.props.onNavigateToPath(r)}},h.handleOpenPaper=function(e){var t=h.props,r=t.user,o=t.isSearchMode,s=t.viewType;o&&C.recordSearchResultsAction({result:e,user:r,action_type:O.WebUserActionLogEvent.PAPER_OPEN,view_type:s}),D.redirect(e.url)},h.handleUploadButtonClick=function(e){m.FileUploaderController.setPath(h.props.path),m.FileUploaderController.handleUploadButtonClick(e)},h.handleShowFileUploader=function(){m.FileUploaderController.setPath(h.props.path),m.FileUploaderController.showModal()},h.handleSelectionChange=function(e){var t=h.props.getFileByFullPath(e.selected.first());if(t){var r=t.ns_id,o=t.sjid,s=t.file_id,a=t.fq_path,i=t.bytes,c=t.ext,d=t.request_id;l.logSelectRow({uid:h.props.user.id,entity_type:t.is_dir?"folder":"file",view_type:h.props.viewType,file_nsid:r,file_sjid:o,file_id:s,file_name:n.filename(t.fq_path),file_path:a,file_size:i,file_extension:c,request_id:d})}h.props.onSelectionChange({selection:e})},h.handleFileListSortChange=function(e,t){l.logSortRecords({uid:h.props.user.id,sort_by:e,sort_direction:t,view_type:h.props.viewType}),h.props.onSortFiles({sortField:e,sortDirection:t})},h.handleStarClick=function(e,t){var r=t?O.WebUserActionLogEvent.STAR:O.WebUserActionLogEvent.REMOVE_STAR,o=h.props,s=o.user,a=o.isSearchMode,n=o.viewType,i=o.selectedFiles,c=d.countFilesAndFolders(i),u=c.num_files_selected,p=c.num_folders_selected;a&&C.recordSearchResultsAction({result:e,user:s,action_type:r,view_type:n}),l.logBrowseAction(s.id,"BROWSE",r,u,p,n,e)},h.handleSearchFromSearchBar=function(e){var t=e.query,r=e.searchPath,o=e.qargs;t?h.props.onSearch(t,r,!0,o):h.props.onSetUrl({path:r})},h.handleSearchResultOpen=function(e){e instanceof u.File?e.is_unmounted?R.asyncShowSharedContentLinkSyncModal(h.props.user,e):(T.logDropdownSearchAction({result:e,user:h.props.user,action_type:e.is_dir?O.WebUserActionLogEvent.FOLDER_OPEN:O.WebUserActionLogEvent.FILE_VIEW,viewport:"dropdown-view"}),h.props.onSearchBarResultOpen(e)):(e instanceof u.Paper||e instanceof u.PaperFolder)&&(T.logDropdownSearchAction({result:e,user:h.props.user,action_type:O.WebUserActionLogEvent.PAPER_OPEN,viewport:"dropdown-view"}),D.open_tab(e.url))},h.handleResultObjectPathClick=function(e){T.logDropdownSearchAction({result:e,user:h.props.user,action_type:O.WebUserActionLogEvent.CLICK_PATH_LINK,viewport:"dropdown-view"}),h.props.onSearchBarPathClicked(e)},h.setFilesViewControllerRef=function(e){h.filesViewControllerRef=e},h.handleSearchFromSearchResults=function(e,t,r){h.props.onSearch(e,t,!1,r)},h.handleFocusSearchBar=function(){return document.getElementsByClassName("search-bar__text-input")[0].focus()},h.renderSharedWithController=function(t){var r=h.props,o=r.context;if(!r.arePostTTIModulesLoaded)return null;if(t.type===i.FileTypes.TEAM_SHARED_FOLDER&&("archived"===t.team_folder_status||"archive_in_progress"===t.team_folder_status))return null;var a=h.props.selectedFiles,n=!!a.size,l=e("modules/clean/react/browse/shared_with").SharedWithController;return s.createElement("div",{className:"brws-vertically-center brws-shared-with-wrapper"},s.createElement(l,{file:t,browseContext:o,inSelectMode:n}))},h.renderAppContent=function(e){return h.props.isSearchMode?h.renderSearchResults(e):h.renderFilesViewController(e)},h.getPageHeaderHeight=function(e){return e.isMatchedLarge||e.isMatchedMedium?c.DEFAULT_PAGE_HEADER_HEIGHT:c.COMPACT_PAGE_HEADER_HEIGHT},h.renderSidebar=function(e){var t=h.props,o=t.fileCategories,a=t.isNautilusEnabled,n=t.isPaperEnabled;return s.createElement(p.BrowseSidebar,r.__assign({},h.props,{onSearch:h.handleSearchFromSearchResults,onUploadButtonClick:h.handleUploadButtonClick,onGetFileActionsForFiles:h.handleGetFileActionsForSetOfFiles,responsive:e,fileCategories:o,isNautilusEnabled:a,isPaperEnabled:n}))},h.hideTimeline=function(){h.props.onHideTimeline()},h.state={searchBarProps:h.getCurrentSearchBarProps(h.props),fileIdToActionCategories:{},searchBarAbandoned:!1},window.addEventListener(E.SEARCH_BAR_ABANDONED_EVENT,h.onSearchBarAbandonedEvent),h}return r.__extends(A,t),A.prototype.componentWillReceiveProps=function(e){return r.__awaiter(this,void 0,void 0,function(){return r.__generator(this,function(t){switch(t.label){case 0:return e.isSearchMode===this.props.isSearchMode&&e.path===this.props.path||this.setState({searchBarProps:this.getCurrentSearchBarProps(e)}),this.props.files===e.files?[3,2]:[4,this.getAppActions(e.files,e.path)];case 1:t.sent(),t.label=2;case 2:return[2]}})})},A.prototype.componentDidMount=function(){return r.__awaiter(this,void 0,void 0,function(){return r.__generator(this,function(t){switch(t.label){case 0:return[4,P.waitForTTI()];case 1:return t.sent(),
this.defineFileUploader(),this.maybeOpenUploaderOnMount(),new Promise(function(t,r){e(["modules/clean/growth/experiments/overquota_helper"],t,r)}).then(r.__importStar).then(function(e){e.OverquotaHelper.maybeShowSubgrowthProOQRecurringModal("wb_oq_ups_recur_fb")}),I.UEClient.sendEvent("BrowseView","componentDidMount",this.props.context.toJSON()),[4,this.getAppActions(this.props.files,this.props.path)];case 2:return t.sent(),[2]}})})},A.prototype.componentDidUpdate=function(){this.props.loadingState===g.LoadingState.LOADED&&I.UEClient.sendEvent("BrowseView","componentDidUpdate",this.props.context.toJSON())},A.prototype.componentWillUnmount=function(){window.removeEventListener(E.SEARCH_BAR_ABANDONED_EVENT,this.onSearchBarAbandonedEvent)},A.prototype.maybeOpenUploaderOnMount=function(){this.props.shouldOpenUploadModal&&this.handleShowFileUploader()},A.prototype.getCurrentDropTargetHighlightMode=function(){var e=this.props,t=e.selectedFiles,r=e.context;return r.isInsideSharedFolder&&x.includes(r.currentSharedFolderPermissionRole)?g.DropTargetHighlightMode.NONE:this.props.isDraggingInternalFiles?t.some(function(e){return e.isDeleted||e.type===i.FileTypes.TEAM_SHARED_FOLDER})?g.DropTargetHighlightMode.NONE:t.some(function(e){return e.type===i.FileTypes.SHARED_FOLDER})?r.currentNSAllowsNesting?g.DropTargetHighlightMode.NONSELECTED_FOLDERS:g.DropTargetHighlightMode.NONSELECTED_NONSHARED_FOLDERS:g.DropTargetHighlightMode.NONSELECTED_FOLDERS:this.props.isDraggingExternalFiles&&!this.props.isUploadModalOpen?g.DropTargetHighlightMode.ALL_FOLDERS:g.DropTargetHighlightMode.NONE},A.prototype.getCurrentSearchBarProps=function(e){return{showSearchBar:!0,currentPath:e.path,onSearch:this.handleSearchFromSearchBar,onSearchResultOpen:this.handleSearchResultOpen,onResultObjectPathClick:this.handleResultObjectPathClick,isSearchBarExpanded:e.isSearchMode,searchBarExperiments:e.searchBarExperiments,onSearchFiltersChanged:e.onSearchFiltersChanged,searchFrom:e.searchFrom}},A.prototype.getFilesViewControllerRef=function(){return this.filesViewControllerRef},A.prototype.renderSearchSuccessBanner=function(){var e=this.props.searchBarExperiments,t=e.expSearchSuccessBanner,r=this.state.searchBarAbandoned||F.shouldShowSearchSuccessBanner();return t&&!F.isFilePreview()&&!F.userIsOptedOutOfSearchSuccessBanner()&&r?s.createElement(v.SearchSuccessBanner,{user:this.props.user,displayContext:E.SearchSuccessDisplayContext.IN_EMBEDDED_APP}):null},A.prototype.getAppActions=function(e,t){return r.__awaiter(this,void 0,void 0,function(){var o,s,a=this;return r.__generator(this,function(n){switch(n.label){case 0:return[4,P.waitForTTI()];case 1:return n.sent(),o=[],e.toArray().forEach(function(e){e&&e instanceof u.File&&!e.isDeleted&&o.push(e)}),[4,this.props.appActionsStore.getActionsForFileBatch(o,this.props.user.id)];case 2:return s=n.sent(),this.setState(function(e){return a.props.path===t?{fileIdToActionCategories:r.__assign({},e.fileIdToActionCategories,s)}:e}),[2]}})})},A.prototype.renderSearchResults=function(e){var t=this.props,r=t.actionHandlers,o=t.filesViewActionHandlers,n=t.fileRename,i=t.path,l=t.user,c=t.handleComponentTTI,d=t.isFileViewerShown,u=t.arePostTTIModulesLoaded,p=t.getIsFileJumping,h=t.ensureFileViewerClosedIfNotPreviewing,_=t.browseExperiments,f=t.searchResultsExperiments,S=t.searchBarExperiments,g=t.onNavigateToParentFolder,w=t.onNavigateToPath,E=t.shouldShowDeletedFiles,v=t.onNavigateToFileOrFolder,F=t.onSearchFiltersChanged,T=t.starredState,C=t.fileCategories,A=t.isPaperEnabled,R=t.viewType;return s.createElement("div",null,this.renderSearchSuccessBanner(),s.createElement(b.SearchResultsController,{actionHandlers:r,filesViewActionHandlers:o,path:i,user:l,searchResultsExperiments:f,searchBarExperiments:S,browseExperiments:_,onSearch:this.handleSearchFromSearchResults,setFileUploaderPath:m.FileUploaderController.setPathAndPermissions,maestroSearchBarProps:this.state.searchBarProps,handleComponentTTI:c,ensureFileViewerClosedIfNotPreviewing:h,getIsFileJumping:p,renderSharedWithController:this.renderSharedWithController,hrefForFile:a.href_for_file,isFileViewerShown:d,fileRename:n,arePostTTIModulesLoaded:u,getOverflowMenuActions:this.handleGetOverflowMenuActions,onFocusSearchBar:this.handleFocusSearchBar,onNavigateToFileOrFolder:v,onNavigateToParentFolder:g,onNavigateToPath:w,onOpenPaper:this.handleOpenPaper,shouldShowDeletedFiles:y.isInDeletedFilterRightRailExperiment(S)?E:void 0,responsive:e,onSearchFiltersChanged:F,starredState:T,viewType:R,fileCategories:C,isPaperEnabled:A,pageHeaderHeight:this.getPageHeaderHeight(e)}))},A.prototype.renderFilesViewController=function(e){var t=this.props.shouldShowPinnedTeamFolders,o=t?this.props.filesWithoutTeamFolders:this.props.files;return s.createElement("div",{className:"maestro-browse-app-content"},this.renderSearchSuccessBanner(),s.createElement(_.WebTeamSharingModalExperiment,{context:this.props.context,user:this.props.user,path:this.props.path,selectedFiles:this.props.selectedFiles,browsePostTTIExperiments:this.props.browsePostTTIExperiments}),s.createElement(S.FilesViewController,r.__assign({},this.props.filesViewActionHandlers,{disabledMultiselect:this.props.isTimelineVisible,getOverflowMenuActions:this.handleGetOverflowMenuActions,renderSharedWithController:this.renderSharedWithController,hrefForFile:a.href_for_file,onLocationLinkClick:this.handleLocationLinkClick,onNavigateToFileOrFolder:this.props.onNavigateToFileOrFolder,onNavigateToParentFolder:this.props.onNavigateToParentFolder,onOpenPaper:this.handleOpenPaper,onFocusSearchBar:this.handleFocusSearchBar,context:this.props.context,createNewFolderState:this.props.createNewFolderState,currentSort:this.props.currentSort,dropTargetHighlightMode:this.getCurrentDropTargetHighlightMode(),fileRename:this.props.fileRename,items:o,responsive:e,getIsFileJumping:this.props.getIsFileJumping,isDraggingExternalFiles:this.props.isDraggingExternalFiles,isDraggingInternalFiles:this.props.isDraggingInternalFiles,isFileViewerShown:this.props.isFileViewerShown,isOverFreeQuota:this.props.isOverFreeQuota,shouldShowPinnedTeamFolders:t,arePostTTIModulesLoaded:this.props.arePostTTIModulesLoaded,fileIdToActionCategories:this.state.fileIdToActionCategories,isTextSelectable:this.props.isTextSelectable,loadingState:this.props.loadingState,onComponentTTI:this.props.handleComponentTTI,onSelectionChange:this.handleSelectionChange,onSortChange:this.handleFileListSortChange,onStarClick:this.handleStarClick,path:this.props.path,ref:this.setFilesViewControllerRef,selectedFiles:this.props.selectedFiles,selection:this.props.selection,setFileUploaderPath:m.FileUploaderController.setPathAndPermissions,showFileUploaderModal:this.handleShowFileUploader,teamFolders:this.props.teamFolders,totalNumFiles:this.props.totalNumItems,user:this.props.user,viewType:this.props.viewType,isQueryingFolderSizes:this.props.isQueryingFolderSizes,columns:this.props.columns,viewTypeColumns:this.props.viewTypeColumns,viewTypes:f.AllViewTypes,viewTypeLabels:f.ViewTypeLabels,starredState:this.props.starredState,pageHeaderHeight:this.getPageHeaderHeight(e)})))},A.prototype.defineFileUploader=function(){m.FileUploaderController.loadCoreComponent()},A.prototype.render=function(){var e=this.props,t=e.user,r=e.path,o=e.isDraggingExternalFiles,a=e.isDraggingInternalFiles,n=e.isUploadModalOpen,i=e.isSearchMode,l=e.context,c=e.isTimelineVisible,d=e.onSetUrl;return s.createElement("div",null,s.createElement(B,{user:t,browseContext:l,hideTimeline:this.hideTimeline,isTimelineVisible:c}),s.createElement(w.MaestroChrome,{user:t,titleRegion:s.createElement(h.BrowseTitle,{path:r,user:t,isDraggingExternalFiles:o,isDraggingInternalFiles:a,isUploadModalOpen:n,isSearchMode:i,onSetUrl:d}),titleClass:"page-header__title-overflow",embeddedAppRegion:this.renderAppContent,actionSidebarRegion:this.renderSidebar,searchBarProps:this.state.searchBarProps}))},A.defaultProps={selectedFiles:o.OrderedMap(),viewType:g.ViewType.List},A})(s.PureComponent);t.BrowseView=M;var B=N.Loadable({loader:function(){return r.__awaiter(L,void 0,void 0,function(){var t;return r.__generator(this,function(o){switch(o.label){case 0:return[4,P.waitForTTI()];case 1:return o.sent(),[4,new Promise(function(t,r){e(["modules/clean/react/timeline/timeline"],t,r)}).then(r.__importStar)];case 2:return t=o.sent().Timeline,[2,t]}})})}})}),define("modules/clean/react/browse/dispatcher",["require","exports","tslib","modules/core/exception","modules/clean/flux/dispatcher","modules/clean/react/browse/store"],function(e,t,r,o,s,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),t.BrowseDispatcher={dispatch:function(e){o.assert(a.browseStoreInstantiated(),"Must call getBrowseStore() before a dispatch"),s.Dispatcher.dispatch(e)}}}),define("modules/clean/react/browse/global_actions",["require","exports","tslib","external/lodash","external/react","modules/clean/analytics","modules/clean/cloud_docs/constants","modules/clean/cloud_docs/new_file_menu","modules/clean/filepath","modules/clean/react/browse/action_logger","modules/clean/react/async_file_modal_controller","modules/clean/react/async_onboarding_move_modal","modules/clean/react/browse/actions","modules/clean/react/browse/nav_actions","modules/clean/react/file_uploader/action_logger","modules/clean/react/modal","modules/clean/sharing/access_level","modules/clean/sharing/browse_exports","modules/clean/sharing/constants","modules/clean/viewer","modules/core/browser","modules/core/exception","modules/core/i18n","modules/core/notify","modules/clean/user_education/user_education_client","modules/clean/web_user_action_events"],function(e,t,r,o,s,a,n,i,l,c,d,u,p,h,_,m,f,S,g,w,E,v,F,y,T,b){"use strict";function C(t){var r=t.arePostTTIModulesLoaded,l=t.context,c=t.user,d=t.viewType,p=t.showDeletedFiles,h=t.onUpload,f=void 0===h?o.noop:h,g=t.isNoComment,F=void 0!==g&&g,y=t.autoTeamGroupId,C=(t.browseExperiments,t.browsePostTTIExperiments),R=l.isCurrentlyInRoot,I=!l.canViewContainingNSMembers,P=l.isCurrentPathWriteable(),q=E.is_input_webkitdirectory_supported(),V={className:"action-upload",label:D(A.UploadFiles),popoverLabel:D(A.Files),iconName:q?"upload-file":"upload",performAction:function(){return f(!1)},disabled:!P},H=q?{className:"action-upload",label:D(A.UploadFolder),popoverLabel:D(A.Folder),iconName:"upload-folder",performAction:function(){return f(!0)},disabled:!P}:void 0,W=!l.isInsideSandboxFolder,G=C.expTimeline,j=C.expEnableCloudDocsPaperCreate,Q=C.expEnableCloudDocsGddCreate,z=C.expCloudDocsFileCreatePrimaryButton,K=function(){return s.createElement(i.NewFileMenu,{key:"new-file-menu",user:c,source:n.NewFileMenuFromType.BROWSE,path:l.currentFQPath,disabled:!P,showGdd:!!Q,showPaper:!!j,primaryButton:!1})},Y=function(){return s.createElement(i.NewFileMenu,{key:"new-file-menu",user:c,source:n.NewFileMenuFromType.BROWSE,path:l.currentFQPath,disabled:!P,showGdd:!!Q,showPaper:!!j,primaryButton:!0})},J=[];if(l.isInsideTeamFolderTree||!l.isInsideDeletedSharedFolder&&!l.isInsideDeletedNestedSharedFolder)if(l.isInsideDeletedFolder)J.push({label:D(A.RestoreFolder),iconName:"restore",className:"action-restore",performAction:M(c,d,l),disabled:!P});else{var X={label:D(A.NewFolder),iconName:"new-folder",performAction:N(c,d,l,y,C.expSubgrowthProOQNewFolder,C.expNewFolderModal),disabled:!P,className:"action-new-folder"},Z={label:D(R?A.NewSharedFolder:A.ShareFolder),iconName:"new-shared-folder",performAction:L(c,l,C.expSubgrowthProOQNewFolder),disabled:I,className:"action-share-folder"},$={label:D(A.NewTeamFolder),iconName:"new-team-folder",performAction:U(c,l),disabled:!1,className:"action-team-folder"};if(c.is_cdm_member&&"/"===l.currentFQPath){T.UEClient.registerBulkCallbackForEducationStep([{moduleName:"trial_admin_setup_team_space",stepName:"team_folder_modal"},{moduleName:"trial_admin_setup_team_space_v2",stepName:"team_folder_modal"},{moduleName:"trial_admin_setup_team_space_mobile",stepName:"team_folder_modal"},{moduleName:"trial_admin_setup_team_space_mobile_v2",stepName:"team_folder_modal"},{moduleName:"trial_admin_setup_folder_structure",stepName:"team_folder_modal"},{moduleName:"trial_admin_setup_folder_structure_v2",stepName:"team_folder_modal"}],X.performAction);var ee=function(e){a.TeamsWebActionsLogger.log(e),window.setTimeout(function(){T.UEClient.sendEvent("SetStructureModal","Close")},2500),m.Modal.close()};T.UEClient.registerBulkCallbackForEducationStep([{moduleName:"trial_admin_shared_workspace",stepName:"set_structure_modal"},{moduleName:"trial_admin_shared_workspace_v2",stepName:"set_structure_modal"}],function(){var e={user:c,teamName:w.Viewer.get_viewer().team_name,onSuccess:function(){return ee("uj_ss_modal_success")},onError:function(){return ee("uj_ss_modal_error")},onCancel:function(){return ee("uj_ss_modal_cancel")}};u.showOnboardingMoveDialog(e)}),z&&J.push(Y),J.push(V),q&&J.push(H),J.push(X),z||J.push(K)}else if(R)z&&J.push(Y),J.push(V),q&&J.push(H),!c.is_cdm_member&&S.GoldenGate.hasContentManagerAndSuperAdmin(c.id)&&J.push($),J.push(Z,X),z||J.push(K);else{W&&J.push(Z);var te=!W&&!!z;te&&J.push(Y),J.push(V),q&&J.push(H),J.push(X),te||J.push(K)}F||J.push({label:D(p?A.HideDeletedFiles:A.ShowDeletedFiles),iconName:p?"hide":"show-deleted-files",performAction:x(c,d,p),disabled:I,className:"action-deleted-files"}),!w.Viewer.get_viewer().is_assume_user_session&&(S.GoldenGate.hasContentManagerAndSuperAdmin(c.id)&&S.GoldenGate.hasNewOwnershipModel(c.id)&&l.isInsideTeamFolderTree||!c.is_cdm_member&&S.GoldenGate.hasContentManagerAndSuperAdmin(c.id)&&l.isCurrentlyInRoot)&&J.push({label:D(A.ManageAsAdmin),iconName:"settings-gear",performAction:U(c,l)}),G&&J.push({label:D(A.ViewTimeline),iconName:"view-version-history",performAction:O(c,l)})}else J.push({label:D(A.ReAddSharedFolder),iconName:"restore",performAction:B(c,l),disabled:!P});if(H&&J[0]===V){v.assert(J[1]===H,"`uploadFolderItem` does not immediately follow `uploadFilesItem`");var re={className:"action-upload",label:D(A.Upload),iconName:"upload",performAction:function(){return _.logUploadAction(c.id,b.WebUserActionLogEvent.UPLOAD_CLICK)},disabled:!P,subItems:[V,H]};J.splice(0,2,re)}if(r){var oe=e("modules/clean/unity/features"),se=C.expSubgrowthBizTeamsTriggersClientLinkWork||"";["V1","V2"].includes(se)&&null!=oe&&c.is_team&&J.push({iconName:"monitor",label:D(A.ShowLocalCopy),performAction:k(c,l)})}return J}Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),s=r.__importStar(s),l=r.__importStar(l),d=r.__importStar(d),_=r.__importStar(_),E=r.__importStar(E);var A;(function(e){e[e.UploadFiles=1]="UploadFiles",e[e.UploadFolder=2]="UploadFolder",e[e.Upload=3]="Upload",e[e.Files=4]="Files",e[e.Folder=5]="Folder",e[e.NewPaperDoc=6]="NewPaperDoc",e[e.NewFolder=7]="NewFolder",e[e.RestoreFolder=8]="RestoreFolder",e[e.ReAddSharedFolder=9]="ReAddSharedFolder",e[e.ShowDeletedFiles=10]="ShowDeletedFiles",e[e.HideDeletedFiles=11]="HideDeletedFiles",e[e.NewSharedFolder=12]="NewSharedFolder",e[e.ShareFolder=13]="ShareFolder",e[e.ManageAsAdmin=14]="ManageAsAdmin",e[e.NewTeamFolder=15]="NewTeamFolder",e[e.ShowLocalCopy=16]="ShowLocalCopy",e[e.ViewTimeline=17]="ViewTimeline"})(A||(A={}));var R={},I=function(){return E.mac?F._("Show in Finder"):E.windows?F._("Show in Explorer"):F._("Show local copy")},P=function(e){switch(e){case A.UploadFiles:return F._("Upload files");case A.UploadFolder:return F._("Upload folder");case A.Upload:return F._("Upload");case A.ViewTimeline:return F._("View Timeline");case A.Files:return F._("Files");case A.Folder:return F._("Folder");case A.NewPaperDoc:return F._("New Paper Document");case A.NewFolder:return F._("New folder");case A.RestoreFolder:return F._("Restore folder");case A.ReAddSharedFolder:return F._("Re-add shared folder");case A.ShowDeletedFiles:return F._("Show deleted files");case A.HideDeletedFiles:return F._("Hide deleted files");case A.NewSharedFolder:return F._("New shared folder");case A.ShareFolder:return F._("Share folder");case A.ManageAsAdmin:return F._("View in admin console");case A.NewTeamFolder:return F._("New team folder");case A.ShowLocalCopy:return I()}},D=function(e){return e in R||(R[e]=P(e)),R[e]},N=function(t,o,s,a,n,i){return function(){if("V1"===n)new Promise(function(t,r){e(["modules/clean/growth/experiments/overquota_helper"],t,r)}).then(r.__importStar).then(function(e){e.OverquotaHelper.showSubgrowthProOQNewFolderModal({oqa:"wb_oq_ad_fo_fi"})});else{var u=s.currentNSID,_=s.currentFQPath;if(c.logCreateFolder({uid:t.id,view_type:o,file_nsid:u,file_path:_,file_name:l.filename(_)}),t.is_cdm_member&&"/"===_){v.assert(!!a,"All CDM Users should have an auto team group in their team");var m=function(){y.Notify.error(F._("There was a problem completing this request.")),p.browseActions.cancelCreateFolder()},g=function(e){var t=e.user,r=e.folderName,o=e.fqPath;p.browseActions.createFolderComplete({user:t,folderName:r,changesets:null}),p.browseActions.selectFilesByFqPath({fqPathsToSelect:[o]}),i&&p.browseActions.handleNewFolderRedirectOnSuccess(o)};S.asyncShowAppropriateNewFolderModalForCdmUser({user:t,context:s,autoTeamGroupId:a,showFileSystemWarningsModal:d.showFileSystemWarningsModal,onPending:p.browseActions.createFolderPending,onComplete:g,onCancel:m,autoTeamGroupDefaultAccessLevel:f.ACCESS_LEVEL.WRITER,setPath:h.browseNavActions.setPath,setUrl:h.browseNavActions.setUrl})}else if(i){var w=function(e){var r=e.folderName,o=e.isConfidential;p.browseActions.createFolderInNewFolderModal({folderName:r,isConfidential:o,user:t,context:s})};S.asyncShowCdmNewFolderModal(w,t,s,!1,!1,!0)}else p.browseActions.nameNewFolder();"CONTROL"===n&&new Promise(function(t,r){e(["modules/clean/growth/experiments/overquota_helper"],t,r)}).then(r.__importStar).then(function(e){e.OverquotaHelper.logExposureSubgrowthProOQNewFolderModal("CONTROL")})}}},O=function(e,t){return function(){p.browseActions.showTimeline()}},L=function(t,o,s){return function(){"V1"===s?new Promise(function(t,r){e(["modules/clean/growth/experiments/overquota_helper"],t,r)}).then(r.__importStar).then(function(e){e.OverquotaHelper.showSubgrowthProOQNewFolderModal({oqa:"wb_oq_ad_shfo_fi"})}):o.isCurrentlyInRoot?S.asyncShowShareAFolderWizardModal(t):S.asyncShowShareModal(t,o,{origin:g.SHARE_ACTION_ORIGIN_TYPE.BROWSE_GLOBAL_ACTIONS},h.browseNavActions.setPath,h.browseNavActions.setUrl),"CONTROL"===s&&new Promise(function(t,r){e(["modules/clean/growth/experiments/overquota_helper"],t,r)}).then(r.__importStar).then(function(e){e.OverquotaHelper.logExposureSubgrowthProOQNewFolderModal("CONTROL")})}},x=function(e,t,r){return function(){c.logToggleDeletedFiles({uid:e.id,show_deleted_files:!r,view_type:t}),p.browseActions.setShouldShowDeletedFiles({shouldShowDeletedFiles:!r})}},M=function(e,t,r){return function(){var o=r.currentNSID,s=r.currentFQPath;c.logRestore({uid:e.id,view_type:t,file_nsid:o,file_path:s,file_name:l.filename(s),num_files_selected:0,num_folders_selected:1}),p.browseActions.doRestoreFilesWithUnifiedTrashModal({})}},B=function(e,t){return function(){var r=t.currentFQPath.toLowerCase(),o=t.inactiveNSIDByFQPath[r],s=t.isInsideDeletedNestedSharedFolder;o&&S.asyncMountSharedFolder(o,e.role,g.SHARE_ACTION_ORIGIN_TYPE.BROWSE_GLOBAL_ACTIONS,!1,null,s)}},U=function(e,t){return function(){S.asyncGoToContentManagerForPath({isLimitedTeam:w.Viewer.get_viewer().team_is_limited,containingFolder:t.currentFQPath,isCDM:e.is_cdm_member})}},k=function(e,t){return function(){var r=t.currentNSID,o=t.currentFQPath,s=w.Viewer.get_viewer().team_id,a=E.get_uri().path;c.logOpenLocalCopyAction({event_name:"view_in_dropbox_link_clicked",team_id:s,url:a}),p.browseActions.openLocalCopy({fqPath:o,nsId:r,userId:e.id,onSuccess:function(){c.logOpenLocalCopyAction({event_name:"view_in_dropbox_client_open",team_id:s,url:a})},onError:function(e){c.logOpenLocalCopyAction({error_message:e,event_name:"view_in_dropbox_link_error",team_id:s,url:a}),y.Notify.error(F._("Please make sure you are logged into the same account on your Dropbox desktop app."))}})}};t.getGlobalActions=C}),define("modules/clean/react/browse/nav_actions",["require","exports","tslib","modules/clean/history","modules/clean/pagination_manager","modules/clean/react/browse/api","modules/clean/react/browse/constants","modules/clean/react/files_view/types","modules/clean/react/browse/dispatcher","modules/clean/react/browse/models","modules/clean/react/browse/store","modules/clean/react/selection","modules/clean/web_timing_logger","modules/core/browser","modules/core/uri"],function(e,t,r,o,s,a,n,i,l,c,d,u,p,h,_){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importDefault(o),a=r.__importStar(a),p=r.__importStar(p),h=r.__importStar(h);var m=(function(){function e(e){var t=this;this.dataApi=e,this.setPath=function(e){var r=e.path,o=e.onPathLoaded,a=e.logFetchedDataRequiredForTTI,u=void 0!==a&&a,_=e.ajaxWebTimer,m=d.getBrowseStore(),f=m.user().id;l.BrowseDispatcher.dispatch({type:n.BrowseActionType.SET_PATH,data:{path:r}}),t.setLoadingState({loadingState:i.LoadingState.LOADING_FIRST_PAGE,path:r});var S=function(e){var r=e.path,a=e.data,n=e.xhr;if(u&&p.log_js_modules_fetched_data_required_for_tti(),_){var l=n.getResponseHeader("x-dropbox-request-id");_.end(l?l:void 0)}t.setMountPoints({mountPoints:a.ns_id_to_mount_point});var d=c.BrowseContext.fromServerObject(a);if(a.paginated){t.clear({path:r,context:d});var h=a.first_page.total_num_items;s.PaginationManager.create({firstPage:a.first_page,keyName:"sjid",ajaxURL:"/browse_get_next",userID:f,newDataAvailableCallback:function(e,o){var s=e.areAllItemsReady()?i.LoadingState.LOADED:i.LoadingState.LOADING_REMAINING_PAGES;t.addFilesAndSetLoadingState({path:r,files:o,paginatedTotalNumFiles:h,loadingState:s}),e.areAllItemsReady()&&e.stopAutoFetching()}}).startAutoFetching()}else{var S=a.file_info,g=S?S.length:0;t.load({path:r,files:S,paginatedTotalNumFiles:g,context:d})}o&&o(m.context())};t.dataApi.loadPath({sortLabel:m.sortLabel(),sortIsAscending:m.sortIsAscending(),path:r,userId:f,sortFoldersFirst:!h.mac,includeDeletedFiles:m.shouldShowDeletedFiles(),onSuccess:S,onError:function(){"/"!==r&&t.setPath({path:"/",onPathLoaded:o})}})}}return e.prototype.setUrl=function(e){var t=e.path,r=(e.qargs,{});"1"===o.default.deconstruct_url().qargs.d&&(r.d="1");var s=t?_.URI.encode_parts(t):"";o.default.push_state(d.getBrowseStore().urlPrefix()+s,r),l.BrowseDispatcher.dispatch({type:n.BrowseActionType.SET_SELECTION,data:{selection:u.createSelection()}})},e.prototype.setLoadingState=function(e){var t=e.loadingState,r=e.path;l.BrowseDispatcher.dispatch({type:n.BrowseActionType.SET_LOADING_STATE,data:{loadingState:t,path:r}})},e.prototype.setMountPoints=function(e){var t=e.mountPoints;l.BrowseDispatcher.dispatch({type:n.BrowseActionType.SET_MOUNT_POINTS,data:{mountPoints:t}})},e.prototype.load=function(e){var t=e.path,r=e.files,o=e.paginatedTotalNumFiles,s=e.context;l.BrowseDispatcher.dispatch({type:n.BrowseActionType.LOAD_PATH,data:{path:t,files:r,paginatedTotalNumFiles:o,context:s}})},e.prototype.clear=function(e){var t=e.path,r=e.context;l.BrowseDispatcher.dispatch({type:n.BrowseActionType.CLEAR_FILES,data:{path:t,context:r}})},e.prototype.addFilesAndSetLoadingState=function(e){var t=e.path,r=e.loadingState,o=e.files,s=e.paginatedTotalNumFiles;l.BrowseDispatcher.dispatch({type:n.BrowseActionType.ADD_FILES_AND_SET_LOADING_STATE,data:{path:t,loadingState:r,files:o,paginatedTotalNumFiles:s}})},e.prototype.setDataApi=function(e){this.dataApi=e},e})();t.BrowseNavActions=m,t.browseNavActions=new m(a)}),define("modules/clean/react/browse/professional_collection_actions",["require","exports","tslib","external/lodash","modules/core/exception"],function(e,t,r,o,s){"use strict";function a(t,a,n){var i=o.keyBy(n,"file_id");if(!o.every(t,function(e){return!!i[e]}))return void s.reportException({err:new Error("Could not find specified files to add to Showcase")});var l=t.map(function(e){var t=i[e];return{ns_id:t.ns_id,ns_path:t.ns_path,fq_path:t.fq_path}});new Promise(function(t,r){e(["modules/clean/react/professional_collection/add_to_collection_modal_controller"],t,r)}).then(r.__importStar).then(function(e){(0,e.showAddToCollectionModal)(l,a)})}Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),t.showPrepopulatedAddToCollectionModal=a}),define("modules/clean/react/browse/sidebar",["require","exports","tslib","external/react","modules/clean/search/search_results/sidebar_view","modules/clean/react/browse/sidebar_view"],function(e,t,r,o,s,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),t.BrowseSidebar=function(e){var t=e.autoTeamGroupId,n=e.arePostTTIModulesLoaded,i=e.canDisplayFolderSizes,l=e.context,c=e.handleComponentTTI,d=e.isNoComment,u=e.isSearchMode,p=e.isTimelineVisible,h=e.selectedFiles,_=e.shouldShowDeletedFiles,m=e.starredState,f=e.user,S=e.viewType,g=e.uploaderExperiments,w=e.uploaderPostTTIExperiments,E=e.browseExperiments,v=e.browsePostTTIExperiments,F=e.uploadAjaxInterceptor,y=e.searchBarExperiments,T=e.actionHandlers,b=e.path,C=e.onSearch,A=e.onUploadButtonClick,R=e.onGetFileActionsForFiles,I=e.responsive,P=e.onSearchFiltersChanged,D=e.fileCategories,N=e.isNautilusEnabled,O=e.isPaperEnabled,L={user:f,selectedFiles:h,arePostTTIModulesLoaded:n,context:l,viewType:S,shouldShowDeletedFiles:_,responsive:I};return u?o.createElement(s.SearchResultsSidebarView,r.__assign({},L,{path:b,actionHandlers:T,searchBarExperiments:y,onSearch:C,onSearchFiltersChanged:P,fileCategories:D,isNautilusEnabled:N,isPaperEnabled:O})):o.createElement(a.BrowseSidebarView,r.__assign({},L,{isTimelineVisible:p,autoTeamGroupId:t,canDisplayFolderSizes:i,uploaderExperiments:g,uploaderPostTTIExperiments:w,browseExperiments:E,browsePostTTIExperiments:v,handleComponentTTI:c,onUploadButtonClick:A,isNoComment:d,onGetFileActionsForFiles:R,starredState:m,uploadAjaxInterceptor:F}))}}),define("modules/clean/react/browse/sidebar_view",["require","exports","tslib","external/react","modules/clean/react/app_actions_view","modules/clean/react/browse/global_actions","modules/clean/react/browse/util","modules/clean/react/file_uploader/file_uploader","modules/core/i18n"],function(e,t,r,o,s,a,n,i,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o);var c=(function(t){function c(e){var r=t.call(this,e)||this;return r.state={appActionsProps:r.getCurrentAppActionsProps(r.props)},r}return r.__extends(c,t),c.prototype.componentWillReceiveProps=function(e){e.selectedFiles===this.props.selectedFiles&&e.context===this.props.context&&e.user===this.props.user&&e.shouldShowDeletedFiles===this.props.shouldShowDeletedFiles&&e.isNoComment===this.props.isNoComment&&e.arePostTTIModulesLoaded===this.props.arePostTTIModulesLoaded&&e.viewType===this.props.viewType&&e.starredState===this.props.starredState&&e.canDisplayFolderSizes===this.props.canDisplayFolderSizes&&e.uploadAjaxInterceptor===this.props.uploadAjaxInterceptor&&e.responsive.isMatchedMedium===this.props.responsive.isMatchedMedium&&e.responsive.isMatchedLarge===this.props.responsive.isMatchedLarge&&e.uploaderExperiments===this.props.uploaderExperiments&&e.uploaderPostTTIExperiments===this.props.uploaderPostTTIExperiments&&e.browseExperiments===this.props.browseExperiments&&e.browsePostTTIExperiments===this.props.browsePostTTIExperiments||this.setState({appActionsProps:this.getCurrentAppActionsProps(e)})},c.prototype.renderSingleSelectionAudienceBox=function(t){var r=t.selectedFiles,s=t.arePostTTIModulesLoaded,a=t.context,n=r.first();if(s){var i=e("modules/clean/react/browse/shared_with").SharedWithController;return o.createElement(i,{file:n,browseContext:a,isInAudienceBox:!0})}return null},c.prototype.getCurrentAppActionsProps=function(t){function r(e){return"function"==typeof e?e:{displayName:e.label,popoverMenuName:e.popoverLabel,iconName:e.iconName,handleClick:e.performAction,disabled:e.disabled,className:e.className,badge:e.badge}}var s,i=t.selectedFiles,c=t.autoTeamGroupId,d=t.context,u=t.canDisplayFolderSizes,p=t.onGetFileActionsForFiles,h=t.user,_=t.viewType,m=t.shouldShowDeletedFiles,f=t.onUploadButtonClick,S=t.isNoComment,g=t.browseExperiments,w=t.browsePostTTIExperiments,E=t.arePostTTIModulesLoaded,v=t.handleComponentTTI,F=t.responsive,y=n.getSelectedFilesText(i,d),T=i.count(),b=o.createElement("div",null);if(T>0)s=p(i,u,F,!0,!0),1===T&&(b=this.renderSingleSelectionAudienceBox(t));else if(s=a.getGlobalActions({arePostTTIModulesLoaded:E,context:d,user:h,viewType:_,showDeletedFiles:m,onUpload:f,isNoComment:S,autoTeamGroupId:c,browseExperiments:g,browsePostTTIExperiments:w}),E){var C=e("modules/clean/react/browse/shared_with").SharedWithController;b=o.createElement(C,{browseContext:d,isInAudienceBox:!0})}var A,R=s[0];if(R)if("function"==typeof R)A=R;else{var I=void 0;R.subItems&&(I=R.subItems.map(r)),A={displayName:R.label,iconName:R.iconName,handleClick:R.performAction,disabled:R.disabled,className:R.className,subItems:I}}var P=s.slice(1).map(r);return t.isNoComment&&(b=o.createElement("div",null)),{headerText:y,popoverTriggerLabel:l._("Actions"),primaryMenuItem:A,primarySubnode:b,secondaryMenuItems:P,handleComponentTTI:v}},c.prototype.maybeRenderBrowseFileUploader=function(){var e=this.props,t=e.context,r=e.viewType,s=e.uploadAjaxInterceptor,a=e.uploaderExperiments,n=e.uploaderPostTTIExperiments;return null!=t.currentFQPath?o.createElement(i.FileUploaderController,{key:"file-uploader-controller",ref:"fileUploader",loadOnRender:!1,needToSetStoreValues:!1,ajaxInterceptor:s,uploaderExperiments:a,uploaderPostTTIExperiments:n,browseViewType:r}):null},c.prototype.render=function(){return o.createElement("div",{className:"maestro-browse-action-sidebar"},this.maybeRenderBrowseFileUploader(),o.createElement(s.AppActionsView,r.__assign({},this.state.appActionsProps,{responsive:this.props.responsive})))},c})(o.PureComponent);t.BrowseSidebarView=c}),define("modules/clean/react/browse/title",["require","exports","tslib","external/react","modules/core/i18n","modules/clean/browse_uri_interface","modules/clean/filepath","modules/clean/react/file_uploader/file_uploader","modules/clean/viewer","modules/clean/react/maestro/header","modules/clean/react/path_breadcrumbs"],function(e,t,r,o,s,a,n,i,l,c,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),n=r.__importStar(n);var u=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleGetUrlForPath=function(e){return a.browse_uri_for_fq_path(t.props.user,e).toString()},t}return r.__extends(t,e),t.setPageTitle=function(e){e&&(document.title=s._("%(folder_name)s - Dropbox").format({folder_name:n.filename(e,s._("Files"))}))},t.prototype.componentDidMount=function(){t.setPageTitle(this.props.path)},t.prototype.componentWillReceiveProps=function(e){e.path!==this.props.path&&t.setPageTitle(e.path)},t.prototype.render=function(){var e=this.props,t=e.path,r=e.user,a=e.isDraggingInternalFiles,u=e.isDraggingExternalFiles,p=e.isUploadModalOpen,h=e.isSearchMode,_=e.onSetUrl;if(h)return o.createElement(c.MaestroHeaderTitle,null,s._("Search results"));var m=n.filename("",l.Viewer.get_root_name(r)),f="work"===r.role?s._("Work"):s._("Personal");return o.createElement(d.PathBreadcrumbs,{path:t,isDraggingInternalFiles:a,setFileUploaderPath:i.FileUploaderController.setPathAndPermissions,getUrlForPath:this.handleGetUrlForPath,firstBreadcrumbName:m,firstBreadcrumbAlt:f,shouldHighlightDropTargets:a||u&&!p,setUrl:_})},t})(o.PureComponent);t.BrowseTitle=u}),define("modules/clean/react/browse/web_team_sharing_experiment",["require","exports","tslib","external/react","modules/clean/react/file_uploader/constants","modules/clean/react/async_fileops_modals","modules/clean/analytics","external/immutable","modules/clean/react/async/loadable","modules/clean/web_timing_logger"],function(e,t,r,o,s,a,n,i,l,c){"use strict";var d=this;Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),a=r.__importStar(a),i=r.__importStar(i);var u=l.Loadable({
loader:function(){return r.__awaiter(d,void 0,void 0,function(){var t;return r.__generator(this,function(o){switch(o.label){case 0:return[4,c.waitForTTI()];case 1:return o.sent(),[4,new Promise(function(t,r){e(["modules/clean/react/web_team_sharing_modal"],t,r)}).then(r.__importStar)];case 2:return t=o.sent().WebTeamSharingModal,[2,t]}})})}}),p=(function(t){function l(e){var r=t.call(this,e)||this;return r.removeUploadListener=function(){window.removeEventListener(s.ALL_UPLOADS_COMPLETE_EVENT,r.handleUploadsComplete)},r.closeTeamSharingModal=function(){return r.setState({isWebTeamSharingModalOpen:!1})},r.openFileMoveDialog=function(){r.closeTeamSharingModal(),n.TeamsWebActionsLogger.log("post_m1_sharing_modal_clicked"),a.showMove({files:r.props.selectedFiles.toArray(),path:r.props.context.currentFQPath,user:r.props.user})},r.state={isWebTeamSharingModalOpen:!1,uploadedFiles:[],expWebSharingActive:!1},r}return r.__extends(l,t),l.prototype.componentWillReceiveProps=function(t){return r.__awaiter(this,void 0,void 0,function(){var o,a,n,i=this;return r.__generator(this,function(l){switch(l.label){case 0:return!t.browsePostTTIExperiments.expBizAddFilesTeamFolderRwls||this.handleUploadsComplete?[3,2]:[4,new Promise(function(t,r){e(["modules/clean/growth/experiments/web_sharing_helper"],t,r)}).then(r.__importStar)];case 1:o=l.sent(),a=o.logExposure,n=o.shouldShowModal,this.handleUploadsComplete=function(e){if(n(i.props.user,i.props.path)){a();var t=e.detail.files;i.setState({isWebTeamSharingModalOpen:!0,uploadedFiles:t,expWebSharingActive:!0})}},window.addEventListener(s.ALL_UPLOADS_COMPLETE_EVENT,this.handleUploadsComplete),l.label=2;case 2:return[2]}})})},l.prototype.componentWillUnmount=function(){this.handleUploadsComplete&&this.removeUploadListener()},l.prototype.render=function(){return this.state.expWebSharingActive?o.createElement(u,{context:this.props.context,files:this.state.uploadedFiles,handleModalClose:this.closeTeamSharingModal,handleAction:this.openFileMoveDialog,open:this.state.isWebTeamSharingModalOpen,user:this.props.user}):null},l.defaultProps={selectedFiles:i.OrderedMap()},l})(o.PureComponent);t.WebTeamSharingModalExperiment=p}),define("modules/clean/react/file_uploader/action_logger",["require","exports","tslib","modules/clean/filepath","modules/clean/web_upload_action_logger","modules/clean/web_user_action_logger","modules/clean/web_user_action_events"],function(e,t,r,o,s,a,n){"use strict";function i(e){return e&&!!e.uploadId}function l(e){return e&&!!e.batchId}function c(e){return e===n.WebUserActionLogEvent.UPLOAD_BUTTON_CLICK||e===n.WebUserActionLogEvent.ADD_MORE_FILES_CLICK||e===n.WebUserActionLogEvent.VIEW_DETAILS_CLICK||e===n.WebUserActionLogEvent.CLOSE_MODAL_CLICK||e===n.WebUserActionLogEvent.DISMISS_INLINE_STATUS||e===n.WebUserActionLogEvent.UPLOAD_CLICK||e===n.WebUserActionLogEvent.UPLOAD_FILES_CLICK||e===n.WebUserActionLogEvent.UPLOAD_FOLDER_CLICK||e===n.WebUserActionLogEvent.CANCEL_UPLOAD_CLICK}function d(e,t,n,d,u,p,h){var _={num_files:p,num_dirs:h,chooser_type:d,upload_method:u};if(i(n)){var m=n;_=r.__assign({},_,{upload_id:m.uploadId,file_size:m.size,file_extension:o.file_extension(m.name),failure_reason:m.errorType,batch_id:m.batchId})}else if(l(n)){var m=n;_=r.__assign({},_,{file_size:m.size,file_extension:o.file_extension(m.name),batch_id:m.batchId})}c(t)?a.WebUserActionLog.log(e,t,_):(t=t,_.client_timestamp=Math.round(Date.now()/1e3),s.WebUploadActionLog.log(e,t,_))}Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),t.logUploadAction=d}),define("modules/clean/react/file_uploader/constants",["require","exports","tslib","external/immutable"],function(e,t,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o);(function(e){e.SET_PATH="UPLOADER_SET_PATH",e.SET_FOLDER_NS_ID="UPLOADER_SET_FOLDER_NS_ID",e.SET_USER="UPLOADER_SET_USER",e.SET_NUM_DRAGGING_FILES="SET_NUM_DRAGGING_FILES",e.QUEUE_UPLOADS="QUEUE_UPLOADS",e.START_UPLOAD="START_UPLOAD",e.COMPLETE_UPLOAD="COMPLETE_UPLOAD",e.CANCEL_UPLOADS="CANCEL_UPLOADS",e.SET_CURRENT_UPLOAD_PROGRESS="SET_CURRENT_UPLOAD_PROGRESS",e.UPLOAD_ERROR="UPLOAD_ERROR",e.SET_IS_UPLOAD_MODAL_OPEN="SET_IS_UPLOAD_MODAL_OPEN",e.SET_INLINE_STATUS_SHOULD_BE_DISMISSED="SET_INLINE_STATUS_SHOULD_BE_DISMISSED",e.ADD_NEW_FAILED_FILE="ADD_NEW_FAILED_FILE",e.CONFIRM_FSW="CONFIRM_FSW",e.ADD_FILES_TO_PLU="ADD_FILES_TO_PLU",e.ADD_DIRECTORIES_TO_PLU="ADD_DIRECTORIES_TO_PLU",e.REMOVE_FILES="REMOVE_FILES"})(t.UploaderActionType||(t.UploaderActionType={}));var s;(function(e){e.PENDING="PENDING",e.UPLOADING="UPLOADING",e.COMPLETE="COMPLETE",e.CANCELLED="CANCELLED",e.FAILED="FAILED"})(s=t.FileStatusType||(t.FileStatusType={}));var a;(function(e){e.FILE_SIZE_ERROR="FILE_SIZE_ERROR",e.HTTP_ERROR="HTTP_ERROR",e.CONNECTION_ERROR="CONNECTION_ERROR",e.OVER_QUOTA_ERROR="OVER_QUOTA_ERROR",e.LOCKED_TEAM_ERROR="LOCKED_TEAM_ERROR",e.IGNORED="IGNORED",e.EMPTY_OR_FOLDER="EMPTY_OR_FOLDER",e.FOLDER_SAFARI="FOLDER_SAFARI",e.PACKAGE_FILE="PACKAGE_FILE",e.GENERIC="GENERIC",e.BLOCKS_MISSING_ERROR="BLOCKS_MISSING_ERROR",e.COMMIT_HTTP_ERROR="COMMIT_HTTP_ERROR",e.UPLOAD_BLOCK_ERROR="UPLOAD_BLOCK_ERROR",e.CHUNKS_NOT_ENABLED_ERROR="CHUNKS_NOT_ENABLED_ERROR",e.SERVER_RESPONSE_ERROR="SERVER_RESPONSE_ERROR",e.SERVER_TOKEN_EMPTY_ERROR="SERVER_TOKEN_EMPTY_ERROR",e.SERVER_TOKENS_MISSING_ERROR="SERVER_TOKENS_MISSING_ERROR",e.SERVER_HASH_RESPONSE_ERROR="SERVER_HASH_RESPONSE_ERROR",e.BLOCK_RUNTIME_ID_MISSING_ERROR="BLOCK_RUNTIME_ID_MISSING",e.CLIENT_HASH_EMPTY_ERROR="CLIENT_HASH_EMPTY_ERROR",e.SERVER_HASH_EMPTY_ERROR="SERVER_HASH_EMPTY_ERROR",e.HASHES_NOT_EQUAL_ERROR="HASHES_NOT_EQUAL_ERROR",e.BLOCK_INDEX_ERROR="BLOCK_INDEX_ERROR",e.BLOCK_EMPTY_ERROR="BLOCK_EMPTY_ERROR",e.BLOB_EMPTY_ERROR="BLOB_EMPTY_ERROR",e.BLOB_MISSING_ERROR="BLOB_MISSING_ERROR",e.CLIENT_HASH_DIGEST_ERROR="CLIENT_HASH_DIGEST_ERROR",e.FILE_READER_NULL_RESULT_ERROR="FILE_READER_NULL_RESULT_ERROR",e.COMMIT_READINESS_ERROR="COMMIT_READINESS_ERROR",e.UPLOAD_PRECHECK_ERROR="UPLOAD_PRECHECK_ERROR"})(a=t.UploadErrorType||(t.UploadErrorType={}));(function(e){e.NONE="NONE",e.BASIC_OVER_QUOTA="BASIC_OVER_QUOTA",e.BASIC_NEAR_QUOTA="BASIC_NEAR_QUOTA",e.LIMITED_TEAM_USER_OVER_QUOTA="LIMITED_TEAM_USER_OVER_QUOTA",e.LIMITED_TEAM_TSD_OVER_QUOTA="LIMITED_TEAM_TSD_OVER_QUOTA",e.LOCKED_TEAM_USER_OVER_QUOTA="LOCKED_TEAM_USER_OVER_QUOTA"})(t.OverQuotaStatusType||(t.OverQuotaStatusType={}));var n=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t})(o.Record({uploadId:void 0,dest:"",ns_id:null,ns_path:null,userId:null,name:"",size:0,percentUploaded:0,status:s.PENDING,errorType:a.GENERIC,errorMessage:"",batchId:void 0},"FileUpload"));t.FileUpload=n,t.UPLOAD_BEGIN_EVENT="dbxUploadBegin",t.UPLOAD_CANCEL_EVENT="dbxUploadCancel",t.UPLOAD_COMPLETE_EVENT="dbxUploadComplete",t.ALL_UPLOADS_COMPLETE_EVENT="dbxAllUploadsComplete",t.UPLOAD_ERROR_EVENT="dbxUploadError";(function(e){e[e["4mb"]=0]="4mb",e[e["8mb"]=1]="8mb"})(t.ValidChunkSizeStrings||(t.ValidChunkSizeStrings={}))}),define("modules/clean/react/file_uploader/store",["require","exports","tslib","external/immutable","modules/clean/flux/base_store","modules/clean/react/browse/constants","modules/clean/react/file_uploader/constants","modules/clean/react/file_uploader/utils","modules/core/exception"],function(e,t,r,o,s,a,n,i,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o);var c=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype._init=function(){this._path="/",this._hasPermissionToUploadToFolder=!0,this._folderNsId=null,this._user=null,this._fileList=o.OrderedMap(),this._currentUploadId=null,this._numDraggingFiles=0,this._isInternalTransfer=!1,this._isUploadModalOpen=!1,this._inlineStatusShouldBeDismissed=!1,this._numSecondsLeft=0,this._confirmedFSWs=[],this._confirmedFSWBatchIds=[]},t.prototype.fileList=function(){return this._fileList},t.prototype.currentUpload=function(){var e=this._currentUploadId;if(!e)return null;var t=this._fileList.get(e);return t?t:null},t.prototype.numSecondsLeft=function(){return this._numSecondsLeft},t.prototype.isUploadCancelled=function(e){var t=this._fileList.get(e);return!!t&&t.status===n.FileStatusType.CANCELLED},t.prototype.inlineStatusShouldBeDismissed=function(){return this._inlineStatusShouldBeDismissed},t.prototype.path=function(){return this._path},t.prototype.folderNsId=function(){return this._folderNsId},t.prototype.hasPermissionToUploadToFolder=function(){return this._hasPermissionToUploadToFolder},t.prototype.user=function(){return this._user},t.prototype.nextUpload=function(){return this._fileList.find(function(e){return e.status===n.FileStatusType.PENDING})},t.prototype.numDraggingFiles=function(){return this._numDraggingFiles},t.prototype.isInternalTransfer=function(){return this._isInternalTransfer},t.prototype.isUploadModalOpen=function(){return this._isUploadModalOpen},t.prototype.confirmedFSWs=function(){return this._confirmedFSWs},t.prototype.confirmedFSWBatchIds=function(){return this._confirmedFSWBatchIds},t.prototype.setUser=function(e){var t=e.user;this._user=t,this.emit_change()},t.prototype.setPathData=function(e){var t=e.path,r=e.context;this._path=t,this._hasPermissionToUploadToFolder=r.isCurrentPathWriteable(),this.emit_change()},t.prototype.setPath=function(e){var t=e.path,r=e.hasPermissionToUploadToFolder,o=void 0===r||r;this._path=t,this._hasPermissionToUploadToFolder=o,this._confirmedFSWs=[],this.emit_change()},t.prototype.setFolderNsId=function(e){var t=e.folderNsId;this._folderNsId=t},t.prototype.initializeEverything=function(e){var t=e.path,r=e.context;this._path=t,this._hasPermissionToUploadToFolder=r.isCurrentPathWriteable(),this.emit_change()},t.prototype.queueUploads=function(e){for(var t=e.files,r={},o=0,s=t;o<s.length;o++){var a=s[o];r[a.uploadId]=a}this._fileList=this._fileList.merge(r),this.emit_change()},t.prototype.startUpload=function(e){var t=e.file;l.assert(null==this.currentUpload(),"can't start an unload while one is ongoing"),l.assert(null!=t,"missing file to upload"),l.assert(this._fileList.get(t.uploadId)===t,"failed to find file in file list"),this._fileList.get(t.uploadId)&&(this._fileList=this._fileList.update(t.uploadId,function(e){return e.set("status",n.FileStatusType.UPLOADING)}),this._currentUploadId=t.uploadId),this.emit_change()},t.prototype.completeUpload=function(e){var t=e.uploadId,r=this._fileList.get(t);r&&(t===this._currentUploadId&&r.status===n.FileStatusType.UPLOADING||l.reportStack("Tried to mark a file upload that is not currently uploading as complete",{exc_extra:{file:r.toString(),fileListLength:this._fileList.count(),uploadId:t,currentUploadId:this._currentUploadId}}),this._fileList=this._fileList.update(t,function(e){return e.set("status",n.FileStatusType.COMPLETE)})),this._currentUploadId=null,this.emit_change()},t.prototype.cancelUploads=function(e){for(var t=e.files,r=0,o=t;r<o.length;r++){var s=o[r];this._fileList=this._fileList.update(s.uploadId,function(e){return e.status===n.FileStatusType.PENDING||e.status===n.FileStatusType.UPLOADING?e.set("status",n.FileStatusType.CANCELLED):e}),s.uploadId===this._currentUploadId&&(this._currentUploadId=null)}this.emit_change()},t.prototype.setCurrentUploadProgress=function(e){var t=e.percentComplete,r=e.numSecondsLeft,o=this._currentUploadId;o&&(this._fileList=this._fileList.update(o,function(e){return e.set("percentUploaded",t)}),this._numSecondsLeft=r),this.emit_change()},t.prototype.handleUploadError=function(e){var t=e.uploadId,r=e.errorType,o=e.errorMessage,s=this._fileList.get(t);s&&(s.uploadId!==this._currentUploadId&&l.reportStack("Error reported for file upload that is not the current upload",{exc_extra:{file:s.toString(),fileListLength:this._fileList.count(),errorType:r,errorMessage:o}}),this._fileList=this._fileList.update(s.uploadId,function(e){return e.set("status",n.FileStatusType.FAILED).set("errorType",r).set("errorMessage",o)})),this._currentUploadId=null,this.emit_change()},t.prototype.setNumDraggingFiles=function(e){var t=e.numDraggingFiles,r=e.isInternalTransfer,o=void 0!==r&&r;this._numDraggingFiles=t,this._isInternalTransfer=o,this.emit_change()},t.prototype.setIsUploadModalOpen=function(e){var t=e.isUploadModalOpen;this._isUploadModalOpen=t,this.emit_change()},t.prototype.setInlineStatusShouldBeDismissed=function(e){var t=e.inlineStatusShouldBeDismissed;this._inlineStatusShouldBeDismissed=t,this.emit_change()},t.prototype.addNewFailedFile=function(e){var t=e.file,r=e.errorType,o=e.errorMessage;null==t.uploadId&&(t=t.set("uploadId",i.generateUploadId())),t=t.set("status",n.FileStatusType.FAILED).set("errorType",r).set("errorMessage",o),this._fileList=this._fileList.set(t.uploadId,t),this.emit_change()},t.prototype.confirmFSW=function(e){var t=this,r=e.fswIds,o=e.batchId;r.forEach(function(e){t._confirmedFSWs.includes(e)||t._confirmedFSWs.push(e)}),this._confirmedFSWBatchIds.includes(o)||this._confirmedFSWBatchIds.push(o)},t.prototype._new_payload=function(e){var t=e.action;switch(t.type){case a.BrowseActionType.INITIALIZE_EVERYTHING:this.initializeEverything(t.data);break;case a.BrowseActionType.APP_INIT:case n.UploaderActionType.SET_USER:this.setUser(t.data);break;case a.BrowseActionType.LOAD_PATH:this.setPathData(t.data);break;case n.UploaderActionType.SET_PATH:this.setPath(t.data);break;case n.UploaderActionType.SET_FOLDER_NS_ID:this.setFolderNsId(t.data);break;case n.UploaderActionType.QUEUE_UPLOADS:this.queueUploads(t.data);break;case n.UploaderActionType.START_UPLOAD:this.startUpload(t.data);break;case n.UploaderActionType.COMPLETE_UPLOAD:this.completeUpload(t.data);break;case n.UploaderActionType.CANCEL_UPLOADS:this.cancelUploads(t.data);break;case n.UploaderActionType.SET_CURRENT_UPLOAD_PROGRESS:this.setCurrentUploadProgress(t.data);break;case n.UploaderActionType.UPLOAD_ERROR:this.handleUploadError(t.data);break;case n.UploaderActionType.SET_NUM_DRAGGING_FILES:this.setNumDraggingFiles(t.data);break;case n.UploaderActionType.SET_IS_UPLOAD_MODAL_OPEN:this.setIsUploadModalOpen(t.data);break;case n.UploaderActionType.SET_INLINE_STATUS_SHOULD_BE_DISMISSED:this.setInlineStatusShouldBeDismissed(t.data);break;case n.UploaderActionType.ADD_NEW_FAILED_FILE:this.addNewFailedFile(t.data);break;case n.UploaderActionType.CONFIRM_FSW:this.confirmFSW(t.data)}},t})(s.Store);t.UploaderStoreClass=c,t.uploaderStore=new c}),define("modules/clean/react/file_uploader/utils",["require","exports","tslib","modules/clean/base64","modules/core/browser"],function(e,t,r,o,s){"use strict";function a(){return i()}function n(){return"batch-"+i()}function i(){for(var e="",t=0;t<16;++t)e+=String.fromCharCode(Math.floor(256*Math.random()));var r=o.encode(e);return r=r.replace(/\+/g,"-"),r=r.replace(/\//g,"_"),r=r.replace(/\=*$/,"")}function l(e,t){var r=0;return e.forEach(function(e){t.indexOf(e.status)!==-1&&(r+=e.size)}),r}function c(e,t,r){var o=t,s=0;return e.forEach(function(e,t){for(var a=0,n=e.split("/"),i=r.split("/");a<n.length&&a<i.length&&n[a]===i[a];)a++;a===n.length&&a>1&&a>s&&(s=a,o=Number(t))}),o}Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),s=r.__importStar(s),t.generateUploadId=a,t.generateBatchId=n,t.calculateSizeOfUploads=l,t.getNsId=c,t.getOQmodalOQALocationCode=function(e){return"/h"===(e||s.get_uri().path)?"ho":"fb"}}),define("modules/clean/react/fileops_actions",["require","exports","tslib","external/react","modules/core/notify","modules/core/i18n","modules/clean/em_string","modules/clean/filepath","modules/clean/react/async_file_modal_controller","modules/clean/file_operations/notifications","modules/clean/react/browse/api","modules/clean/react/browse/nav_actions","modules/clean/react_format","modules/clean/sharing/browse_exports","modules/clean/sharing/constants","modules/clean/react/browse/models","modules/clean/viewer"],function(e,t,r,o,s,a,n,i,l,c,d,u,p,h,_,m,f){"use strict";function S(e,t,r){var o=f.Viewer.get_viewer().team_name,n=w(e,t,o,r);if(null!=n){s.Notify.clear();var i=1===r.length,c=g(e,o,r.length),d=r[0]instanceof m.File&&i?a._("See owner"):void 0,p=function(){r[0]instanceof m.File&&h.asyncShowShareModal(e.id,r[0],{origin:_.SHARE_ACTION_ORIGIN_TYPE.BROWSE_FILE_ACTIONS},u.browseNavActions.setPath,u.browseNavActions.setUrl)};l.showMoveErrorModal({title:c,content:n,learnMoreLink:"/help/business/shared-folder-differences#owner_move_shared_folder",buttonString:d,onClick:p})}}function g(e,t,r){return"is_cdm_member"in e&&e.is_cdm_member?a.ungettext("Can’t move shared folder to the %(team_name)s team space","Can’t move shared folders to the %(team_name)s team space",r).format({team_name:n.Emstring.em_snippet(t,_.SNIPPET_SIZES.DISPLAY_NAME)}):a.ungettext("Can’t move shared folder to a team folder","Can’t move shared folders to a team folder",r)}function w(e,t,r,s){var l={VIEW_ONLY_ACCESS_ERROR:"view_only_access_error",OFF_TEAM_OWNER_ERROR:"off_team_owner_error",OWNER_ONLY_MANAGE_MEMBERSHIP_ERROR:"owner_only_manage_membership_error"},c=null;return t===l.OFF_TEAM_OWNER_ERROR?c=1===s.length?p.reactFormat(a._("The owner of <strong>%(file_name)s</strong> isn’t a member of %(team_name)s.").format({team_name:r,file_name:n.Emstring.em_snippet(i.filename(s[0].fq_path),_.SNIPPET_SIZES.FILENAME)}),{strong:o.createElement("strong",{style:{fontWeight:500}})}):a._("The owner of some of these shared folders isn’t a member of %(team_name)s.").format({team_name:r}):t===l.OWNER_ONLY_MANAGE_MEMBERSHIP_ERROR?c=1===s.length?"is_cdm_member"in e&&e.is_cdm_member?p.reactFormat(a._("Only the owner of <strong>%(file_name)s</strong> can move it to the %(team_name)s team space.").format({team_name:r,file_name:n.Emstring.em_snippet(i.filename(s[0].fq_path),_.SNIPPET_SIZES.FILENAME)}),{strong:o.createElement("strong",{style:{fontWeight:500}})}):p.reactFormat(a._("Only the owner of <strong>%(file_name)s</strong> can move it to a team folder.").format({file_name:n.Emstring.em_snippet(i.filename(s[0].fq_path),_.SNIPPET_SIZES.FILENAME)}),{strong:o.createElement("strong",{style:{fontWeight:500}})}):"is_cdm_member"in e&&e.is_cdm_member?a._("Only the owner can move some of these folders to the %(team_name)s team space.").format({team_name:r}):a._("Only the owner can move some of these folders to a team folder."):t===l.VIEW_ONLY_ACCESS_ERROR&&(c=1===s.length?p.reactFormat(a._("You can only view <strong>%(file_name)s</strong>. Ask an owner or editor of the folder for access to edit it.").format({file_name:n.Emstring.em_snippet(i.filename(s[0].fq_path),_.SNIPPET_SIZES.FILENAME)}),{strong:o.createElement("strong",{style:{fontWeight:500}})}):a._("You can’t edit some of these folders. Ask an owner or editor of the folders for access to edit them.")),c}Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),i=r.__importStar(i),l=r.__importStar(l),c=r.__importStar(c),d=r.__importStar(d),t.copyFiles=function(e){var o=e.files,s=e.newPath,n=e.checkFSWs,i=e.onSuccess,u=e.onRequestNotSent,p=e.onUndo,h=e.user,_=e.dataApi;!(void 0===_?d:_).copyFiles({files:o,newPath:s,checkFSWs:n,userId:h.id,onSuccess:function(n){var d=n.newFiles,u=n.changesets,_=n.rollbackHints,m=n.failureDetails;if(m){var f=function(){t.copyFiles(r.__assign({},e,{checkFSWs:!1}))};l.showFileSystemWarningsModal({fsws:m,onFinalAccept:f,confirmText:a._("Copy")})}else i&&i(d),c.notifyCopySuccess(o.length,h,u,s,_,function(){p&&p()})}})&&u&&u()},t.moveFiles=function(e){var o=e.path,n=e.files,i=e.newPath,u=e.checkFSWs,p=e.onSuccess,h=e.onRequestNotSent,_=e.onUndo,m=e.user,f=e.dataApi,g=void 0===f?d:f,w=function(o){var s=o.newFiles,d=o.changesets,u=o.rollbackHints,h=o.failureDetails;if(h){var f=function(){t.moveFiles(r.__assign({},e,{checkFSWs:!1}))};l.showFileSystemWarningsModal({fsws:h,onFinalAccept:f,confirmText:a._("Move")})}else c.notifyMoveSuccess(n.length,m,d,i,u,function(){_&&_()}),p&&p(s)},E=function(e){"This will result in losing ownership of these folders."===e?(s.Notify.clear(),l.showConfirmOwnershipTransferModal(function(){g.moveFiles({path:o,files:n,newPath:i,userId:m.id,onSuccess:w,allowOwnershipTransfer:!0})})):S(m,e,n)};!g.moveFiles({path:o,files:n,newPath:i,checkFSWs:u,userId:m.id,onSuccess:w,onError:E,allowOwnershipTransfer:!1})&&h&&h()}}),define("modules/clean/react/folder_dialog/constants",["require","exports","modules/core/i18n"],function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.KEY_SCOPE="folder_picker_keyboard_selection",t.INVALID_FOCUS_INDEX=-1,t.MAX_FOLDER_NAME_LENGTH=20,t.TEAM_MEMBER="team_member";(function(e){e[e.ACCESS=0]="ACCESS",e.LIMITED_ACCESS="locked",e.NO_ACCESS="no_access"})(t.ACCESS_LEVEL||(t.ACCESS_LEVEL={}));(function(e){e[e.COPY=0]="COPY",e[e.MOVE=1]="MOVE",e[e.UPLOAD=2]="UPLOAD"})(t.Operation||(t.Operation={}));(function(e){e[e.LOADING=0]="LOADING",e[e.ERROR=1]="ERROR",e[e.LOADED=2]="LOADED"})(t.FolderPickerLoadingState||(t.FolderPickerLoadingState={})),t.errorDialogProps={primaryAction:r._("Try again"),secondaryAction:r._("Cancel"),title:r._("Something went wrong on our end"),ariaLabel:"",open:!0,variant:"regular"},t.DIALOG_HEAD_HEIGHT=64,t.DIALOG_ACTIONS_HEIGHT=64,t.PATH_BREADCRUMB_HEIGHT=40,t.DIALOG_BODY_PADDING=26,t.LOADING_MIN_TIME=200,t.FOLDER_SUGGESTION_HEIGHT=89}),define("modules/clean/react/path_breadcrumbs",["require","exports","tslib","external/classnames","external/react","spectrum/icon_arrow","spectrum/icon_content","spectrum/popover","modules/clean/em_string","modules/clean/filepath","modules/core/i18n","modules/clean/user_education/react/user_education_effect","modules/clean/user_education/user_education_client","modules/clean/react/icon/icon_helper","modules/clean/react/title_bubble","modules/clean/react/search_success_banner/util"],function(e,t,r,o,s,a,n,i,l,c,d,u,p,h,_,m){"use strict";function f(e,t){return 20-(t?2.625:new l.Emstring(e).length)}function S(e,t,r,o){for(var s=e.split("/").filter(Boolean),a=[{path:"",icon:"folder_dropbox-small",folderName:t,alt:r}],n=h.spectrumFolderIcon({size:h.SpectrumIconSize.Small}),i=0;i<s.length;i++)e="/"+s.slice(0,i+1).join("/"),a.push({path:e,folderName:c.filename(e),icon:n,alt:d._("Folder")});if(a.length<3)return{dropdownCrumbs:[],inlineCrumbs:a,root:a[0]};for(var u=a[0]&&a[0].folderName||"",p=f(u,!1),_=a.map(function(e){return new l.Emstring(e.folderName||"").length}),m=1,S=_[a.length-1],i=a.length-2;i>=1&&(S+=1.64,S+=_[i],!(S>p));i--)m+=1;a.length===m+1&&(m+=1),1===m&&o===w.SMALL&&m++;var g=a.length-m;return{dropdownCrumbs:a.slice(0,g),inlineCrumbs:a.slice(g),root:a[0]}}function g(e){switch(e){case w.LARGE:return"right";case w.SMALL:return"right-small"}}Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importDefault(o),s=r.__importStar(s),c=r.__importStar(c);t.generateBreadcrumbData=S;var w;(function(e){e.LARGE="LARGE",e.SMALL="SMALL"})(w=t.PathBreadcrumbsSize||(t.PathBreadcrumbsSize={}));var E=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.render=function(){var e=this.props.path,t=this.props,a=t.firstBreadcrumbName,n=t.firstBreadcrumbAlt,i=t.isDraggingInternalFiles,l=t.shouldHighlightDropTargets,p=t.setFileUploaderPath,h=t.getUrlForPath,_=t.setUrl,m=t.size,g=t.disableDragging,E=S(e,a,n,m),F=E.dropdownCrumbs,T=E.inlineCrumbs,b=E.root,C=f(b&&b.folderName||"",F.length>0),A=o.default({"brws-path-breadrumbs":!0,"brws-path-breadrumbs--small":this.props.size===w.SMALL}),R="page-header-text u-l-fl";return T.length>1||F.length>0?s.createElement("span",{className:A},s.createElement("h1",{className:"ax-visually-hidden"},c.filename(e)),s.createElement("nav",{className:R,id:"path-breadcrumbs","aria-label":d._("Folder hierarchy"),role:"navigation"},F.length>0&&s.createElement(y,{crumbs:F,currentPath:e,isDraggingInternalFiles:i,shouldHighlightDropTargets:l,setFileUploaderPath:p,setUrl:_,size:m,disableDragging:g}),T.map(function(t,o){return s.createElement(v,r.__assign({},t,{key:encodeURI(t.path),isOnlyCrumb:0===o&&1===T.length&&0===F.length,index:o,isLastCrumb:o===T.length-1,maxWidth:C,currentPath:e,isDraggingInternalFiles:i,isHighlightedDropTarget:l,setFileUploaderPath:p,getUrlForPath:h,setUrl:_,size:m,disableDragging:g}))}))):s.createElement("span",{className:A},s.createElement("h1",{className:R},s.createElement(u.UserEducationEffect,{containerName:"PathBreadcrumbs",name:"HomeTitle",useSpan:!0},a)))},t.defaultProps={path:"/",isDraggingInternalFiles:!1,shouldHighlightDropTargets:!1,setFileUploaderPath:function(){},size:w.LARGE,disableDragging:!1},t})(s.PureComponent);t.PathBreadcrumbs=E;var v=(function(e){function t(t){var r=e.call(this,t)||this;return r.onDragEnterBreadcrumb=function(e){e.preventDefault(),e.target!==r.lastEnteredElement&&(r.props.disableDragging||(r.lastEnteredElement=e.target,r.dragEnterCount+=1,r.setState({isDraggedOver:!0}),r.props.isLastCrumb||r.props.setFileUploaderPath({path:r.props.path})))},r.onDragLeaveBreadcrumb=function(e){e.preventDefault(),r.props.disableDragging||(r.lastEnteredElement=null,r.dragEnterCount-=1,r.dragEnterCount<1&&(r.dragEnterCount=0,r.state.isDraggedOver&&(r.props.setFileUploaderPath({path:r.props.currentPath}),r.setState({isDraggedOver:!1}))))},r.onDropBreadcrumb=function(){r.setState({isDraggedOver:!1})},r.onDragOverBreadcrumb=function(e){e.preventDefault(),e.stopPropagation()},r.handleMouseEnter=function(){r.props.isDraggingInternalFiles&&r.setState({isDraggedOver:!0})},r.handleMouseLeave=function(){r.state.isDraggedOver&&r.setState({isDraggedOver:!1})},r.handleMouseUp=function(){r.state.isDraggedOver&&r.setState({isDraggedOver:!1})},r.navigateToFolder=function(e){m.resetSearchSuccessBannerSettings();var t=r.props.path;p.UEClient.sendEvent("BreadCrumbSegment","linkClicked",{path:t}),e.preventDefault(),r.props.setUrl({path:t})},r.eventHandlers={onDragEnter:r.onDragEnterBreadcrumb,onDragLeave:r.onDragLeaveBreadcrumb,onDrop:r.onDropBreadcrumb,onDragOver:r.onDragOverBreadcrumb,onMouseEnter:r.handleMouseEnter,onMouseLeave:r.handleMouseLeave,onMouseUp:r.handleMouseUp},r.state={isDraggedOver:!1},r}return r.__extends(t,e),t.prototype.componentDidMount=function(){this.dragEnterCount=0,this.lastEnteredElement=null},t.prototype.render=function(){var e,t=this.props,n=t.getUrlForPath,i=t.path,c=t.index,d=t.isOnlyCrumb,p=t.maxWidth,h=t.isLastCrumb,m=t.isHighlightedDropTarget,f=t.size,S=d?this.props.folderName:l.Emstring.em_snippet(this.props.folderName,p),w={"breadcrumb-segment":!0,"breadcrumb-segment--is-drop-target":!h&&m,"breadcrumb-segment--file-dragged-over":!h&&this.state.isDraggedOver},E=g(f);return e=h?s.createElement("span",r.__assign({},this.eventHandlers),S):s.createElement("span",r.__assign({className:"breadcrumb-segment__wrapper"},this.eventHandlers),s.createElement(u.UserEducationEffect,{containerName:"BreadCrumbSegment",name:"link-"+c,useSpan:!0},s.createElement("a",{href:n(i).toString(),onClick:this.navigateToFolder,className:o.default(w)},S)),s.createElement(a.IconArrow,{name:E})),this.props.folderName!==S?s.createElement(_.TitleBubble,{content:this.props.folderName,position:_.TitleBubble.POSITIONS.BOTTOM,className:"list-label__title-bubble"},e):e},t.defaultProps={isOnlyCrumb:!1,isDraggingInternalFiles:!1,isHighlightedDropTarget:!1,disableDragging:!1},t})(s.Component),F=(function(e){function t(t){var r=e.call(this,t)||this;return r.onDragEnter=function(e){e.preventDefault(),e.target!==r.lastEnteredElement&&(r.props.disableDragging||(r.lastEnteredElement=e.target,r.dragEnterCount+=1,r.setState({isDraggedOver:!0}),r.props.setFileUploaderPath({path:r.props.path})))},r.onDragLeave=function(e){e.preventDefault(),r.props.disableDragging||(r.lastEnteredElement=null,r.dragEnterCount-=1,r.dragEnterCount<1&&(r.dragEnterCount=0,r.state.isDraggedOver&&(r.props.setFileUploaderPath({path:r.props.currentPath}),r.setState({isDraggedOver:!1}))))},r.onDrop=function(e){r.setState({isDraggedOver:!1}),r.dragEnterCount=0,r.props.closeFunc()},r.onDragOver=function(e){e.preventDefault(),e.stopPropagation()},r.handleMouseEnter=function(){r.props.isDraggingInternalFiles&&r.setState({isDraggedOver:!0})},r.handleMouseLeave=function(){r.state.isDraggedOver&&(r.setState({isDraggedOver:!1}),r.props.closeFunc())},r.handleMouseUp=function(){r.state.isDraggedOver&&r.setState({isDraggedOver:!1}),r.props.isDraggingInternalFiles&&!r.props.isLastCrumb&&r.props.closeFunc()},r.state={isDraggedOver:!1},r}return r.__extends(t,e),t.prototype.componentDidMount=function(){this.dragEnterCount=0,this.lastEnteredElement=null},t.prototype.render=function(){var e=this.props,t=e.icon,a=e.alt,l=e.folderName,c={"breadcrumb-menu-item":!0,"breadcrumb-menu-item--is-drop-target":this.props.isHighlightedDropTarget,"breadcrumb-menu-item--file-dragged-over":this.state.isDraggedOver},d=s.createElement("span",{title:l,className:"breadcrumb-menu-item-wrapper"},s.createElement("span",{className:"breadcrumb-menu-item-icon"},s.createElement(n.IconContent,{name:t,alt:a})),s.createElement("span",{className:"breadcrumb-menu-item-text"},l));return s.createElement(i.PopoverContentItem,r.__assign({value:this.props.path,className:o.default(c)},{onDragEnter:this.onDragEnter,onDragLeave:this.onDragLeave,onDrop:this.onDrop,onDragOver:this.onDragOver,onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,onMouseUp:this.handleMouseUp}),d)},t.defaultProps={isHighlightedDropTarget:!1,closeFunc:function(){},alt:"",isDraggingInternalFiles:!1,disableDragging:!1},t})(s.Component),y=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={menuVisible:!1},t.onDragEnter=function(e){t.props.disableDragging||(e.preventDefault(),t.setState({menuVisible:!0}))},t.onInnerDragEnter=function(e){e.preventDefault(),t.dragEnterCount++},t.onDragLeave=function(e){e.preventDefault(),t.dragEnterCount--,t.dragEnterCount<1&&(t.dragEnterCount=0,t.state.menuVisible&&t.setState({menuVisible:!1}))},t.onMouseEnter=function(e){t.props.disableDragging||t.props.isDraggingInternalFiles&&!t.props.disableDragging&&(e.preventDefault(),t.setState({menuVisible:!0}))},t.onCrumbSelected=function(e){t.props.setUrl({path:e})},t.onPopoverToggle=function(e){var r=e.isOpen;t.setState({menuVisible:r})},t.onClose=function(){t.dragEnterCount=0,t.onPopoverToggle({isOpen:!1})},t}return r.__extends(t,e),t.prototype.componentDidMount=function(){this.dragEnterCount=0},t.prototype.render=function(){var e=this,t=this.props.crumbs.slice().reverse(),r=this.props,o=r.currentPath,l=r.shouldHighlightDropTargets,c=r.isDraggingInternalFiles,u=r.setFileUploaderPath,p=r.size,h=r.disableDragging,_=d._("Show parent folders (descending)"),m=s.createElement(n.IconContent,{name:"folder_dropdown-small",alt:_,className:"breadcrumb-menu-icon"}),f=g(p);return s.createElement(i.Popover,{onSelection:this.onCrumbSelected,onMenuToggle:this.onPopoverToggle,className:"breadcrumb-dropdown-container"},s.createElement(i.PopoverTrigger,{onDragOver:this.onDragEnter,onMouseEnter:this.onMouseEnter},s.createElement("span",{className:"u-unbutton breadcrumb-overflow-button u-l-fl"},m)),s.createElement(i.PopoverContent,{isRevealed:this.state.menuVisible,onDragEnter:this.onInnerDragEnter,onDragLeave:this.onDragLeave},t.map(function(t){return s.createElement(F,{key:encodeURI(t.path),path:t.path,icon:t.icon,alt:t.alt,folderName:t.folderName,currentPath:o,isHighlightedDropTarget:l,isDraggingInternalFiles:c,setFileUploaderPath:u,closeFunc:e.onClose,disableDragging:h})})),s.createElement(a.IconArrow,{name:f,className:"breadcrumb__spacer"}))},t.defaultProps={shouldHighlightDropTargets:!1,isDraggingInternalFiles:!1,disableDragging:!1},t})(s.Component)}),define("modules/clean/react/path_filter_button",["require","exports","tslib","external/react","spectrum/dropdown_button","modules/clean/react/title_bubble","modules/clean/em_string","modules/clean/filepath"],function(e,t,r,o,s,a,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),i=r.__importStar(i),t.PathFilterButton=function(e){
var t=e.path,r=e.defaultText,l=e.dropdownClasses,c=e.disabled,d=e.onClick,u=t&&!i.paths_are_equal(t,"/")?n.Emstring.em_snippet(i.filename(t),10,.6):null,p=o.createElement(s.DropdownButton,{className:l,disabled:c,onClick:d},u||r);return u?o.createElement(a.TitleBubble,{content:t,position:a.TitleBubble.POSITIONS.BOTTOM},p):p}}),define("modules/clean/search/api",["require","exports","tslib","modules/clean/ajax","modules/clean/analytics","modules/clean/react/browse/models","modules/clean/search/search_helpers","modules/clean/search/constants","modules/clean/search/types","modules/clean/search/models","modules/clean/search/api_helpers","modules/clean/search/search_helpers","modules/clean/search/search_bar/data/selectors","modules/clean/search/search_bar/data/store"],function(e,t,r,o,s,a,n,i,l,c,d,u,p,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),n=r.__importStar(n),i=r.__importStar(i);var _=(function(){function e(){this._activeRequest=null}return e.prototype.abortPreviousLoading=function(){null!=this._activeRequest&&this._activeRequest.abort()},e.prototype.loadResults=function(e){var t=e.user,r=e.path,o=e.query,s=e.start,a=e.maxResults,l=e.searchSessionId,c=e.nsid,u=e.fileNameOnly,p=e.loadDeleted,h=e.showPaperResults,_=e.isDropdown,m=e.isAdminConsole,f=e.showSymlinkIcon,S=e.webTimer,g=e.onSuccess,w=e.onError,E=e.overrideUrl,v=d.getCurrentTimezoneOffset(),F={query:o,search_token:n.getSearchCsrfToken(),fq_path:r,ns_id:c,filename_only:!!u,max_results:a,deleted:!!p,start:s,show_paper_results:!!h,is_dropdown:!!_,is_admin_console:!!m,show_unmounted_results:!0,timezone_offset:v,show_symlink_icon:f,include_browse_context:!0},y=E?E:i.FULLTEXT_SEARCH_ENDPOINT;this._fetchResults({requestData:F,user:t,searchSessionId:l,url:y,onSuccess:g,onError:w,webTimer:S})},e.prototype._extractSearchResultsList=function(e){for(var t=[],r=0,o=e;r<o.length;r++){var s=o[r];switch(s.search_result_type){case l.SearchResultTypes.FILE:t.push(a.File.fromServerObject(s));break;case l.SearchResultTypes.PAPER:t.push(a.Paper.fromServerObject(s));break;case l.SearchResultTypes.PAPER_FOLDER:t.push(a.PaperFolder.fromServerObject(s))}}return t},e.prototype._getSearchType=function(e){return e.is_dropdown?"dropdown":e.deleted?"full_page_deleted":"full_page"},e.prototype.loadPartialResults=function(e){var t=e.user,o=e.maxResults,s=e.start,a=e.path,l=e.query,c=e.fileCategories,d=e.searchSessionId,p=e.showSymlinkIcon,h=e.includeBrowseContext,_=e.webTimer,m=e.onSuccess,f=e.onError,S=c?u.fileCategoriesToString(c):"",g=r.__assign({query:l,search_token:n.getSearchCsrfToken(),fq_path:a,start:s,max_results:o,show_paper_results:!0,show_symlink_icon:p,include_browse_context:h,search_session_id:d},S&&{file_categories:S});this._fetchResults({requestData:g,user:t,searchSessionId:d,url:i.PARTIAL_SEARCH_FRONTEND_SERVICE_ENDPOINT,onSuccess:m,onError:f,webTimer:_})},e.prototype._fetchResults=function(e){var t=this,a=e.requestData,n=e.user,i=e.searchSessionId,l=e.url,d=e.onSuccess,_=e.onError,m=e.webTimer;null!=this._activeRequest&&this._activeRequest.abort();var f=u.fileCategoryStringToLogValue(a.file_categories),S=p.experiments(h.getStoreForSearchBar().getState()),g=r.__assign({path_scoped:"/"!==a.fq_path,search_type:this._getSearchType(a),query_string:a.query,start:a.start,search_session_id:i,timezone_offset:a.timezone_offset},u.isInFileTypeFilterExperiment(S)&&{file_type_filters:f});s.SearchClientActivityLogger.log("query_started",n.id,g);var w=(new Date).getTime();this._activeRequest=o.WebRequest({url:l,data:a,dataType:"json",subject_user:n,success:function(e,r,o){var l;a.include_browse_context&&(l=c.extractBrowseContext(e));var u=e.search_results,p=o.getResponseHeader("x-dropbox-request-id");u.forEach(function(e){return e.request_id=p});var h=t._extractSearchResultsList(u);d({context:l,searchResults:h,deleted:!!a.deleted});var _=s.SearchClientActivityLogger.create_search_log_dict(g,p,w,a.query,h.length,null,i,null);s.SearchClientActivityLogger.log("query_completed",n.id,_),m&&m.end(p?p:void 0)},error:function(e,t,r){"abort"!==t&&"function"==typeof _&&_(r);var o=e.getResponseHeader("x-dropbox-request-id"),l=s.SearchClientActivityLogger.create_search_log_dict(g,o,w,a.query,null,t,i,null);s.SearchClientActivityLogger.log("query_failed",n.id,l),m&&m.abort()},complete:function(){this._activeRequest=null}})},e.prototype.fetchAdditionalFileMetadata=function(e){var t=e.searchResults,r=e.user,s=e.onSuccess,n=e.onError,l=t.filter(function(e){return e instanceof a.File}),c=l.map(function(e){return[e.ns_id,e.sjid,e.fq_path.substr(0,e.fq_path.length-e.ns_path.length)]});c.length>0&&o.WebRequest({url:i.FILE_INFO_ENDPOINT,data:{nsid_sjid_fq_mount_point_tuples:JSON.stringify(c)},dataType:"json",subject_user:r,success:function(e,t,r){for(var o=e.file_results,a=[],n=0,i=o;n<i.length;n++){var l=i[n];a.push(l)}s(a)},error:function(e,t,r){"abort"!==t&&"function"==typeof n&&n(r)}})},e})();t.SearchApiClient=_,t.searchApiClient=new _}),define("modules/clean/search/search_results/actions",["require","exports","tslib","modules/clean/search/constants","modules/core/i18n","modules/clean/search/search_results/dispatcher","modules/clean/search/api","modules/clean/search/search_results/store","modules/clean/search/types","modules/clean/search/constants","modules/clean/search/store_helpers","modules/clean/search/search_helpers"],function(e,t,r,o,s,a,n,i,l,c,d,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),d=r.__importStar(d);var p=(function(){function e(e,t){void 0===e&&(e=n.searchApiClient),void 0===t&&(t=i.getSearchResultsStore()),this._searchApi=e,this._searchResultsStore=t}return e.prototype.runSearch=function(e){var t=this,r=e.user,s=e.path,n=e.query,i=e.searchSessionId,l=e.webTimer,u=e.logOnceFetchedDataRequiredForTTI,p=e.deletedFiles,h=e.showSymlinkIcon,_=e.expSinglePageSearch,m=e.fileCategories,f=e.deletedFileInCerebro,S=e.isPaperEnabled,g=void 0===S||S,w=d.generateRandomId();_||a.SearchResultsDispatcher.dispatch({type:o.CLEAR_SEARCH_ACTION}),a.SearchResultsDispatcher.dispatch({type:o.START_SEARCH_ACTION,data:{query:n,searchSessionId:i,queryId:w,fileCategories:m}});var E=c.MaxResults.MAX_SEARCH_RESULTS;p!==!0?this._searchApi.loadPartialResults({user:r,path:s,query:n,start:0,searchSessionId:i,showSymlinkIcon:h,includeBrowseContext:!0,webTimer:l,maxResults:E,fileCategories:m,onSuccess:function(e){var o=e.searchResults,a=e.context;u(),t._setSearchResults({searchResults:o,context:a,deletedFiles:!!p,queryId:w}),void 0===p&&t._loadDeletedResults({path:s,user:r,deletedFileInCerebro:f,isPaperEnabled:g}),t._searchApi.fetchAdditionalFileMetadata({searchResults:o,user:r,onSuccess:function(e){t._setFullSearchResults({searchResults:e,queryId:w})}})}}):this._searchApi.loadResults({user:r,path:s,query:n,start:0,maxResults:E,showPaperResults:!0,searchSessionId:i,showSymlinkIcon:h,webTimer:l,loadDeleted:p,overrideUrl:f?o.PARTIAL_SEARCH_FRONTEND_SERVICE_ENDPOINT:"",onSuccess:function(e){var o=e.searchResults,a=e.context;u(),t._setSearchResults({searchResults:o,context:a,deletedFiles:!!p,queryId:w}),void 0===p&&t._loadDeletedResults({path:s,user:r,deletedFileInCerebro:f,isPaperEnabled:g})}})},e.prototype.fetchCompleteSearchResultSRP=function(e){var t=this,r=e.searchResult,o=e.user,a=e.onSuccess,n=e.onError;if(r.isDeleted)return a(r);var l=i.getSearchResultsStore().fullSearchResults().get(r.fq_path,null);if(l){a(this._mergePartialAndCompleteResult({partialResult:r,completeResult:l}))}else this._searchApi.fetchAdditionalFileMetadata({searchResults:[r],user:o,onSuccess:function(e){if(e.length>0){a(t._mergePartialAndCompleteResult({partialResult:r,completeResult:e[0]}))}else if(n){var o=s._("There was a problem completing this request.");n(o)}},onError:n})},e.prototype._mergePartialAndCompleteResult=function(e){var t=e.partialResult,o=e.completeResult;return r.__assign({},t,o)},e.prototype.loadMoreResults=function(e){var t=this,s=e.path,n=e.user,i=e.deletedFiles,d=e.showSymlinkIcon,p=e.deletedFileInCerebro,h=e.isPaperEnabled,_=void 0===h||h,m=!1,f=this._searchResultsStore.latestFileCategories(),S=_?!(u.allCategoriesUnchecked(f)||u.allCategoriesChecked(f)):!(u.allCategoriesUnchecked(r.__assign({},f,(v={},v[l.FileCategory.PAPER]="unchecked",v)))||u.allCategoriesChecked(r.__assign({},f,(F={},F[l.FileCategory.PAPER]="checked",F))));if(this._searchResultsStore.loadingState()===o.SearchLoadingState.LOADED){if(void 0===i)if(this._searchResultsStore.hasMoreResults())m=!1;else{if(!this._searchResultsStore.hasMoreResults(!S))return;m=!0}else{if(!this._searchResultsStore.hasMoreResults(i&&!S))return;m=i&&!S}a.SearchResultsDispatcher.dispatch({type:o.CONTINUE_SEARCH_ACTION,data:{didLoadDeletedResults:m}});var g=m?this._searchResultsStore.numDeletedResults():this._searchResultsStore.searchResults().size,w=this._searchResultsStore.queryId();if(m)this._searchApi.loadResults({user:n,path:s,query:this._searchResultsStore.latestQuery(),fileNameOnly:!1,showPaperResults:!0,isDropdown:!1,isAdminConsole:!1,loadDeleted:m,start:g,maxResults:c.MaxResults.MAX_SEARCH_RESULTS,searchSessionId:this._searchResultsStore.searchSessionId(),showSymlinkIcon:d,overrideUrl:p?o.PARTIAL_SEARCH_FRONTEND_SERVICE_ENDPOINT:"",onSuccess:function(e){var r=e.searchResults,o=(e.context,e.deleted);t._appendSearchResults({searchResults:r,deleted:o}),void 0===i&&t._loadDeletedResults({path:s,user:n,deletedFileInCerebro:p,isPaperEnabled:_})}});else{var E=this._searchResultsStore.latestQuery();this._searchApi.loadPartialResults({user:n,path:s,query:E,start:g,showSymlinkIcon:d,includeBrowseContext:!1,searchSessionId:this._searchResultsStore.searchSessionId(),maxResults:c.MaxResults.MAX_SEARCH_RESULTS,fileCategories:f,onSuccess:function(e){var r=e.searchResults;e.context;t._appendSearchResults({searchResults:r,deleted:!1}),t._searchApi.fetchAdditionalFileMetadata({searchResults:r,user:n,onSuccess:function(e){t._setFullSearchResults({searchResults:e,queryId:w})}}),void 0===i&&t._loadDeletedResults({path:s,user:n,deletedFileInCerebro:p,isPaperEnabled:_})}})}var v,F}},e.prototype._setSearchResults=function(e){var t=e.searchResults,r=e.context,s=e.deletedFiles,n=e.queryId;a.SearchResultsDispatcher.dispatch({type:o.SET_SEARCH_RESULTS_ACTION,data:{searchResults:t,context:r,deletedFiles:s,queryId:n}})},e.prototype._setFullSearchResults=function(e){var t=e.searchResults,r=e.queryId;a.SearchResultsDispatcher.dispatch({type:o.SET_FULL_SEARCH_RESULTS_ACTION,data:{searchResults:t,queryId:r}})},e.prototype._appendSearchResults=function(e){var t=e.searchResults,r=e.deleted;a.SearchResultsDispatcher.dispatch({type:o.APPEND_SEARCH_RESULTS_ACTION,data:{searchResults:t,deleted:r}})},e.prototype._loadDeletedResults=function(e){var t=e.path,r=e.user,o=e.deletedFileInCerebro,s=e.isPaperEnabled;this._searchResultsStore.hasMoreResults()||this._searchResultsStore.didLoadDeletedResults()||this.loadMoreResults({path:t,user:r,deletedFileInCerebro:o,isPaperEnabled:s})},e.prototype.setSearchSelection=function(e){var t=e.selection;a.SearchResultsDispatcher.dispatch({type:o.SET_SEARCH_SELECTION_ACTION,data:{selection:t}})},e.prototype.clearSearch=function(){a.SearchResultsDispatcher.dispatch({type:o.CLEAR_SEARCH_ACTION})},e.prototype.setFileTypeFilter=function(e){var t=e.fileCategories;a.SearchResultsDispatcher.dispatch({type:o.SET_FILE_TYPE_FILTER_ACTION,data:{fileCategories:t}})},e.prototype.selectFirstFile=function(){a.SearchResultsDispatcher.dispatch({type:o.SELECT_FIRST_FILE_ACTION,data:{}})},e})();t.SearchResultsActions=p,t.searchResultsActions=new p}),define("modules/clean/search/search_results/controller",["require","exports","tslib","external/lodash","external/react","external/react-dom","modules/clean/filepath","modules/clean/react/browse/models","modules/clean/react/css","modules/clean/search/constants","modules/clean/search/search_results/actions","modules/clean/search/search_results/log_helper","modules/clean/search/search_results/store","modules/clean/search/search_results/view","modules/clean/web_user_action_events"],function(e,t,r,o,s,a,n,i,l,c,d,u,p,h,_){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),s=r.__importStar(s),a=r.__importStar(a),n=r.__importStar(n),c=r.__importStar(c);var m=(function(t){function l(){var e=null!==t&&t.apply(this,arguments)||this;return e._onSearchResultsStoreChanged=function(){e.setState(e._getStateFromSearchResultsStore()),e.deferredCheckForMissingStarredData&&e.deferredCheckForMissingStarredData()},e._handleScroll=function(){if(a.findDOMNode(e).getBoundingClientRect().bottom<=window.innerHeight){var t=e.props,r=t.path,o=t.user,s=t.shouldShowDeletedFiles,n=t.searchResultsExperiments,i=t.isPaperEnabled,l=n.expShowSymlinkIcon,c=n.expDeletedFileInCerebro;d.searchResultsActions.loadMoreResults({path:r,user:o,showSymlinkIcon:!!l,deletedFiles:s,deletedFileInCerebro:!!c,isPaperEnabled:i})}},e._handleSelectionChange=function(e){d.searchResultsActions.setSearchSelection({selection:e})},e._handleLocationLinkClick=function(t,r){var o=e.props,s=o.user,a=o.viewType;if(u.recordSearchResultsAction({result:t,user:s,action_type:_.WebUserActionLogEvent.CLICK_PATH_LINK,view_type:a}),!r){var i=n.parent_dir(t.fq_path);e.props.onNavigateToPath(i)}},e._handleFilesViewShowShare=function(t,r){var o=e.props,s=o.user,a=o.filesViewActionHandlers,n=o.viewType;u.recordSearchResultsAction({result:t,user:s,action_type:_.WebUserActionLogEvent.SHARE,view_type:n}),a.onShowShare(t,r)},e}return r.__extends(l,t),l.prototype.componentWillMount=function(){this.state=this._getStateFromSearchResultsStore()},l.prototype.componentWillReceiveProps=function(e){e.arePostTTIModulesLoaded&&!this.props.arePostTTIModulesLoaded&&this.enableStarring()},l.prototype.componentDidMount=function(){p.getSearchResultsStore().add_change_listener(this._onSearchResultsStoreChanged),this.props.arePostTTIModulesLoaded&&this.enableStarring(),this.setState(this._getStateFromSearchResultsStore()),window.scrollTo(0,0)},l.prototype.componentWillUnmount=function(){p.getSearchResultsStore().remove_change_listener(this._onSearchResultsStoreChanged)},l.prototype.enableStarring=function(){var t=this,r=e("modules/clean/react/starred/browse_exports").checkForMissingStarredData;this.deferredCheckForMissingStarredData=function(){o.defer(function(){var e=[];p.getSearchResultsStore().searchResults().forEach(function(t){t instanceof i.File&&e.push(t),(t instanceof i.Paper||t instanceof i.PaperFolder)&&e.push(t)}),r({items:e,user:t.props.user})})},this.deferredCheckForMissingStarredData()},l.prototype._getStateFromSearchResultsStore=function(){var e=p.getSearchResultsStore(),t=e.latestQuery(),r=e.loadingState(),o=this.state?this.state.loadingState!==r&&this.state.loadingState===c.SearchLoadingState.LOADING_FIRST_PAGE?t:this.state.queryForResultsTitle:"";return{context:e.browseContext(),hasMoreResults:e.hasMoreResults(),loadingState:r,latestQuery:t,queryForResultsTitle:o,searchSessionId:e.searchSessionId(),fullSearchResults:e.fullSearchResults(),searchResults:e.searchResults(),selection:e.selection(),selectedFiles:e.selectedFiles()}},l.prototype.render=function(){var e=this.props,t=e.actionHandlers,a=e.searchResultsExperiments,n=e.searchBarExperiments,i=e.maestroSearchBarProps,l=e.onFocusSearchBar,c=e.onSearch,d=e.onNavigateToFileOrFolder,u=e.setFileUploaderPath,p=e.path,_=e.user,m=e.handleComponentTTI,f=e.ensureFileViewerClosedIfNotPreviewing,S=e.getIsFileJumping,g=e.isFileViewerShown,w=e.fileRename,E=e.arePostTTIModulesLoaded,v=e.getOverflowMenuActions,F=e.filesViewActionHandlers,y=e.onNavigateToParentFolder,T=e.shouldShowDeletedFiles,b=e.browseExperiments,C=e.onOpenPaper,A=e.renderSharedWithController,R=e.hrefForFile,I=e.responsive,P=e.onSearchFiltersChanged,D=e.starredState,N=e.fileCategories,O=e.viewType,L=e.pageHeaderHeight,x=this.state,M=x.context,B=x.hasMoreResults,U=x.loadingState,k=x.latestQuery,q=x.queryForResultsTitle,V=x.searchSessionId,H=x.searchResults,W=x.selection,G=x.selectedFiles,j=r.__assign({},F,{onShowShare:this._handleFilesViewShowShare});return s.createElement(h.SearchResultsView,{filesViewActionHandlers:j,searchResultsExperiments:a,searchBarExperiments:n,browseExperiments:b,maestroSearchBarProps:i,onFocusSearchBar:l,onSearch:c,onScroll:o.throttle(this._handleScroll,200),setFileUploaderPath:u,onSelectionChange:this._handleSelectionChange,path:p,user:_,actionHandlers:t,handleComponentTTI:m,ensureFileViewerClosedIfNotPreviewing:f,getIsFileJumping:S,isFileViewerShown:g,fileRename:w,arePostTTIModulesLoaded:E,getOverflowMenuActions:v,onLocationLinkClick:this._handleLocationLinkClick,onNavigateToFileOrFolder:d,onNavigateToParentFolder:y,onOpenPaper:C,context:M,hasMoreResults:B,loadingState:U,latestQuery:k,queryForResultsTitle:q,searchSessionId:V,searchResults:H,selection:W,selectedFiles:G,viewType:O,shouldShowDeletedFiles:T,renderSharedWithController:A,hrefForFile:R,responsive:I,onSearchFiltersChanged:P,starredState:D,fileCategories:N,pageHeaderHeight:L})},l})(s.Component);t.SearchResultsController=l.requireCssWithComponent(m,["/static/css/browse/browse-vflSv_45j.css","/static/css/search/search_results-vflT65vb7.css","/static/css/scooter/scooter-scoped-vflrM1SRf.css"])}),define("modules/clean/search/search_results/dispatcher",["require","exports","tslib","modules/core/exception","modules/clean/flux/dispatcher","modules/clean/search/search_results/store"],function(e,t,r,o,s,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),t.SearchResultsDispatcher={dispatch:function(e){o.assert(a.searchResultsStoreInstantiated(),"Must call getSearchResultsStore() before a dispatch"),s.Dispatcher.dispatch(e)}}}),define("modules/clean/search/search_results/log_helper",["require","exports","tslib","modules/clean/search/logger","modules/clean/search/search_results/store","modules/clean/search/search_bar/data/store","modules/clean/search/search_bar/data/action_creators"],function(e,t,r,o,s,a,n){"use strict";function i(e){var t=e.result,r=e.user,i=e.action_type,l=e.view_type,c=s.getSearchResultsStore().searchSessionId(),d=s.getSearchResultsStore().latestQuery(),u={rawQuery:d,normalizedQuery:d};a.getStoreForSearchBar().dispatch(n.addQueryToHistory({user:r,query:u,searchSessionId:c,requestId:t.request_id||""})),o.logSearchAction({searchSessionId:c,result:t,user:r,action_type:i,search_type:"full_page",viewport:"full-view",view_type:l})}Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),t.recordSearchResultsAction=i}),define("modules/clean/search/search_results/search_filters",["require","exports","tslib","external/react","modules/core/i18n","spectrum/tertiary_link","spectrum/label","spectrum/radio_button","spectrum/checkbox","modules/clean/filepath","modules/clean/react/async_folder_selector_modal","modules/clean/react/path_filter_button","modules/clean/search/types","modules/clean/search/search_helpers","modules/clean/search/search_bar/experiments","spectrum/icon_arrow","modules/clean/search/constants","external/classnames","spectrum/icon_content","spectrum/tooltip","modules/clean/search/constants","spectrum/button"],function(e,t,r,o,s,a,n,i,l,c,d,u,p,h,_,m,f,S,g,w,E,v){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),c=r.__importStar(c),d=r.__importStar(d),S=r.__importDefault(S);var F=(function(e){function t(F){var y=e.call(this,F)||this;y.showFolderFilterModal=function(){var e=y.props,t=e.user,r=e.path,o=e.onFiltersChanged,a=e.deletedFiles,n=e.searchBarExperiments,i=void 0===n?{}:n;d.show({primaryAction:s._("Select"),secondaryAction:s._("Cancel"),title:s._("Select a folder"),ariaLabel:s._("Folder selector"),user:t,initialFolderSelection:r,forceRootSelectable:!0,onFolderSelected:function(e){o({path:e,deletedFiles:a})},showFolderPicker:!!i.expUseNewFolderPicker})},y.resetFilters=function(){var e=y.props,t=e.searchBarExperiments,o=e.onFiltersChanged,s={};_.isInDeletedFilterRightRailExperiment(t)&&(s.deletedFiles=!1),s.path="/",h.isInFileTypeFilterExperiment(t)&&(s.fileCategories=h.isInFileTypeFilterExperimentAllChecked(t)?r.__assign({},E.FILE_CATEGORIES_CHECKED):r.__assign({},E.FILE_CATEGORIES_UNCHECKED)),o(s)},y.shouldRenderResetButton=function(){var e=y.props,t=e.path,r=e.deletedFiles,o=e.fileCategories,s=e.searchBarExperiments,a=h.fileCategoriesSet(o,s,y.props.isPaperEnabled);return!c.paths_are_equal(t,"/")||!!r||a},y.renderResetButton=function(){return o.createElement(a.TertiaryLink,{onClick:y.resetFilters,className:"search-filters__reset"},s._("Reset filters"))},y.renderPathFilter=function(){var e=y.props.path;return o.createElement("div",{className:"filter-item__row"},o.createElement("div",{className:"filter-item__column"},o.createElement("div",{className:"filter-item__desc"},s._("By folder")),o.createElement(u.PathFilterButton,{path:e,defaultText:s._("Any folder"),dropdownClasses:"filter-item__filter",onClick:y.showFolderFilterModal})))},y.handleDeletedFilesAll=function(){y.props.onFiltersChanged({deletedFiles:!1})},y.handleDeletedFilesDeleted=function(){y.props.onFiltersChanged({deletedFiles:!0})},y.handleFileTypeChanged=function(e,t,o){var s=o.target.name;y.props.onFiltersChanged({fileCategories:r.__assign({},y.props.fileCategories,(a={},a[s]=e,a))});var a},y.handleChangeFileTypeFiltersView=function(){y.setState({showAllFilters:!y.state.showAllFilters})},y.handleClearOrSelectAll=function(){h.allCategoriesChecked(y.props.fileCategories,y.props.isPaperEnabled)?y.props.onFiltersChanged({fileCategories:r.__assign({},E.FILE_CATEGORIES_UNCHECKED)}):(y.props.onFiltersChanged({fileCategories:r.__assign({},E.FILE_CATEGORIES_CHECKED)}),y.setState({showAllFilters:!0}))},y.handleOnlyButtonClicked=function(e){return function(){y.props.onFiltersChanged({fileCategories:r.__assign({},E.FILE_CATEGORIES_UNCHECKED,(t={},t[e]="checked",t))});var t}},y.renderDeletedFilter=function(){var e=y.props.deletedFiles;return o.createElement("div",{className:"filter-item__row"},o.createElement("div",{className:"filter-item__column"},o.createElement("div",{className:"filter-item__desc"},s._("By status")),o.createElement("div",null,o.createElement(n.Label,{htmlFor:"filter-type-all"},o.createElement(i.RadioButton,{"aria-checked":!0,checked:!e,id:"filter-type-all",value:"all",onChange:y.handleDeletedFilesAll}),s._("Available"))),o.createElement("div",null,o.createElement(n.Label,{htmlFor:"filter-type-deleted"},o.createElement(i.RadioButton,{"aria-checked":!0,checked:e,id:"filter-type-deleted",value:"deleted",onChange:y.handleDeletedFilesDeleted}),s._("Deleted")))))},y.renderFileTypeFilter=function(){var e=y.renderFileTypeFilterCheckboxes(),t=y.state.showAllFilters?"up":"down",r=y.state.showAllFilters?s._("Show Less"):s._("Show More"),n=h.allCategoriesChecked(y.props.fileCategories,y.props.isPaperEnabled),i=n?s._("Clear all"):s._("Select all");return o.createElement("div",{className:"filter-item__row"},o.createElement("div",{className:"filter-item__column"},o.createElement("div",{className:"filter-item__desc"},s._("By type"),o.createElement(a.TertiaryLink,{onClick:y.handleClearOrSelectAll,className:"filter-type-file-select-or-clear-all-button"},i)),e,o.createElement("button",{className:"show-more-filters",onClick:y.handleChangeFileTypeFiltersView},o.createElement("div",{className:"show-more-filters__arrow show-more-filters__arrow-"+t},o.createElement(m.IconArrow,{name:"right"})),r)))},y.renderFileTypeFilterCheckboxes=function(){var e=[],r=0;return Object.keys(t.FileCategoryData).forEach(function(t){(y.props.isPaperEnabled||t!==p.FileCategory.PAPER)&&(e.push(y.createCheckBox(t,r>=f.NUMBER_FILE_TYPE_CHECKBOXES_ALWAYS_SHOWN)),r++)}),e},y.createCheckBox=function(e,r){var a=y.props.searchBarExperiments,i=h.isInFileTypeFilterExperimentAllChecked(a),c=t.FileCategoryData[e].label,d=t.FileCategoryData[e].icon,u=t.FileCategoryData[e].tooltip,p="filter-type-file-"+e,_="filter-type-file-only-"+e,m="filter-type-file-label filter-type-file-label__"+(i?"partial-width":"full-width"),f=y.state.showAllFilters?"":S.default({"filter-type-file-checkbox__hidden":r}),E=o.createElement("div",{className:"filter-type-file-icon-wrapper"},o.createElement(w.Tooltip,{tooltipContent:u,positioning:"left"},o.createElement(g.IconContent,{className:"filter-type-file-icon",name:d}))),F=i?o.createElement(n.Label,{htmlFor:_,className:"filter-type-file-only-button-label"},o.createElement(v.Button,{className:"filter-type-file-only-button",onClick:y.handleOnlyButtonClicked(e),variant:"styleless"},s._("Only",{comment:"This string is used on the file type filters as a button that selects only that filter from the list of them. It is displayed when a user hovers over a checkbox in the filters."})),E):E;return o.createElement("div",{key:p,className:"filter-type-file-checkbox-wrapper "+f},o.createElement(n.Label,{htmlFor:p,className:m},o.createElement(l.Checkbox,{name:e,"aria-checked":!0,checked:y.props.fileCategories[e],id:p,onChange:y.handleFileTypeChanged,className:"filter-type-file-checkbox"}),c,i?null:F),i?F:null)},y.handleClick=function(e){e.stopPropagation()};var T=y.props.searchBarExperiments,b=h.fileCategoriesToString(y.props.fileCategories);return!h.isInFileTypeFilterExperimentAllChecked(T)&&_.isInDeletedFilterRightRailExperiment(T)?y.state={showAllFilters:!!b}:y.state={showAllFilters:!0},y.props.fileTypeFilterEnabled&&h.isInFileTypeFilterExperiment(T)&&void 0===t.FileCategoryData&&(t.FileCategoryData=(C={},C[p.FileCategory.IMAGE]={label:s._("Images"),tooltip:s._("JPG, PNG, GIF, and more",{comment:"Intended to represent 3 of the most common file formats for images."}),icon:"image-small"},C[p.FileCategory.DOCUMENT]={label:s._("Documents"),tooltip:s._("DOC, DOCX, TXT, and more",{comment:"Intended to represent 3 of the most common file formats for documents."}),icon:"docx-small"},C[p.FileCategory.PDF]={label:s._("PDFs"),tooltip:s._("PDF"),icon:"pdf-small"},C[p.FileCategory.SPREADSHEET]={label:s._("Spreadsheets"),tooltip:s._("XLSX, XLS, CSV, and more",{comment:"Intended to represent 3 of the most common file formats for spreadsheets."}),icon:"xls-small"},C[p.FileCategory.PRESENTATION]={label:s._("Presentations"),tooltip:s._("PPT, PPTX, KEY, and more",{comment:"Intended to represent 3 of the most common file formats for presentations."}),icon:"ppt-small"},C[p.FileCategory.AUDIO]={label:s._("Audio"),tooltip:s._("MP3, WAV, MID, and more",{comment:"Intended to represent 3 of the most common file formats for audio."}),icon:"audio-small"},C[p.FileCategory.VIDEO]={label:s._("Video"),tooltip:s._("MOV, WMV, MP4, and more",{comment:"Intended to represent 3 of the most common file formats for videos."}),icon:"video-small"},C[p.FileCategory.FOLDER]={label:s._("Folders"),tooltip:s._("Dropbox folders"),icon:"folder-small"},C[p.FileCategory.PAPER]={label:s._("Paper docs"),tooltip:s._("Dropbox Paper docs"),icon:"paper-small"},C[p.FileCategory.OTHER]={label:s._("Other"),tooltip:s._("Other filetypes"),icon:"unknown-small"},C)),y;var C}return r.__extends(t,e),t.prototype.componentDidMount=function(){var e=this.props,t=e.searchBarExperiments,o=e.fileCategories;e.fileTypeFilterEnabled?h.isInFileTypeFilterExperimentAllChecked(t)&&h.allCategoriesUnchecked(o)&&this.props.onFiltersChanged({fileCategories:r.__assign({},E.FILE_CATEGORIES_CHECKED)}):h.allCategoriesUnchecked(o)||this.props.onFiltersChanged({fileCategories:r.__assign({},E.FILE_CATEGORIES_UNCHECKED)})},t.prototype.render=function(){var e=this.props.searchBarExperiments;return o.createElement("div",{onClick:this.handleClick},o.createElement("div",{className:"filter-header"},o.createElement("h3",null,s._("Filter")),this.shouldRenderResetButton()&&this.renderResetButton()),o.createElement("div",{className:"filter-item"},this.renderPathFilter()),o.createElement("div",{className:"filter-item"},this.props.fileTypeFilterEnabled&&h.isInFileTypeFilterExperiment(e)&&this.renderFileTypeFilter()),o.createElement("div",{className:"filter-item"},_.isInDeletedFilterRightRailExperiment(e)&&this.renderDeletedFilter()))},t})(o.Component);t.SearchFilters=F}),define("modules/clean/search/search_results/sidebar_view",["require","exports","tslib","external/react","modules/core/exception","modules/clean/react/browse/util","modules/core/i18n","modules/clean/search/search_results/search_filters","modules/clean/react/app_actions_view"],function(e,t,r,o,s,a,n,i,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o);var c=(function(t){function c(){return null!==t&&t.apply(this,arguments)||this}return r.__extends(c,t),c.prototype.render=function(){var t=this.props,r=t.context,c=t.selectedFiles,d=t.arePostTTIModulesLoaded,u=t.user,p=t.path,h=t.actionHandlers,_=t.searchBarExperiments,m=t.shouldShowDeletedFiles,f=t.viewType,S=t.responsive,g=t.onSearchFiltersChanged,w=t.fileCategories,E=t.isNautilusEnabled,v=t.isPaperEnabled;if(c.size){var F=[];if(d){F=e("modules/clean/react/browse/file_actions").getActionsForFileCollection({files:c,context:r,user:u,viewType:f,actionHandlers:h,isSearchMode:!0,responsive:S,showNewMoveDialog:!0})}if(F.length){s.assert("function"!=typeof F[0],"The primary menu item for AppActionsView must be a BrowseAppActionLink");var y=F[0],T={displayName:y.label,handleClick:y.performAction,iconName:y.iconName,className:y.className,disabled:y.disabled},b=F.slice(1).map(function(e){return"function"==typeof e?e:{displayName:e.label,handleClick:e.performAction,iconName:e.iconName,className:e.className,disabled:e.disabled}}),C=a.getSelectedFilesText(c,r);return o.createElement(l.AppActionsView,{headerText:C,popoverTriggerLabel:n._("Actions"),primaryMenuItem:T,secondaryMenuItems:b,responsive:S})}}return o.createElement(i.SearchFilters,{user:u,searchBarExperiments:_,path:p,onFiltersChanged:g,deletedFiles:m,fileCategories:w,fileTypeFilterEnabled:E,isPaperEnabled:v})},c})(o.PureComponent);t.SearchResultsSidebarView=c}),define("modules/clean/search/search_results/store",["require","exports","tslib","external/immutable","modules/clean/filepath","modules/clean/flux/base_store","modules/clean/react/selection","modules/clean/search/constants","modules/clean/react/browse/constants","modules/clean/react/browse/models","modules/clean/search/store_helpers"],function(e,t,r,o,s,a,n,i,l,c,d){"use strict";function u(){return null===_&&(_=new h),_}function p(){return null!==_}Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),s=r.__importStar(s),i=r.__importStar(i),d=r.__importStar(d);var h=(function(e){function t(t){var r=e.call(this,t)||this;return r._resetSearchResults(),r}return r.__extends(t,e),t.prototype._resetSearchResults=function(){this._browseContext=void 0,this._rawQuery="",this._latestQuery="",this._loadingState=i.SearchLoadingState.LOADED,this._fullSearchResults=o.OrderedMap(),this._searchResults=o.List(),this._selection=void 0,this._hasMoreLiveResults=!0,this._numDeletedResults=0,this._hasMoreDeletedResults=!0,this._didLoadDeletedResults=!1,this._latestFileCategories=i.FILE_CATEGORIES_UNCHECKED},t.prototype.rawQuery=function(){return this._rawQuery},t.prototype.searchSessionId=function(){return this._searchSessionId},t.prototype.queryId=function(){return this._queryId},t.prototype.browseContext=function(){return this._browseContext||(this._browseContext=new c.BrowseContext)},t.prototype.latestQuery=function(){return this._latestQuery},t.prototype.loadingState=function(){return this._loadingState},t.prototype.searchResults=function(){return this._searchResults},t.prototype.fullSearchResults=function(){return this._fullSearchResults},t.prototype.hasMoreResults=function(e){return void 0===e&&(e=!1),this._hasMoreLiveResults||e&&this._hasMoreDeletedResults},t.prototype.numDeletedResults=function(){return this._numDeletedResults},t.prototype.didLoadDeletedResults=function(){return this._didLoadDeletedResults},t.prototype.selection=function(){return this._selection||(this._selection=n.createSelection())},t.prototype.selectedFiles=function(){var e=this,t=this._searchResults.filter(function(t){return t instanceof c.File&&e.selection().selected.has(t.fq_path)})
;return o.OrderedMap(t.map(function(e){return[e.fq_path,e]}))},t.prototype.latestFileCategories=function(){return this._latestFileCategories},t.prototype._setRawQuery=function(e,t){t?this._searchSessionId=t:d.shouldStartNewSearchSession(this._rawQuery,e)&&(this._searchSessionId=d.generateRandomId()),this._rawQuery=e},t.prototype._setSearchQuery=function(e){var t=e.query;this._setRawQuery(t),this.emit_change()},t.prototype._startSearch=function(e){var t=e.query,r=e.searchSessionId,o=e.queryId,s=e.fileCategories;this._setRawQuery(t,r),this._latestQuery=d.normalize(t),this._loadingState=i.SearchLoadingState.LOADING_FIRST_PAGE,this._hasMoreLiveResults=!0,this._numDeletedResults=0,this._hasMoreDeletedResults=!0,this._didLoadDeletedResults=!1,this._queryId=o,this._latestFileCategories=s?s:i.FILE_CATEGORIES_UNCHECKED,this.emit_change()},t.prototype._setSearchResults=function(e){var t=e.searchResults,r=e.context,o=e.deletedFiles;e.queryId===this.queryId()&&(this._setSearchResultsInternal(t,o),this._loadingState=i.SearchLoadingState.LOADED,r&&(this._browseContext=r),this._updateMoreResults(t),this.emit_change())},t.prototype._setFullSearchResults=function(e){var t=e.searchResults;if(e.queryId===this._queryId){for(var r=0,o=t;r<o.length;r++){var s=o[r];this._fullSearchResults=this._fullSearchResults.set(s.fq_path,s)}this._loadingState=i.SearchLoadingState.LOADED,this.emit_change()}},t.prototype._setSearchResultsInternal=function(e,t){this._searchResults=o.List(e),t&&(this._numDeletedResults=e.length)},t.prototype._continueSearch=function(e){e.didLoadDeletedResults&&(this._didLoadDeletedResults=!0),this._loadingState=i.SearchLoadingState.LOADING_ADDITIONAL_PAGE,this.emit_change()},t.prototype._appendSearchResults=function(e){var t=e.deleted,r=e.searchResults;t&&(this._numDeletedResults+=r.length),this._searchResults=this._searchResults.concat(r),this._loadingState=i.SearchLoadingState.LOADED,this._updateMoreResults(r),this.emit_change()},t.prototype._clearSearch=function(){this._resetSearchResults(),this.emit_change()},t.prototype._updateMoreResults=function(e){var t=e.length===i.MaxResults.MAX_SEARCH_RESULTS;this._hasMoreLiveResults?this._hasMoreLiveResults=t:this._hasMoreDeletedResults&&(this._hasMoreDeletedResults=t)},t.prototype._setSearchSelection=function(e){var t=e.selection;this._selection=t,this.emit_change()},t.prototype._selectFirstFile=function(){var e=this._searchResults.find(function(e){return e instanceof c.File});e&&this._setSearchSelection({selection:n.createSelection([e.fq_path])})},t.prototype._applyFileDeltas=function(e){var t=e.fileDeltas;if(t){for(var r=function(e,t){var r=void 0;!e&&t?o._searchResults=o._searchResults.push(t):e&&!t?(r=o._searchResults.findIndex(function(t){return t instanceof c.File&&s.paths_are_equal(t.fq_path,e)}),o._searchResults=o._searchResults.delete(r)):e&&t&&(r=o._searchResults.findIndex(function(t){return t instanceof c.File&&s.paths_are_equal(t.fq_path,e)}),o._searchResults=r>-1?o._searchResults.set(r,t):o._searchResults.push(t))},o=this,a=0,n=t;a<n.length;a++){var i=n[a];r(i.before,i.after)}this.emit_change()}},t.prototype._updateContext=function(e){this._browseContext=e.context},t.prototype._new_payload=function(e){switch(e.action.type){case i.START_SEARCH_ACTION:this._startSearch(e.action.data);break;case i.SET_SEARCH_RESULTS_ACTION:this._setSearchResults(e.action.data);break;case i.CONTINUE_SEARCH_ACTION:this._continueSearch(e.action.data);break;case i.APPEND_SEARCH_RESULTS_ACTION:this._appendSearchResults(e.action.data);break;case i.SET_FULL_SEARCH_RESULTS_ACTION:this._setFullSearchResults(e.action.data);break;case i.SET_SEARCH_SELECTION_ACTION:this._setSearchSelection(e.action.data);break;case i.CHANGE_FILES_ACTION:this._applyFileDeltas(e.action.data);break;case i.CLEAR_SEARCH_ACTION:this._clearSearch();break;case l.BrowseActionType.LOAD_PATH:this._updateContext(e.action.data);break;case i.SELECT_FIRST_FILE_ACTION:this._selectFirstFile()}},t})(a.Store);t.SearchResultsStore=h;var _=null;t.getSearchResultsStore=u,t.searchResultsStoreInstantiated=p}),define("modules/clean/search/search_results/view",["require","exports","tslib","external/lodash","external/react","spectrum/table","spectrum/tip_card","modules/clean/em_string","modules/clean/filepath","modules/clean/history","modules/clean/illustration_helper","modules/clean/react_format","modules/clean/react/files_view/constants","modules/clean/react/files_view/controller","modules/clean/react/files_view/file_list_empty_folder_table","modules/clean/react/files_view/fixed_table_head","modules/clean/react/files_view/types","modules/clean/react/image","modules/clean/search/constants","modules/clean/search/search_bar/experiments","modules/clean/search/search_helpers","modules/core/i18n","modules/core/uri"],function(e,t,r,o,s,a,n,i,l,c,d,u,p,h,_,m,f,S,g,w,E,v,F){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),s=r.__importStar(s),l=r.__importStar(l),c=r.__importDefault(c),g=r.__importStar(g),E=r.__importStar(E);var y=(function(e){function t(t){var o=e.call(this,t)||this;return o._handleScroll=function(){o.props.onScroll()},o._ensureFileViewerClosedIfNotPreviewing=function(){var e=c.default.deconstruct_url().qargs;o.props.ensureFileViewerClosedIfNotPreviewing(e)},o._handleFullSearchOnClick=function(e){e.preventDefault(),o.props.onSearch(o.props.latestQuery,"/")},o._handleEmptyFolderViewTTI=function(){o.props.handleComponentTTI("FilesViewController")},o._handleSearchAllFiles=function(e){e.preventDefault();var t=o.props.path;o.props.onSearchFiltersChanged({path:t,deletedFiles:!1})},o._handleSearchDeletedFiles=function(e){e.preventDefault();var t=o.props.path;o.props.onSearchFiltersChanged({path:t,deletedFiles:!0})},o._handleRemoveAllFilters=function(e){e.preventDefault();var t=o.props,s=t.shouldShowDeletedFiles,a=t.searchBarExperiments;o.props.onSearchFiltersChanged({path:"/",deletedFiles:s,fileCategories:E.isInFileTypeFilterExperimentAllChecked(a)?r.__assign({},g.FILE_CATEGORIES_CHECKED):r.__assign({},g.FILE_CATEGORIES_UNCHECKED)})},o._getEmptyFolderViewUrl=function(e,t){var r=o.props,s=r.user,a=r.latestQuery,n=r.searchSessionId;return E.buildSearchURL({user:s,searchPath:e,normalizedQuery:a,searchSessionId:n,searchToken:E.getSearchCsrfToken(),qargs:{d:t?"1":void 0}}).toString()},o._getRemoveAllFiltersViewUrl=function(e){var t=o.props,r=t.user,s=t.latestQuery,a=t.searchSessionId,n=t.searchBarExperiments;return E.buildSearchURL({user:r,searchPath:"/",normalizedQuery:s,searchSessionId:a,searchToken:E.getSearchCsrfToken(),qargs:{d:e?"1":void 0,file_categories:E.isInFileTypeFilterExperimentAllChecked(n)?E.fileCategoriesToString(g.FILE_CATEGORIES_CHECKED):void 0}}).toString()},o._renderEmptyFolderSubtitle=function(){var e=o.props,t=e.path,r=e.shouldShowDeletedFiles,a=e.searchBarExperiments,n=e.fileCategories;return l.paths_are_equal(t,"/")&&!E.fileCategoriesSet(n,a)?r?u.reactFormat(v._("Try different keywords or <Link>search files that aren’t deleted</Link>"),{Link:s.createElement("a",{href:o._getEmptyFolderViewUrl(t,!1),onClick:o._handleSearchAllFiles})}):w.isInDeletedFilterRightRailExperiment(a)?u.reactFormat(v._("Try different keywords or <Link>search deleted files</Link>"),{Link:s.createElement("a",{href:o._getEmptyFolderViewUrl(t,!0),onClick:o._handleSearchDeletedFiles})}):v._("Try different keywords"):r?u.reactFormat(v._("<LinkScope>Search all folders</LinkScope> or <LinkDeleted>files that aren’t deleted</LinkDeleted>"),{LinkScope:s.createElement("a",{href:o._getEmptyFolderViewUrl("/",r),onClick:o._handleRemoveAllFilters}),LinkDeleted:s.createElement("a",{href:o._getEmptyFolderViewUrl(t,!1),onClick:o._handleSearchAllFiles})}):w.isInDeletedFilterRightRailExperiment(a)?u.reactFormat(v._("<LinkScope>Search all folders</LinkScope> or <LinkDeleted>deleted files</LinkDeleted>"),{LinkScope:s.createElement("a",{href:o._getEmptyFolderViewUrl("/",r),onClick:o._handleRemoveAllFilters}),LinkDeleted:s.createElement("a",{href:o._getEmptyFolderViewUrl(t,!0),onClick:o._handleSearchDeletedFiles})}):u.reactFormat(v._("Try <LinkScope>resetting all filters</LinkScope>"),{LinkScope:s.createElement("a",{href:o._getRemoveAllFiltersViewUrl(),onClick:o._handleRemoveAllFilters})})},o._renderEmptyFolderView=function(e){var t=o.props.path,r=l.paths_are_equal(t,"/"),n=v._("No results found");if(o.shouldRenderNewEmptyState())return s.createElement("div",null,s.createElement(a.Table,{columnFlex:[p.CHECKBOX_CELL_FLEX,1]},s.createElement(m.FixedTableHead,{offsetHeight:p.DEFAULT_COLUMN_HEADER_HEIGHT},s.createElement(a.TableHeadCell,{className:"brws-column-header-table-cell brws-checkbox-cell",key:"checkbox-cell",role:"columnheader",scope:"col"},s.createElement("div",{className:"brws-vertically-center"})),s.createElement(a.TableHeadCell,{role:"columnheader",scope:"col",className:"brws-column-header-table-cell"},s.createElement("div",{className:"normal brws-column-header-menu"},s.createElement("span",{className:"brws-column-header-menu-trigger-disabled"},o._searchResultsTitle(e))))),s.createElement("tbody",null,s.createElement("tr",null,s.createElement("td",null),s.createElement("td",null)))),s.createElement("div",{className:"u-font-center u-pad-top-xl"},s.createElement(S.Image,{src:d.empty_state_url("search"),srcHiRes:d.empty_state_url("search@2x"),alt:""}),s.createElement("h2",{className:"u-font-strong empty-folder-table-title"},n),s.createElement("span",null,o._renderEmptyFolderSubtitle())));var i=r?v._("Please update your search and try again"):v._("Search all of my Dropbox instead"),c=r?void 0:o._getFullSearchLink(),u=r?void 0:o._handleFullSearchOnClick;return s.createElement(_.EmptyFolderTable,{title:n,subtitle:i,subtitleLink:c,subtitleOnClick:u,onTTI:o._handleEmptyFolderViewTTI})},o._renderDeletedFilesTipcard=function(){return w.isInDeletedFilterRightRailExperiment(o.props.searchBarExperiments)&&o.props.shouldShowDeletedFiles&&o.props.loadingState===g.SearchLoadingState.LOADED&&o.props.searchResults.count()>0?s.createElement(n.TipCard,{className:"mc-tip-card--deleted-files"},u.reactFormat(v._("Can’t find what you’re looking for? <a>View all deleted files</a>"),{a:s.createElement("a",{href:"/deleted_files"})})):null},o.state={},o}return r.__extends(t,e),t.prototype.componentWillMount=function(){c.default.add_callback("/search",this._ensureFileViewerClosedIfNotPreviewing)},t.prototype.componentDidMount=function(){window.addEventListener("scroll",this._handleScroll)},t.prototype.componentWillUnmount=function(){window.removeEventListener("scroll",this._handleScroll),c.default.remove_callback("/search",this._ensureFileViewerClosedIfNotPreviewing)},t.prototype._getFullSearchLink=function(){var e=this.props,t=e.latestQuery,r=e.searchSessionId,o=e.user;return F.URI.parse("/search/"+o.role).setQuery({path:"/",query:t,searchSessionId:r}).toString()},t.prototype.shouldRenderNewEmptyState=function(){var e=this.props.searchBarExperiments;return E.isInFileTypeFilterExperiment(e)||w.isInDeletedFilterRightRailExperiment(e)||w.isInSinglePageSearchExperiment(e)},t.prototype._searchResultsTitle=function(e){var t=w.isInSinglePageSearchExperiment(this.props.searchBarExperiments)&&this.props.loadingState===g.SearchLoadingState.LOADING_FIRST_PAGE?this.props.queryForResultsTitle:this.props.latestQuery,r=this.props,o=r.searchResults,a=r.path,n=r.viewType,c=r.shouldShowDeletedFiles,d=o.size,p=l.paths_are_equal(a,"/");if(!this.shouldRenderNewEmptyState()&&0===d)return"";var h,_=e.isMatchedMedium?e.isMatchedLarge?30:20:10;n===f.ViewType.List&&(_/=2);if(p){var m=i.Emstring.em_snippet(t,_,.6);h=c?v.ungettext("%(size)d deleted result for “%(query)s”","%(size)d deleted results for “%(query)s”",d).format({size:d,query:m}):v.ungettext("%(size)d result for “%(query)s”","%(size)d results for “%(query)s”",d).format({size:d,query:m})}else{var S=i.Emstring.em_snippet(l.filename(a),_/2,.6),m=i.Emstring.em_snippet(t,_/2,.6);h=c?u.reactFormat(v.ungettext("%(size)d deleted result for “%(query)s” in <strong>%(path)s</strong>","%(size)d deleted results for “%(query)s” in <strong>%(path)s</strong>",d).format({size:d,query:m,path:S}),{strong:s.createElement("strong",null)}):u.reactFormat(v.ungettext("%(size)d result for “%(query)s” in <strong>%(path)s</strong>","%(size)d results for “%(query)s” in <strong>%(path)s</strong>",d).format({size:d,query:m,path:S}),{strong:s.createElement("strong",null)})}return h},t.prototype._getLoadingState=function(){var e=this.props,t=e.searchResults,r=e.searchBarExperiments,o=e.loadingState;return w.isInSinglePageSearchExperiment(r)&&!t.isEmpty()?f.LoadingState.LOADED:o===g.SearchLoadingState.LOADING_FIRST_PAGE?f.LoadingState.LOADING_FIRST_PAGE:o===g.SearchLoadingState.LOADING_ADDITIONAL_PAGE?f.LoadingState.LOADING_REMAINING_PAGES:f.LoadingState.LOADED},t.prototype._renderSearchResultItems=function(e){var t=this.props,a=t.getOverflowMenuActions,n=t.onFocusSearchBar,i=t.onLocationLinkClick,l=t.onNavigateToFileOrFolder,c=t.onNavigateToParentFolder,d=t.onOpenPaper,u=t.context,_=t.fileRename,m=t.searchResults,S=t.getIsFileJumping,g=t.isFileViewerShown,w=t.arePostTTIModulesLoaded,E=t.handleComponentTTI,v=t.onSelectionChange,F=t.selectedFiles,y=t.selection,T=t.setFileUploaderPath,b=t.viewType,C=t.user,A=t.path,R=t.filesViewActionHandlers,I=t.renderSharedWithController,P=t.hrefForFile,D=t.starredState,N=t.pageHeaderHeight;return s.createElement(h.FilesViewController,r.__assign({},R,{getOverflowMenuActions:a,onLocationLinkClick:i,onNavigateToFileOrFolder:l,onNavigateToParentFolder:c,onOpenPaper:d,context:u,customEmptyFolderView:this._renderEmptyFolderView,createNewFolderState:f.NewFolderCreationState.CREATE_FOLDER_INACTIVE,fileRename:_,items:m,getIsFileJumping:S,isFileViewerShown:g,isSearchMode:!0,arePostTTIModulesLoaded:w,isTextSelectable:!1,loadingState:this._getLoadingState(),onComponentTTI:E,onSelectionChange:v,onSortChange:o.noop,onFocusSearchBar:n,path:A,selectedFiles:F,selection:y,setFileUploaderPath:T,showFileUploaderModal:o.noop,user:C,viewType:b,totalNumFiles:m.size,responsive:e,columns:this._generateColumns(e),renderSharedWithController:I,hrefForFile:P,viewTypes:p.AllViewTypes,viewTypeLabels:p.ViewTypeLabels,starredState:D,pageHeaderHeight:N}))},t.prototype._generateColumns=function(e){var t=this;return(this.props.shouldShowDeletedFiles?p.SEARCH_LIST_VIEW_COLUMNS_DELETED:p.SEARCH_LIST_VIEW_COLUMNS).map(function(o,s){return r.__assign({},o,{label:0===s?t._searchResultsTitle(e):o.label})})},t.prototype.render=function(){var e=this.props.responsive;return s.createElement("div",{className:"search-results"},this._renderSearchResultItems(e),this._renderDeletedFilesTipcard())},t})(s.Component);t.SearchResultsView=y}),define("modules/clean/sharing/member_avatars",["require","exports","tslib","external/react","modules/clean/avatar/avatar_with_default","modules/clean/avatar/initials_avatar","modules/clean/avatar/photo_avatar","modules/clean/avatar/shared_link_avatar","modules/clean/avatar/viewer_avatar","modules/clean/avatar/list","modules/clean/components/title_bubble","modules/clean/datetime","modules/clean/em_string","modules/clean/react/tooltip","modules/clean/sharing/constants","modules/clean/sharing/link_description","modules/clean/static_urls","modules/clean/viewer","modules/core/i18n"],function(e,t,r,o,s,a,n,i,l,c,d,u,p,h,_,m,f,S,g){"use strict";function w(e){var t=e.overflowCount,r=e.avatarArgs,s=void 0===r?{}:r,n=g.ungettext("%(count)s more member","%(count)s more members",t).format({count:t}),i=t>=99?"99+":""+t,l=F(s),c=l.avatarDimension,u=l.onAvatarClick,p=l.titleButtonDirection;return o.createElement(d,{key:"overflow_count",text:n,direction:p},o.createElement(a.InitialsAvatar,{alt:n,dimension:c,initials:i,color:"#7B8994",shape:"CIRCLE",onClick:u}))}function E(e){if(!e)return!1;var t=S.Viewer.get_viewer();if(t.is_paired){var r=t.get_user_ids(!0),o=e.map(function(e){return e.user_id});if(o.includes(r[0])&&o.includes(r[1]))return!0}return!1}function v(e,t,r){return function(o){e&&e(t,r),o.stopPropagation()}}function F(e){return r.__assign({},O,e)}function y(e){var t,n=e.arePairedUsersInSF,i=e.member,c=e.avatarArgs,u=void 0===c?{}:c,h=i.user_id,m=S.Viewer.get_viewer(),f=m.get_user_ids(!0).includes(h),g="";if(f&&n){var w=i.user_id,E=m.get_user_by_role("personal",!0),y=m.get_user_by_role("work",!0);E&&w===E.id?g="Personal":y&&w===y.id&&null!=m.team_name&&(g=m.team_name)}else g=i.display_name;g=p.Emstring.em_snippet(g,_.SNIPPET_SIZES.DISPLAY_NAME);var T=P(g,i.access_type,f,n),b=F(u),C=b.avatarDimension,A=b.onAvatarClick,R=b.titleButtonDirection,I=v(A,"member",i),D={alt:T,dimension:C,onPhotoClick:I,photoUrl:i.photo_url,defaultAvatar:o.createElement(a.InitialsAvatarWithColorDerivedFromName,{alt:T,dimension:C,name:i.display_name,initials:i.initials.toUpperCase(),shape:"CIRCLE",onClick:I})};return t=f?o.createElement(l.default,r.__assign({},D)):o.createElement(s,r.__assign({},D)),o.createElement(d,{key:"user:"+i.user_id+":"+i.photo_url,text:T,direction:R},t)}function T(e){var t,r,s=e.group,i=e.avatarArgs,l=void 0===i?{}:i,c=F(l),u=c.avatarDimension,p=c.onAvatarClick,h=c.titleButtonDirection,_=v(p,"group",s);return s.is_automatic?(r=R(s.name,s.access_type),t=o.createElement(n.PhotoAvatar,{alt:r,dimension:u,photoUrl:f.static_url("/static/images/icons/team_32-vflk8mBzO.png"),shape:"SQUARE",onClick:_})):(r=I(s.name,s.access_type,s.num_users),t=o.createElement(a.InitialsAvatarWithColorDerivedFromName,{alt:r,dimension:u,name:s.name,shape:"SQUARE",initials:A(s.name),onClick:_})),o.createElement(d,{key:"group:"+s.gid+":"+s.name,text:r,direction:h},t)}function b(e){var t=e.index,r=e.description,s=e.avatarArgs,a=void 0===s?{}:s,n=F(a),i=n.avatarDimension,l=n.onAvatarClick,c=n.titleButtonDirection;return o.createElement(d,{key:"placeholder:"+t,text:r,direction:c},o.createElement("button",{className:"u-unbutton c-avatar--m",onClick:l?l:void 0},o.createElement("img",{alt:r,src:f.static_url("/static/images/icons/no_member-vflE0FYQV.svg"),width:i,height:i})))}function C(e){var t=e.invited_member,r=e.avatarArgs,s=void 0===r?{}:r,n=F(s),i=n.avatarDimension,l=n.onAvatarClick,c=n.titleButtonDirection,u=v(l,"invited",t),p=P(t.email_or_fbname,"pending",!1);return o.createElement(d,{key:"invitation:"+t.invitation_id,text:p,direction:c},o.createElement(a.InitialsAvatar,{alt:p,dimension:i,color:"#aaa",initials:A(t.email_or_fbname),shape:"CIRCLE",onClick:u}))}function A(e){if(null==e||!(e.length>0))return"";var t=e.split(" "),r=t.map(function(e){return e.charAt(0).toLowerCase()});return r.length>2&&(r=r.splice(0,2)),r.join("")}function R(e,t){return("editor"===t?g._("%(team_group_name)s can edit"):g._("%(team_group_name)s can view")).format({team_group_name:p.Emstring.em_snippet(e,_.SNIPPET_SIZES.DISPLAY_NAME)})}function I(e,t,r){var o;return o="editor"===t?g.ungettext("%(num_users)s person in %(group_name)s can edit","%(num_users)s people in %(group_name)s can edit",r):g.ungettext("%(num_users)s person in %(group_name)s can view","%(num_users)s people in %(group_name)s can view",r),o.format({group_name:p.Emstring.em_snippet(e,_.SNIPPET_SIZES.DISPLAY_NAME),num_users:r})}function P(e,t,r,o){void 0===o&&(o=!1);var s,a={viewer:g._("You can view"),editor:g._("You can edit"),owner:g._("You’re the owner"),team:g._("You’re a member of this team folder"),default:g._("You")},n={viewer:g._("%(name)s can view"),editor:g._("%(name)s can edit"),owner:g._("%(name)s is the owner"),pending:g._("%(name)s hasn’t added this to their Dropbox yet"),team:g._("%(name)s is a member of this team folder"),default:g._("%(name)s"),"no access":g._("No access")},i={viewer:g._("You (%(name)s) can view"),editor:g._("You (%(name)s) can edit"),owner:g._("You (%(name)s) are the owner")};return s=r?o&&null!=e?i:a:n,s.hasOwnProperty(t)?s[t].format({name:p.Emstring.em_snippet(e,_.SNIPPET_SIZES.DISPLAY_NAME)}):""}function D(e,t,r,s,a){void 0===s&&(s=5);var n,i,l=e.length,c=t.length+r.length,d=function(e){return p.Emstring.em_snippet(e,17)};if(c>0){var u=N(t.map(function(e){return d(e.display_name)}).concat(r.map(function(e){return d(e.email_or_fbname)})),s);n=o.createElement(h.Tooltip,{key:"members_text",position:h.TooltipPosition.BOTTOM,tooltip_contents:u.join("\n"),tooltip_classname:a},g.ungettext("%(member_count)s member","%(member_count)s members",c).format({member_count:c}))}if(l>0){var u=N(e.map(function(e){return d(e.name)}),s);i=o.createElement(h.Tooltip,{key:"groups_text",position:h.TooltipPosition.BOTTOM,tooltip_contents:u.join("\n"),tooltip_classname:a},g.ungettext("%(group_count)s group","%(group_count)s groups",l).format({group_count:l}))}return n&&!i?n:i&&!n?i:i&&n?o.createElement("div",null,i,", ",n):void 0}function N(e,t){if(e.length>t){var r=e.slice(0,t-1),o=e.length-(t-1);return r.push(g.ungettext("and %(num)s more…","and %(num)s more…",o,{comment:"Number of additional members. Expected to be >= 2."}).format({num:o})),r}return e}Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),l=r.__importDefault(l);t.MemberAvatarsMixin={getInitialState:function(){return{paired_users_in_sf:!1}},componentWillMount:function(){var e=E(this.props.joinedMembers);this.setState({paired_users_in_sf:e})},componentWillReceiveProps:function(e){var t=E(e.joinedMembers);this.setState({paired_users_in_sf:t})},findOwnerAndMeInJoinedMembers:function(e){for(var t=null,r=null,o=0,s=e;o<s.length;o++){var a=s[o];if("owner"===a.access_type&&(t=a),a.user_id===this.props.user.id&&(r=a),t&&r)break}return[t,r]},addGroupsMembersInvitations:function(e,t,r,o,s){var a={avatarDimension:this.props.avatarDimension,onAvatarClick:this.props.onAvatarClick,titleButtonDirection:this.props.titleButtonDirection};null==s&&(s=[]);for(var n=0,i=t;n<i.length;n++){var l=i[n];e.push(T({group:l,avatarArgs:a}))}for(var c=0,d=r;c<d.length;c++){var u=d[c];s.includes(u.user_id)||e.push(y({arePairedUsersInSF:this.state.paired_users_in_sf,member:u,avatarArgs:a}))}for(var p=0,h=o;p<h.length;p++){var _=h[p];e.push(C({invited_member:_,avatarArgs:a}))}},renderAvatarList:function(e,t){return o.createElement(c,{avatars:e,avatarDimension:this.props.avatarDimension,maxVisible:this.props.maxVisibleAvatars,undisplayableCount:this.props.numUndisplayableUsersAndInvites||0,onOverflowCountClick:this.props.onOverflowCountClick,overflowCountRenderer:w,animation:this.props.animation,className:t||""})},renderSharedLink:function(e,t){var r,s,a=this,n=this.getDescriptionForSharedLinkInfo(e,t),l=o.createElement(i,{alt:n,dimension:this.props.avatarDimension,onClick:function(t){a.props.onSharedLinkClick(e),t.stopPropagation()}});return(null!=e?e.allow_download:void 0)===!1?(r="sharing-icon-bubble-title u-font-center",s=!0):(r="",s=!1),o.createElement(d,{key:"shared_link",text:n,direction:"south",className:r,respectLineBreaks:s},l)},getDescriptionForSharedLinkInfo:function(e,t){var r;if(t)return m.formatSharedContentLinkDescription(t);var o=e.visibility_type,s=e.expires_posix,a=e.shared_folder_link_policy,n="";if(s){var i=(new Date).getTime()/1e3,l=s-i,c=Math.floor(l/86400);if(l<0)return g._("Link Disabled");r=new Date(1e3*s);var d=c>180;r=u.nice_date_with_month_name(r,d,!1,!0)}e.allow_download===!1&&(n=". "+g._("Downloads disabled.",{comment:'This follows a description of link visibility. For example: "Anyone with the link can view this file. Downloads disabled."'}));var p="MEMBERS_ONLY"===a;if(r){if(p)return g._("Folder members with the link can view until %(date)s").format({date:r})+n;if(o===_.SHMODEL_LINK_TOKEN_VISIBILITY.PUBLIC)return g._("People with the link can view until %(date)s").format({date:r})+n;if(o===_.SHMODEL_LINK_TOKEN_VISIBILITY.PASSWORD)return g._("People with the password can view until %(date)s").format({date:r})+n;if(o===_.SHMODEL_LINK_TOKEN_VISIBILITY.TEAM_ONLY)return g._("People at %(team_name)s can view until %(date)s").format({team_name:S.Viewer.get_viewer().team_name,date:r})+n;if(o===_.SHMODEL_LINK_TOKEN_VISIBILITY.ONLY_YOU)return g._("Only you can view until %(date)s").format({date:r})+n}else{if(p)return g._("Folder members with the link can view")+n;if(o===_.SHMODEL_LINK_TOKEN_VISIBILITY.PUBLIC)return g._("People with the link can view")+n;if(o===_.SHMODEL_LINK_TOKEN_VISIBILITY.PASSWORD)return g._("People with the password can view")+n;if(o===_.SHMODEL_LINK_TOKEN_VISIBILITY.TEAM_ONLY)return g._("People at %(team_name)s with the link can view").format({team_name:S.Viewer.get_viewer().team_name})+n;if(o===_.SHMODEL_LINK_TOKEN_VISIBILITY.ONLY_YOU)return g._("Only you can view")+n}throw Error("Unable to construct description!")}},t.renderOverflowCount=w;var O={avatarDimension:32,onAvatarClick:null,titleButtonDirection:"south"};t.renderJoinedMember=y,t.renderGroup=T,t.renderPlaceholderAvatar=b,t.renderInvitedPerson=C,t.buildGroupsAndMembersText=D}),define("modules/clean/web_upload_action_logger",["require","exports","tslib","modules/clean/ajax"],function(e,t,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o=r.__importStar(o),t.MAX_ERRORS=3;var s=(function(){function e(){this.errorCount=0,this.lastError=Date.now(),this.shouldReport=!0}return e.prototype.log=function(e,r,s){var a=this;return this.shouldReport&&(this.errorCount<t.MAX_ERRORS||Date.now()-this.lastError>6e5)?new Promise(function(n,i){o.SilentBackgroundRequest({url:"/log/web_upload_action",data:{_subject_uid:e,event_type:r,extra_params:JSON.stringify(s)},error:function(e){429===e.status?a.errorCount=t.MAX_ERRORS:a.errorCount++,a.lastError=Date.now(),i(e)},success:function(e){try{var t=JSON.parse(e);t&&!t.continue_sending&&(a.shouldReport=!1),a.errorCount=0,n(e)}catch(e){throw a.errorCount++,a.lastError=Date.now(),i(e),e}}})}):Promise.resolve({})},e})();t.WebUploadActionLog=new s,t.WebUploadActionLogClass=s});
//# sourceMappingURL=pkg-browse-uncommon.min.js-vflFSwMhT.map